import{_ as oa,r as n,z as ea,c as N,o as ta,D as ra,a as d,b as u,f as e,B as M,t as c,n as la,w as ua,m as h,v as z,C as O,e as S,F as K,g as P,h as G,i as da,q as ia}from"./index-IzLOKglm.js";import{B as na,a as H}from"./BaseError-DNv4Myx8.js";import{g as J,d as va,u as ma}from"./routes-Bv5CBije.js";import{l as fa}from"./clients-DV1jXavO.js";/* empty css                                                                  */const pa={class:"content-area route-detail"},ca={class:"detail-header"},ba={class:"header-left"},ya={class:"header-title"},ga=["disabled"],_a={key:0},Ca={key:1},ka={class:"detail-grid"},ha={class:"card route-card"},wa={class:"form-grid"},Na={class:"form-group form-group-large"},Sa={class:"form-group"},Ra={class:"form-group"},Aa={class:"form-group"},Ia={class:"card points-card"},Va={class:"points-card-header"},Ea={class:"add-point-group"},Ma=["disabled"],za=["value"],Ba=["disabled"],$a={key:0,class:"all-used-hint"},Ua={key:1,class:"points-list"},qa={class:"point-index"},La={class:"point-info"},Ta={key:0},ja={class:"point-actions"},Fa={class:"reorder-group"},Oa=["onClick","disabled"],Ka=["onClick","disabled"],Pa=["onClick","disabled"],Ga={key:2,class:"empty-points"},Ha={class:"form-feedback"},Ja={key:0,class:"feedback feedback-error"},Qa={key:1,class:"feedback feedback-success"},Wa={class:"form-footer"},Xa=["disabled"],Ya=["disabled"],Za={key:0},xa={key:1},Da={__name:"RotaDetalheView",setup(as){const B=ia(),$=da(),R=n(!0),b=n(!1),y=n(""),m=n(""),g=n(""),p=n(!1),C=n(!1),v=n(null),i=n([]),k=n([]),_=n(""),r=ea({nome:"",motorista:"",veiculo:"",ativa:!0}),U=N(()=>B.params.id),A=N(()=>{const a=new Set(i.value.map(s=>f(s)));return k.value.filter(s=>s&&!a.has(f(s))).map(s=>{const o=f(s),t=o?`Cliente ${o}`:"Cliente";return{id:o,label:s.nome||s.name||s.razaoSocial||t}})}),Q=N(()=>r.ativa?"Ativa":"Inativa"),W=N(()=>r.ativa?"pill-active":"pill-inactive");function I(){_.value=""}async function V(){if(!U.value){y.value="Rota não encontrada.";return}R.value=!0,y.value="",m.value="",g.value="",I();try{const[a,s]=await Promise.all([J(U.value),fa()]);if(!a||!a.id){y.value="Rota não encontrada.";return}v.value=a,r.nome=a.nome||a.name||"",r.motorista=a.motorista||"",r.veiculo=a.veiculo||"",r.ativa=a.ativa!==!1,k.value=Array.isArray(s)?s:[],i.value=q(a,k.value)}catch(a){y.value=(a==null?void 0:a.message)||"Erro ao carregar dados da rota"}finally{R.value=!1,b.value=!1}}function q(a,s){const o=Array.isArray(a==null?void 0:a.clientes)?a.clientes:Array.isArray(a==null?void 0:a.pontos)?a.pontos:[];if(!o.length)return[];const t=new Map(s.map(l=>[f(l),l]));return o.map((l,w)=>{if(l&&typeof l=="object")return E(l,w);const F=l!=null?String(l):"",sa=F?t.get(F):void 0;return E(sa??{id:l},w)})}function L(a,s){if(s<0||s>=i.value.length||a===s)return;const o=i.value.slice(),[t]=o.splice(a,1);o.splice(s,0,t),i.value=o.map((l,w)=>({...l,ordem:w+1}))}function X(a){const s=f(a);s&&(i.value=i.value.filter(o=>f(o)!==s).map((o,t)=>({...o,ordem:t+1})))}function Y(){if(!_.value)return;const a=k.value.find(s=>f(s)===String(_.value));a&&(i.value=i.value.concat(E(a,i.value.length)).map((s,o)=>({...s,ordem:o+1})),I())}function f(a){if(!a)return"";const s=a.id??a.clientId??a.pid;return s!=null?String(s):""}function E(a,s=0){const o=(a==null?void 0:a.id)??(a==null?void 0:a.clientId)??(a==null?void 0:a.pid),t=Number(o),l=Number.isNaN(t)?o:t;return{...a,id:l,clientId:(a==null?void 0:a.clientId)??l,nome:(a==null?void 0:a.nome)||(a==null?void 0:a.name)||(a==null?void 0:a.razaoSocial)||"",endereco:(a==null?void 0:a.endereco)||(a==null?void 0:a.address)||(a==null?void 0:a.companyAddress)||"",cidade:(a==null?void 0:a.cidade)||(a==null?void 0:a.city)||(a==null?void 0:a.municipio)||(a==null?void 0:a.localidade)||(a==null?void 0:a.cityName)||"",estado:(a==null?void 0:a.estado)||(a==null?void 0:a.uf)||(a==null?void 0:a.state)||(a==null?void 0:a.province)||"",ordem:typeof(a==null?void 0:a.ordem)=="number"&&a.ordem>0?a.ordem:s+1}}function Z(a,s=0){const o=(a==null?void 0:a.nome)||(a==null?void 0:a.name)||(a==null?void 0:a.razaoSocial);if(o)return o;const t=f(a);return t?`Cliente ${t}`:`Cliente ${s+1}`}function T(a){if(!a)return"";const s=(a.cidade||a.city||a.municipio||a.localidade||a.cityName||"").toString().trim(),o=(a.estado||a.uf||a.state||a.province||"").toString().trim().toUpperCase();return s&&o?`${s} - ${o}`:s||o||""}async function x(){if(!(!v.value||!v.value.id)){if(!r.nome){m.value="Nome é obrigatório.";return}m.value="",g.value="",p.value=!0;try{const a=i.value.map(o=>{const t=o.id??o.clientId??o.pid,l=Number(t);return Number.isNaN(l)?t:l}),s={nome:r.nome,motorista:r.motorista,veiculo:r.veiculo,ativa:r.ativa!==!1,clientes:a};await ma(v.value.id,s),g.value="Rota atualizada com sucesso.",await D()}catch(a){m.value=(a==null?void 0:a.message)||"Erro ao salvar rota"}finally{p.value=!1}}}async function D(){var a;if((a=v.value)!=null&&a.id){b.value=!0;try{const s=await J(v.value.id);s&&(v.value={...v.value,...s},i.value=q(s,k.value)),I()}catch(s){m.value=(s==null?void 0:s.message)||"Erro ao atualizar clientes"}finally{b.value=!1}}}function j(){$.push({name:"rotas"})}async function aa(){var s;if(!(!((s=v.value)!=null&&s.id)||C.value||!window.confirm("Tem certeza que deseja excluir esta rota? Essa ação não pode ser desfeita."))){m.value="",g.value="",C.value=!0;try{await va(v.value.id),$.push({name:"rotas"})}catch(o){m.value=(o==null?void 0:o.message)||"Erro ao excluir rota"}finally{C.value=!1}}}return ta(V),ra(()=>B.params.id,(a,s)=>{a!==s&&V()}),(a,s)=>(u(),d("section",pa,[e("header",ca,[e("div",ba,[e("button",{class:"btn-back",type:"button",onClick:j},[...s[5]||(s[5]=[e("i",{class:"fa-solid fa-arrow-left"},null,-1),e("span",null,"Voltar",-1)])]),e("div",ya,[e("h2",null,c(r.nome||"Rota"),1),e("span",{class:la(["status-pill",W.value])},c(Q.value),3)])]),e("button",{class:"btn-delete",type:"button",onClick:aa,disabled:p.value||C.value},[s[6]||(s[6]=e("i",{class:"fa-solid fa-trash"},null,-1)),C.value?(u(),d("span",_a,"Excluindo…")):(u(),d("span",Ca,"Excluir rota"))],8,ga)]),y.value?(u(),M(na,{key:0,message:y.value,retry:V},null,8,["message"])):R.value?(u(),M(H,{key:1,message:"Carregando dados da rota…"})):(u(),d("form",{key:2,class:"detail-form",onSubmit:ua(x,["prevent"])},[e("div",ka,[e("section",ha,[s[12]||(s[12]=e("h3",{class:"section-title"},"Dados da rota",-1)),e("div",wa,[e("div",Na,[s[7]||(s[7]=e("label",{for:"nome"},"Nome",-1)),h(e("input",{id:"nome",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=o=>r.nome=o),required:""},null,512),[[z,r.nome,void 0,{trim:!0}]])]),e("div",Sa,[s[8]||(s[8]=e("label",{for:"motorista"},"Motorista",-1)),h(e("input",{id:"motorista",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=o=>r.motorista=o)},null,512),[[z,r.motorista,void 0,{trim:!0}]])]),e("div",Ra,[s[9]||(s[9]=e("label",{for:"veiculo"},"Veículo",-1)),h(e("input",{id:"veiculo",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=o=>r.veiculo=o)},null,512),[[z,r.veiculo,void 0,{trim:!0}]])]),e("div",Aa,[s[11]||(s[11]=e("label",{for:"status"},"Status",-1)),h(e("select",{id:"status",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=o=>r.ativa=o)},[...s[10]||(s[10]=[e("option",{value:!0},"Ativa",-1),e("option",{value:!1},"Inativa",-1)])],512),[[O,r.ativa]])])])]),e("section",Ia,[e("div",Va,[s[16]||(s[16]=e("div",null,[e("h3",{class:"section-title"},"Clientes da rota"),e("p",{class:"section-hint"},"Organize os clientes como preferir e inclua novos quando necessário.")],-1)),e("div",Ea,[s[15]||(s[15]=e("label",{class:"sr-only",for:"novo-cliente"},"Adicionar cliente",-1)),h(e("select",{id:"novo-cliente",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=o=>_.value=o),disabled:b.value||!A.value.length},[s[13]||(s[13]=e("option",{value:"",disabled:""},"Selecione um cliente",-1)),(u(!0),d(K,null,P(A.value,o=>(u(),d("option",{key:o.id,value:o.id},c(o.label),9,za))),128))],8,Ma),[[O,_.value]]),e("button",{class:"btn-add",type:"button",onClick:Y,disabled:!_.value||p.value},[...s[14]||(s[14]=[e("i",{class:"fa-solid fa-plus"},null,-1),G(" Adicionar ",-1)])],8,Ba)]),!b.value&&!A.value.length?(u(),d("small",$a,"Todos os clientes disponíveis já estão associados.")):S("",!0)]),b.value?(u(),M(H,{key:0,message:"Carregando clientes…"})):i.value.length?(u(),d("ul",Ua,[(u(!0),d(K,null,P(i.value,(o,t)=>(u(),d("li",{key:f(o),class:"point-item"},[e("span",qa,c(t+1),1),e("div",La,[e("strong",null,c(Z(o,t)),1),T(o)?(u(),d("small",Ta,c(T(o)),1)):S("",!0)]),e("div",ja,[e("div",Fa,[e("button",{class:"btn-move",type:"button","aria-label":"Mover para cima",onClick:l=>L(t,t-1),disabled:t===0},[...s[17]||(s[17]=[e("i",{class:"fa-solid fa-arrow-up"},null,-1)])],8,Oa),e("button",{class:"btn-move",type:"button","aria-label":"Mover para baixo",onClick:l=>L(t,t+1),disabled:t===i.value.length-1},[...s[18]||(s[18]=[e("i",{class:"fa-solid fa-arrow-down"},null,-1)])],8,Ka)]),e("button",{class:"btn-remove",type:"button",onClick:l=>X(o),disabled:p.value},[...s[19]||(s[19]=[e("i",{class:"fa-solid fa-trash"},null,-1),G(" Remover ",-1)])],8,Pa)])]))),128))])):(u(),d("div",Ga,"Nenhum cliente cadastrado nesta rota."))])]),e("div",Ha,[m.value?(u(),d("p",Ja,c(m.value),1)):S("",!0),g.value?(u(),d("p",Qa,c(g.value),1)):S("",!0)]),e("footer",Wa,[e("button",{class:"btn-secondary",type:"button",onClick:j,disabled:p.value},"Cancelar",8,Xa),e("button",{class:"btn-primary",type:"submit",disabled:p.value},[p.value?(u(),d("span",Za,"Salvando…")):(u(),d("span",xa,"Salvar alterações"))],8,Ya)])],32))]))}},ls=oa(Da,[["__scopeId","data-v-9abd7c32"]]);export{ls as default};
