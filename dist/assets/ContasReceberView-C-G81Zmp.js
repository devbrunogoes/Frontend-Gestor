import{_ as Nt,r as d,z as ot,c as u,o as Et,D as at,a as r,b as n,f as s,B as lt,t as a,n as c,F as I,g as $,m as h,v as C,h as Q,e as x,w as nt,C as Rt}from"./index-IzLOKglm.js";import{B as Vt,a as Bt}from"./BaseError-DNv4Myx8.js";import{l as It,u as rt,d as $t,c as xt}from"./receivables-DjFeXSt8.js";/* empty css                                                                  */const Lt={class:"content-area receivable-view"},Ot={class:"page-header receivable-header"},Mt={class:"header-copy"},Pt={class:"header-summary"},At={class:"summary-card positive"},Ut={class:"summary-value"},Ft={class:"summary-card neutral"},Tt={class:"summary-value"},zt={class:"summary-note"},Ht={class:"summary-value"},qt={class:"summary-note"},jt={class:"summary-value"},Gt={class:"summary-note"},Jt={class:"status-chip-row"},Kt=["onClick"],Qt={class:"chip-count"},Wt={class:"filters-card"},Xt={class:"filter-group"},Yt={class:"filter-group"},Zt={class:"range-inputs"},ts={class:"filter-group"},ss=["disabled"],es={key:2,class:"receivable-content"},os={class:"table-card"},as={class:"table-header"},ls={class:"table-caption"},ns={key:0,class:"filters-badge"},rs={class:"table-responsive"},is={class:"data-table receivable-table"},us={class:"text-end"},ds={key:0},cs={colspan:"7",class:"empty-row"},vs={"data-label":"ID"},_s={"data-label":"Cliente"},ps={class:"description-cell"},fs={key:0,class:"description-note"},bs={"data-label":"Descrição"},ms={"data-label":"Valor",class:"text-end"},ys={"data-label":"Vencimento"},gs={"data-label":"Status"},hs={class:"actions-col","data-label":"Ações"},Cs=["title","onClick","disabled"],ks=["onClick","disabled"],ws=["onClick","disabled"],Ss={class:"insights-card"},Ds={class:"insights-section"},Ns={key:0,class:"insights-list"},Es={class:"item-title"},Rs={class:"item-sub"},Vs={class:"item-meta"},Bs={class:"item-value"},Is={class:"item-date"},$s={key:1,class:"empty-note"},xs={class:"insights-section"},Ls={key:0,class:"insights-list overdue"},Os={class:"item-title"},Ms={class:"item-sub"},Ps={class:"item-meta"},As={class:"item-value neg"},Us={class:"item-date"},Fs={key:1,class:"empty-note"},Ts={class:"insights-section"},zs={key:0,class:"insights-list compact"},Hs={class:"item-title"},qs={class:"item-sub"},js={class:"item-meta"},Gs={class:"item-value"},Js={key:1,class:"empty-note"},Ks={class:"modal-dialog"},Qs={class:"modal-content"},Ws={class:"modal-header"},Xs={class:"modal-body"},Ys={class:"form-grid"},Zs={class:"form-group form-group-large"},te={class:"form-group form-group-large"},se={class:"form-group"},ee={class:"form-group"},oe={class:"form-group"},ae={key:0,class:"form-error"},le={key:1,class:"form-success"},ne={class:"modal-footer"},re=["disabled"],ie={key:0},ue={key:1},de={__name:"ContasReceberView",setup(ce){const W=d([]),T=d(!1),L=d(""),O=d(!1),E=d(null),R=d(""),m=d("all"),_=d(""),p=d(""),f=ot({column:"vencimento",direction:"asc"}),b=d(""),k=d(""),V=d(null),B=d(null),M=d(!1),l=ot({cliente:"",descricao:"",valor:0,vencimento:new Date().toISOString().slice(0,10),pago:!1}),it=[{key:"all",label:"Todos"},{key:"open",label:"Em aberto"},{key:"soon",label:"Próx. 7 dias"},{key:"overdue",label:"Em atraso"},{key:"paid",label:"Pagos"}],X=["id","cliente","descricao","valor","vencimento","status"];function Y(){const e=new Date;return e.setHours(0,0,0,0),e}function z(e){if(!e)return null;const t=new Date(e);return Number.isNaN(t)?null:(t.setHours(0,0,0,0),t)}function y(e){return(Number(e)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function H(e){if(!e)return"Sem data";const t=e instanceof Date?e:new Date(e);return Number.isNaN(t)?"Sem data":t.toLocaleDateString("pt-BR")}const w=u(()=>{const e=Y();return W.value.map(t=>{const o=Number(t.valor||0),v=t.vencimento||t.data||"",i=z(v);let g="open";if(t.pago)g="paid";else if(i){const K=Math.ceil((i-e)/864e5);K<0?g="overdue":K===0?g="today":K<=7&&(g="soon")}return{...t,__valor:o,__date:i,__dateISO:i?i.toISOString().slice(0,10):"",__status:g}})}),ut=u(()=>{const e={all:w.value.length,open:0,soon:0,overdue:0,paid:0};return w.value.forEach(t=>{t.__status==="paid"?e.paid+=1:t.__status==="overdue"?e.overdue+=1:t.__status==="soon"||t.__status==="today"?e.soon+=1:e.open+=1}),e}),q=u(()=>{const e=R.value.trim().toLowerCase(),t=_.value?z(_.value):null,o=p.value?z(p.value):null;o&&o.setHours(23,59,59,999);const v=w.value.filter(i=>!(e&&!`${i.id||""} ${i.cliente||""} ${i.nomeCliente||""} ${i.descricao||""}`.toLowerCase().includes(e)||t&&(!i.__date||i.__date<t)||o&&(!i.__date||i.__date>o)||m.value==="open"&&i.__status!=="open"||m.value==="soon"&&!(i.__status==="soon"||i.__status==="today")||m.value==="overdue"&&i.__status!=="overdue"||m.value==="paid"&&i.__status!=="paid"));return bt(v)}),j=u(()=>!!(R.value||m.value&&m.value!=="all"||_.value||p.value)),P=u(()=>w.value.filter(e=>e.__status!=="paid")),dt=u(()=>w.value.filter(e=>e.__status==="paid")),ct=u(()=>P.value.reduce((e,t)=>e+t.__valor,0)),vt=u(()=>dt.value.reduce((e,t)=>e+t.__valor,0)),A=u(()=>P.value.filter(e=>e.__status==="overdue").sort((e,t)=>(e.__date||0)-(t.__date||0))),Z=u(()=>A.value.reduce((e,t)=>e+t.__valor,0)),_t=u(()=>A.value.length),U=u(()=>{const e=new Date(Y());return e.setDate(e.getDate()+7),P.value.filter(t=>t.__status==="soon"||t.__status==="today").sort((t,o)=>(t.__date||0)-(o.__date||0)).filter(t=>t.__date&&t.__date<=e).slice(0,5)}),tt=u(()=>U.value.reduce((e,t)=>e+t.__valor,0)),pt=u(()=>U.value.length),ft=u(()=>P.value.length),st=u(()=>{const e=new Map;return w.value.forEach(t=>{if(!t.cliente&&!t.nomeCliente)return;const o=t.cliente||t.nomeCliente,v=e.get(o)||{nome:o,count:0,valor:0};v.count+=1,v.valor+=t.__valor,e.set(o,v)}),Array.from(e.values()).sort((t,o)=>o.valor-t.valor).slice(0,5)});function bt(e){const t=f.direction==="desc"?-1:1,o=X.includes(f.column)?f.column:"vencimento",v=mt(o);return[...e].sort((i,g)=>v(i,g)*t)}function mt(e){switch(e){case"id":return(t,o)=>(Number(t.id)||0)-(Number(o.id)||0);case"cliente":return(t,o)=>(t.cliente||t.nomeCliente||"").localeCompare(o.cliente||o.nomeCliente||"","pt-BR",{sensitivity:"base"});case"descricao":return(t,o)=>(t.descricao||"").localeCompare(o.descricao||"","pt-BR",{sensitivity:"base"});case"valor":return(t,o)=>(t.__valor||0)-(o.__valor||0);case"status":return(t,o)=>G(t).localeCompare(G(o),"pt-BR",{sensitivity:"base"});case"vencimento":default:return(t,o)=>t.__date&&o.__date?t.__date-o.__date:t.__date?-1:o.__date?1:(Number(t.id)||0)-(Number(o.id)||0)}}function S(e){X.includes(e)&&(f.column===e?f.direction=f.direction==="asc"?"desc":"asc":(f.column=e,f.direction="asc"))}function D(e){return f.column!==e?"fa-sort":f.direction==="asc"?"fa-sort-up":"fa-sort-down"}function G(e){return e.__status==="paid"?"Pago":e.__status==="overdue"?"Em atraso":e.__status==="today"?"Vence hoje":e.__status==="soon"?"Próx. 7 dias":"Em aberto"}function yt(e){return e.__status==="paid"?"status-paid":e.__status==="overdue"?"status-overdue":e.__status==="today"?"status-today":e.__status==="soon"?"status-soon":"status-open"}function gt(e){return e.__status==="paid"?"row-paid":e.__status==="overdue"?"row-overdue":e.__status==="today"?"row-today":e.__status==="soon"?"row-soon":""}function et(){l.cliente="",l.descricao="",l.valor=0,l.vencimento=new Date().toISOString().slice(0,10),l.pago=!1,E.value=null,b.value="",k.value=""}function ht(){et(),O.value=!0}function Ct(e){E.value=e.id,l.cliente=e.cliente||e.nomeCliente||"",l.descricao=e.descricao||"",l.valor=Number(e.valor||0),l.vencimento=e.__dateISO||e.vencimento||new Date().toISOString().slice(0,10),l.pago=!!e.pago,b.value="",k.value="",O.value=!0}function F(){O.value=!1}async function N(){T.value=!0,L.value="";try{W.value=await It()}catch(e){L.value=(e==null?void 0:e.message)||"Erro ao carregar títulos."}finally{T.value=!1}}async function kt(){if(b.value="",k.value="",!l.descricao){b.value="Descrição é obrigatória.";return}const e={cliente:l.cliente,descricao:l.descricao,valor:Number(l.valor||0),vencimento:l.vencimento,pago:!!l.pago};try{M.value=!0,E.value?await rt(E.value,e):await xt(e),k.value="Título salvo com sucesso.",F(),et(),await N()}catch(t){b.value=(t==null?void 0:t.message)||"Erro ao salvar título."}finally{M.value=!1}}async function wt(e){if(!(V.value||!(e!=null&&e.id)))try{V.value=e.id,await rt(e.id,{pago:!e.pago}),await N()}catch(t){b.value=(t==null?void 0:t.message)||"Erro ao atualizar status."}finally{V.value=null}}async function St(e){if(!(B.value||!(e!=null&&e.id))&&confirm(`Confirma excluir o título #${e.id}?`))try{B.value=e.id,b.value="",await $t(e.id),await N()}catch(t){b.value=(t==null?void 0:t.message)||"Erro ao excluir título."}finally{B.value=null}}function Dt(){R.value="",m.value="all",_.value="",p.value=""}function J(e){return e==null?!1:V.value===e||B.value===e}return Et(N),at(_,e=>{if(!e||!p.value)return;const t=new Date(e);new Date(p.value)<t&&(p.value="")}),at(p,e=>{if(!e||!_.value)return;const t=new Date(e),o=new Date(_.value);t<o&&(_.value="")}),(e,t)=>(n(),r("section",Lt,[s("header",Ot,[s("div",Mt,[t[18]||(t[18]=s("h2",null,"Contas a Receber",-1)),t[19]||(t[19]=s("p",null,"Acompanhe títulos em aberto, vencimentos críticos e performance de recebimentos.",-1)),s("div",Pt,[s("div",At,[t[14]||(t[14]=s("span",{class:"summary-label"},"Total pago",-1)),s("strong",Ut,a(y(vt.value)),1)]),s("div",Ft,[t[15]||(t[15]=s("span",{class:"summary-label"},"Em aberto",-1)),s("strong",Tt,a(y(ct.value)),1),s("span",zt,a(ft.value)+" título(s)",1)]),s("div",{class:c(["summary-card warning",{critical:Z.value>0}])},[t[16]||(t[16]=s("span",{class:"summary-label"},"Em atraso",-1)),s("strong",Ht,a(y(Z.value)),1),s("span",qt,a(_t.value)+" vencido(s)",1)],2),s("div",{class:c(["summary-card info",{attention:tt.value>0}])},[t[17]||(t[17]=s("span",{class:"summary-label"},"Próx. 7 dias",-1)),s("strong",jt,a(y(tt.value)),1),s("span",Gt,a(pt.value)+" previsto(s)",1)],2)])]),s("div",{class:"header-actions"},[s("button",{class:"btn btn-success",type:"button",onClick:ht},[...t[20]||(t[20]=[s("i",{class:"fa-solid fa-plus"},null,-1),s("span",null,"Novo título",-1)])]),s("button",{class:"btn btn-ghost",type:"button",onClick:N},[...t[21]||(t[21]=[s("i",{class:"fa-solid fa-rotate"},null,-1),s("span",null,"Atualizar",-1)])])])]),s("div",Jt,[(n(),r(I,null,$(it,o=>s("button",{key:o.key,type:"button",class:c(["status-chip",{active:m.value===o.key}]),onClick:v=>m.value=o.key},[s("span",null,a(o.label),1),s("span",Qt,a(ut.value[o.key]||0),1)],10,Kt)),64))]),s("div",Wt,[s("div",Xt,[t[22]||(t[22]=s("label",{for:"search"},"Buscar",-1)),h(s("input",{id:"search",type:"search",class:"form-control",placeholder:"Cliente, descrição ou ID","onUpdate:modelValue":t[0]||(t[0]=o=>R.value=o)},null,512),[[C,R.value,void 0,{trim:!0}]])]),s("div",Yt,[t[24]||(t[24]=s("label",{for:"range"},"Período",-1)),s("div",Zt,[h(s("input",{id:"range",type:"date",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=o=>_.value=o)},null,512),[[C,_.value]]),t[23]||(t[23]=s("span",null,"até",-1)),h(s("input",{type:"date",class:"form-control","onUpdate:modelValue":t[2]||(t[2]=o=>p.value=o)},null,512),[[C,p.value]])])]),s("div",ts,[t[25]||(t[25]=s("label",null," ",-1)),s("button",{class:"btn btn-primary",type:"button",onClick:Dt,disabled:!j.value}," Limpar filtros ",8,ss)])]),L.value?(n(),lt(Vt,{key:0,message:L.value,retry:N},null,8,["message"])):T.value?(n(),lt(Bt,{key:1,message:"Carregando títulos…"})):(n(),r("div",es,[s("div",os,[s("div",as,[t[27]||(t[27]=s("h3",null,"Planilha de Contas a Receber",-1)),s("span",ls,[Q(a(q.value.length)+" registro(s) ",1),j.value?(n(),r("span",ns,[...t[26]||(t[26]=[s("i",{class:"fa-solid fa-filter"},null,-1),Q(" Filtros ativos",-1)])])):x("",!0)])]),s("div",rs,[s("table",is,[s("thead",null,[s("tr",null,[s("th",null,[s("button",{type:"button",class:"sort-button",onClick:t[3]||(t[3]=o=>S("id"))},[t[28]||(t[28]=s("span",null,"ID",-1)),s("i",{class:c(["fa-solid",D("id")])},null,2)])]),s("th",null,[s("button",{type:"button",class:"sort-button",onClick:t[4]||(t[4]=o=>S("cliente"))},[t[29]||(t[29]=s("span",null,"Cliente",-1)),s("i",{class:c(["fa-solid",D("cliente")])},null,2)])]),s("th",null,[s("button",{type:"button",class:"sort-button",onClick:t[5]||(t[5]=o=>S("descricao"))},[t[30]||(t[30]=s("span",null,"Descrição",-1)),s("i",{class:c(["fa-solid",D("descricao")])},null,2)])]),s("th",us,[s("button",{type:"button",class:"sort-button",onClick:t[6]||(t[6]=o=>S("valor"))},[t[31]||(t[31]=s("span",null,"Valor",-1)),s("i",{class:c(["fa-solid",D("valor")])},null,2)])]),s("th",null,[s("button",{type:"button",class:"sort-button",onClick:t[7]||(t[7]=o=>S("vencimento"))},[t[32]||(t[32]=s("span",null,"Vencimento",-1)),s("i",{class:c(["fa-solid",D("vencimento")])},null,2)])]),s("th",null,[s("button",{type:"button",class:"sort-button",onClick:t[8]||(t[8]=o=>S("status"))},[t[33]||(t[33]=s("span",null,"Status",-1)),s("i",{class:c(["fa-solid",D("status")])},null,2)])]),t[34]||(t[34]=s("th",{class:"actions-col"},"Ações",-1))])]),s("tbody",null,[q.value.length?x("",!0):(n(),r("tr",ds,[s("td",cs,a(j.value?"Nenhum título encontrado com os filtros atuais.":"Cadastre seus primeiros títulos para acompanhar recebimentos."),1)])),(n(!0),r(I,null,$(q.value,o=>(n(),r("tr",{key:o.id||o.__dateISO||o.descricao,class:c(gt(o))},[s("td",vs,"#"+a(o.id||"—"),1),s("td",_s,[s("div",ps,[s("strong",null,a(o.cliente||o.nomeCliente||"Cliente não informado"),1),o.titulo?(n(),r("span",fs,a(o.titulo),1)):x("",!0)])]),s("td",bs,a(o.descricao||"Recebimento sem descrição"),1),s("td",ms,a(y(o.__valor)),1),s("td",ys,a(H(o.__date)),1),s("td",gs,[s("span",{class:c(["status-pill",yt(o)])},a(G(o)),3)]),s("td",hs,[s("button",{class:"btn-icon btn-success",title:o.pago?"Reabrir título":"Marcar como pago",onClick:v=>wt(o),disabled:J(o.id)},[s("i",{class:c(["fa-solid",V.value===o.id?"fa-spinner fa-spin":o.pago?"fa-rotate-left":"fa-check"])},null,2)],8,Cs),s("button",{class:"btn-icon btn-warning",title:"Editar",onClick:v=>Ct(o),disabled:J(o.id)},[...t[35]||(t[35]=[s("i",{class:"fa-solid fa-pen"},null,-1)])],8,ks),s("button",{class:"btn-icon btn-danger",title:"Excluir",onClick:v=>St(o),disabled:J(o.id)},[s("i",{class:c(["fa-solid",B.value===o.id?"fa-spinner fa-spin":"fa-trash"])},null,2)],8,ws)])],2))),128))])])])]),s("aside",Ss,[s("div",Ds,[t[36]||(t[36]=s("h4",null,"Próximos vencimentos",-1)),U.value.length?(n(),r("ul",Ns,[(n(!0),r(I,null,$(U.value,o=>(n(),r("li",{key:`up-${o.id||o.__dateISO}`},[s("div",null,[s("span",Es,a(o.descricao||"Sem descrição"),1),s("span",Rs,a(o.cliente||"Cliente não informado"),1)]),s("div",Vs,[s("span",Bs,a(y(o.__valor)),1),s("span",Is,a(H(o.__date)),1)])]))),128))])):(n(),r("p",$s,"Nenhum recebimento previsto para os próximos dias."))]),s("div",xs,[t[37]||(t[37]=s("h4",null,"Em atraso",-1)),A.value.length?(n(),r("ul",Ls,[(n(!0),r(I,null,$(A.value,o=>(n(),r("li",{key:`od-${o.id||o.__dateISO}`},[s("div",null,[s("span",Os,a(o.descricao||"Sem descrição"),1),s("span",Ms,a(o.cliente||"Cliente não informado"),1)]),s("div",Ps,[s("span",As,a(y(o.__valor)),1),s("span",Us,a(H(o.__date)),1)])]))),128))])):(n(),r("p",Fs,"Nenhum título em atraso. Excelente!"))]),s("div",Ts,[t[38]||(t[38]=s("h4",null,"Clientes em destaque",-1)),st.value.length?(n(),r("ul",zs,[(n(!0),r(I,null,$(st.value,o=>(n(),r("li",{key:`client-${o.nome}`},[s("div",null,[s("span",Hs,a(o.nome),1),s("span",qs,a(o.count)+" título(s)",1)]),s("div",js,[s("span",Gs,a(y(o.valor)),1)])]))),128))])):(n(),r("p",Js,"Cadastre recebíveis para acompanhar os principais clientes."))])])])),s("div",{class:c(["modal",{show:O.value}]),role:"dialog","aria-hidden":"true",onClick:nt(F,["self"])},[s("div",Ks,[s("div",Qs,[s("div",Ws,[s("h3",null,a(E.value?"Editar título":"Novo título"),1),s("button",{type:"button",class:"btn-close",onClick:F,"aria-label":"Fechar"},[...t[39]||(t[39]=[s("i",{class:"fa-solid fa-times"},null,-1)])])]),s("form",{onSubmit:nt(kt,["prevent"])},[s("div",Xs,[s("div",Ys,[s("div",Zs,[t[40]||(t[40]=s("label",{for:"cliente"},"Cliente",-1)),h(s("input",{id:"cliente",class:"form-control","onUpdate:modelValue":t[9]||(t[9]=o=>l.cliente=o)},null,512),[[C,l.cliente,void 0,{trim:!0}]])]),s("div",te,[t[41]||(t[41]=s("label",{for:"descricao"},"Descrição",-1)),h(s("input",{id:"descricao",class:"form-control","onUpdate:modelValue":t[10]||(t[10]=o=>l.descricao=o),required:""},null,512),[[C,l.descricao,void 0,{trim:!0}]])]),s("div",se,[t[42]||(t[42]=s("label",{for:"valor"},"Valor (R$)",-1)),h(s("input",{id:"valor",type:"number",step:"0.01",min:"0",class:"form-control","onUpdate:modelValue":t[11]||(t[11]=o=>l.valor=o)},null,512),[[C,l.valor,void 0,{number:!0}]])]),s("div",ee,[t[43]||(t[43]=s("label",{for:"vencimento"},"Vencimento",-1)),h(s("input",{id:"vencimento",type:"date",class:"form-control","onUpdate:modelValue":t[12]||(t[12]=o=>l.vencimento=o)},null,512),[[C,l.vencimento]])]),s("div",oe,[t[45]||(t[45]=s("label",{for:"pago"},"Pago",-1)),h(s("select",{id:"pago",class:"form-control","onUpdate:modelValue":t[13]||(t[13]=o=>l.pago=o)},[...t[44]||(t[44]=[s("option",{value:!1},"Não",-1),s("option",{value:!0},"Sim",-1)])],512),[[Rt,l.pago]])])]),b.value?(n(),r("p",ae,a(b.value),1)):x("",!0),k.value?(n(),r("p",le,a(k.value),1)):x("",!0)]),s("div",ne,[s("button",{type:"button",class:"btn btn-secondary",onClick:F},"Cancelar"),s("button",{type:"submit",class:"btn btn-success",disabled:M.value},[M.value?(n(),r("span",ie,[...t[46]||(t[46]=[s("i",{class:"fa-solid fa-spinner fa-spin"},null,-1),Q(" Salvando…",-1)])])):(n(),r("span",ue,"Salvar"))],8,re)])],32)])])],2)]))}},be=Nt(de,[["__scopeId","data-v-7139303d"]]);export{be as default};
