import{_ as fs,r as v,z as gs,c as d,o as ms,a as i,b as n,f as a,B as q,n as I,t as o,m as _,v as y,C as F,k as ys,F as D,g as E,e as O,w as j}from"./index-IzLOKglm.js";import{B as bs,a as hs}from"./BaseError-DNv4Myx8.js";import{l as ks,u as Y,d as Ss,c as ws}from"./expenses-Dw-_t_jz.js";/* empty css                                                                  */const Cs={class:"content-area expenses-view"},Ds={class:"page-header expenses-header"},Es={class:"header-summary"},Ns={class:"summary-value"},Ls={class:"summary-note"},Vs={class:"summary-card positive"},$s={class:"summary-value"},Ms={class:"summary-note"},Bs={class:"summary-card highlight"},Is={class:"summary-value"},Os={class:"summary-note"},xs={class:"summary-card neutral"},Ps={class:"summary-value"},As={class:"summary-note"},Fs={class:"filters-card"},Us={class:"filter-group"},Rs={class:"filter-group"},Ts={class:"filter-group"},zs=["value"],Ks={class:"filter-group"},Hs={class:"range-inputs"},qs={key:2,class:"expenses-content"},js={class:"table-card"},Ys={class:"table-header"},Gs={class:"table-caption"},Js={class:"table-responsive"},Qs={class:"data-table expenses-table"},Ws={key:0},Xs={"data-label":"Descrição"},Zs={class:"description-cell"},sa={key:0,class:"description-note"},aa={"data-label":"Categoria"},ta={"data-label":"Valor",class:"text-end"},ea={"data-label":"Data"},oa={"data-label":"Status"},la={class:"actions-col","data-label":"Ações"},ra=["onClick"],na=["onClick"],ia=["onClick"],ua={class:"insights-card"},da={class:"insights-section"},ca={key:0,class:"insights-list"},va={class:"item-title"},pa={class:"item-sub"},_a={class:"item-meta"},fa={class:"item-note"},ga={key:1,class:"empty-note"},ma={class:"insights-section"},ya={key:0,class:"insights-list"},ba={class:"item-title"},ha={class:"item-sub"},ka={class:"item-meta"},Sa={class:"item-value neg"},wa={key:1,class:"empty-note"},Ca={class:"insights-section"},Da={key:0,class:"insights-list compact"},Ea={class:"item-title"},Na={class:"item-sub"},La={class:"item-meta"},Va={class:"item-value neg"},$a={key:1,class:"empty-note"},Ma={class:"modal-dialog"},Ba={class:"modal-content"},Ia={class:"modal-header"},Oa={class:"modal-body"},xa={class:"form-grid"},Pa={class:"form-group form-group-large"},Aa={class:"form-group form-group-large"},Fa={class:"form-group"},Ua={class:"form-group"},Ra={class:"form-group"},Ta={key:0,class:"form-error"},za={key:1,class:"form-success"},Ka={__name:"DespesasView",setup(Ha){const U=v([]),x=v(!1),N=v(""),L=v(!1),k=v(null),V=v(""),$=v("all"),M=v("all"),S=v(""),w=v(""),l=gs({descricao:"",categoria:"",valor:0,data:new Date().toISOString().slice(0,10),pago:!1}),f=v(""),b=v(""),G=()=>{const t=new Date;return t.setHours(0,0,0,0),t};function g(t){return(Number(t)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function R(t){if(!t)return"Sem data";const s=new Date(t);return Number.isNaN(s)?"Sem data":s.toLocaleDateString("pt-BR")}function J(t){return Number.isFinite(t)?`${(t*100).toFixed(1)}%`:"0%"}function Q(t){const s=new Date(t);return Number.isNaN(s)?null:`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`}function W(t){if(!t)return"--";const[s,e]=t.split("-"),u=new Date(Number(s),Number(e)-1,1);return Number.isNaN(u)?"--":u.toLocaleDateString("pt-BR",{month:"short",year:"numeric"})}function P(t){if(!t)return null;const s=new Date(t);return Number.isNaN(s)?null:(s.setHours(0,0,0,0),s)}const c=d(()=>U.value.map(t=>{const s=Number(t.valor||t.amount||0),e=t.data||t.pagamentoEm||"",u=P(e);let p="open";if(t.pago)p="paid";else if(u){const r=Math.ceil((u-G())/864e5);r<0?p="overdue":r===0?p="today":r<=7&&(p="soon")}return{...t,__valor:s,__date:u,__dateISO:u?u.toISOString().slice(0,10):"",__status:p,__categoryLabel:t.categoria||"Sem categoria",__monthKey:u?Q(u):null}})),X=d(()=>{const t=new Set;return c.value.forEach(s=>t.add(s.__categoryLabel)),Array.from(t).sort((s,e)=>s.localeCompare(e))}),A=d(()=>{const t=V.value.trim().toLowerCase(),s=$.value,e=M.value,u=S.value?P(S.value):null,p=w.value?P(w.value):null;return p&&p.setHours(23,59,59,999),c.value.filter(r=>!(t&&!`${r.descricao||""} ${r.categoria||""} ${r.fornecedor||""}`.toLowerCase().includes(t)||e!=="all"&&r.__categoryLabel!==e||u&&(!r.__date||r.__date<u)||p&&(!r.__date||r.__date>p)||s==="paid"&&!r.pago||s==="open"&&(r.pago||r.__status==="overdue"||r.__status==="soon"||r.__status==="today")||s==="overdue"&&r.__status!=="overdue"||s==="soon"&&r.__status!=="soon"&&r.__status!=="today")).sort((r,C)=>r.__date&&C.__date?C.__date-r.__date:r.__date?-1:C.__date?1:String(C.descricao||"").localeCompare(String(r.descricao||"")))}),T=d(()=>c.value.reduce((t,s)=>t+s.__valor,0)),Z=d(()=>c.value.filter(t=>t.pago).reduce((t,s)=>t+s.__valor,0)),ss=d(()=>c.value.filter(t=>!t.pago).reduce((t,s)=>t+s.__valor,0)),as=d(()=>c.value.filter(t=>t.pago).length),ts=d(()=>c.value.filter(t=>!t.pago).length),es=d(()=>c.value.filter(t=>t.__status==="overdue").reduce((t,s)=>t+s.__valor,0)),z=d(()=>{const t=T.value,s=new Map;return c.value.forEach(e=>{const u=s.get(e.__categoryLabel)||{categoria:e.__categoryLabel,valor:0};u.valor+=e.__valor,s.set(e.__categoryLabel,u)}),Array.from(s.values()).map(e=>({...e,perc:t?e.valor/t:0})).sort((e,u)=>u.valor-e.valor).slice(0,5)}),K=d(()=>c.value.filter(t=>t.__valor>0).sort((t,s)=>s.__valor-t.__valor).slice(0,5)),m=d(()=>{const t=new Map;return c.value.forEach(s=>{if(!s.__monthKey)return;const e=t.get(s.__monthKey)||{key:s.__monthKey,valor:0,count:0};e.valor+=s.__valor,e.count+=1,t.set(s.__monthKey,e)}),Array.from(t.values()).sort((s,e)=>s.key.localeCompare(e.key)).slice(-6).map(s=>({...s,label:W(s.key)}))}),os=d(()=>m.value.length?m.value.reduce((s,e)=>s+e.valor,0)/m.value.length:0),ls=d(()=>m.value.length?`Últimos ${m.value.length} meses`:"Sem histórico mensal");function rs(t){return t.pago?"status-paid":t.__status==="overdue"?"status-overdue":t.__status==="today"?"status-today":t.__status==="soon"?"status-soon":"status-open"}function ns(t){return t.pago?"Pago":t.__status==="overdue"?"Em atraso":t.__status==="today"?"Vence hoje":t.__status==="soon"?"Em breve":"Em aberto"}function is(t){return t.pago?"row-paid":t.__status==="overdue"?"row-overdue":t.__status==="today"?"row-today":""}function H(){l.descricao="",l.categoria="",l.valor=0,l.data=new Date().toISOString().slice(0,10),l.pago=!1,k.value=null,f.value="",b.value=""}function us(){H(),L.value=!0}function ds(t){k.value=t.id,l.descricao=t.descricao||"",l.categoria=t.categoria||"",l.valor=Number(t.valor||t.__valor||0),l.data=t.data||t.__dateISO||new Date().toISOString().slice(0,10),l.pago=!!t.pago,f.value="",b.value="",L.value=!0}function B(){L.value=!1}async function h(){x.value=!0,N.value="";try{U.value=await ks()}catch(t){N.value=(t==null?void 0:t.message)||"Erro ao carregar despesas"}finally{x.value=!1}}async function cs(){if(f.value="",b.value="",!l.descricao){f.value="Descrição é obrigatória.";return}const t={descricao:l.descricao,categoria:l.categoria,valor:Number(l.valor||0),data:l.data,pago:!!l.pago};try{k.value?await Y(k.value,t):await ws(t),b.value="Despesa salva com sucesso.",B(),H(),await h()}catch(s){f.value=(s==null?void 0:s.message)||"Erro ao salvar despesa."}}async function vs(t){try{if(!(t!=null&&t.id))return;await Y(t.id,{pago:!t.pago}),await h()}catch(s){f.value=(s==null?void 0:s.message)||"Erro ao atualizar status."}}async function ps(t){if(t!=null&&t.id&&confirm(`Confirma excluir a despesa "${t.descricao}"?`))try{await Ss(t.id),await h()}catch(s){f.value=(s==null?void 0:s.message)||"Erro ao excluir despesa."}}function _s(){V.value="",$.value="all",M.value="all",S.value="",w.value=""}return ms(async()=>{await h()}),(t,s)=>(n(),i("section",Cs,[a("header",Ds,[a("div",{class:"header-top"},[s[12]||(s[12]=a("div",{class:"header-copy"},[a("h2",null,"Despesas Operacionais"),a("p",null,"Centralize pagamentos, acompanhe categorias e identifique os maiores gastos.")],-1)),a("div",{class:"header-actions"},[a("button",{class:"btn btn-success",type:"button",onClick:us},[...s[10]||(s[10]=[a("i",{class:"fa-solid fa-plus"},null,-1),a("span",null,"Nova despesa",-1)])]),a("button",{class:"btn btn-ghost",type:"button",onClick:h},[...s[11]||(s[11]=[a("i",{class:"fa-solid fa-rotate"},null,-1),a("span",null,"Atualizar",-1)])])])]),a("div",Es,[a("div",{class:I(["summary-card warning",{critical:es.value>0}])},[s[13]||(s[13]=a("span",{class:"summary-label"},"Total registrado",-1)),a("strong",Ns,o(g(T.value)),1),a("span",Ls,o(c.value.length)+" lançamento(s)",1)],2),a("div",Vs,[s[14]||(s[14]=a("span",{class:"summary-label"},"Pagas",-1)),a("strong",$s,o(g(Z.value)),1),a("span",Ms,o(as.value)+" despesa(s)",1)]),a("div",Bs,[s[15]||(s[15]=a("span",{class:"summary-label"},"Pendentes",-1)),a("strong",Is,o(g(ss.value)),1),a("span",Os,o(ts.value)+" em aberto",1)]),a("div",xs,[s[16]||(s[16]=a("span",{class:"summary-label"},"Média mensal",-1)),a("strong",Ps,o(g(os.value)),1),a("span",As,o(ls.value),1)])])]),a("div",Fs,[a("div",Us,[s[17]||(s[17]=a("label",{for:"search"},"Buscar",-1)),_(a("input",{id:"search",type:"search",class:"form-control",placeholder:"Descrição, categoria ou fornecedor","onUpdate:modelValue":s[0]||(s[0]=e=>V.value=e)},null,512),[[y,V.value,void 0,{trim:!0}]])]),a("div",Rs,[s[19]||(s[19]=a("label",{for:"status"},"Status",-1)),_(a("select",{id:"status",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=e=>$.value=e)},[...s[18]||(s[18]=[ys('<option value="all" data-v-52b9ec4c>Todos</option><option value="open" data-v-52b9ec4c>Em aberto</option><option value="soon" data-v-52b9ec4c>Próximos 7 dias</option><option value="overdue" data-v-52b9ec4c>Atrasados</option><option value="paid" data-v-52b9ec4c>Pagos</option>',5)])],512),[[F,$.value]])]),a("div",Ts,[s[21]||(s[21]=a("label",{for:"category"},"Categoria",-1)),_(a("select",{id:"category",class:"form-control","onUpdate:modelValue":s[2]||(s[2]=e=>M.value=e)},[s[20]||(s[20]=a("option",{value:"all"},"Todas",-1)),(n(!0),i(D,null,E(X.value,e=>(n(),i("option",{key:e,value:e},o(e),9,zs))),128))],512),[[F,M.value]])]),a("div",Ks,[s[23]||(s[23]=a("label",{for:"range"},"Período",-1)),a("div",Hs,[_(a("input",{id:"range",type:"date",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=e=>S.value=e)},null,512),[[y,S.value]]),s[22]||(s[22]=a("span",null,"até",-1)),_(a("input",{type:"date",class:"form-control","onUpdate:modelValue":s[4]||(s[4]=e=>w.value=e)},null,512),[[y,w.value]])])]),a("div",{class:"filter-group"},[s[24]||(s[24]=a("label",null," ",-1)),a("button",{class:"btn btn-primary",type:"button",onClick:_s}," Limpar filtros ")])]),N.value?(n(),q(bs,{key:0,message:N.value,retry:h},null,8,["message"])):x.value?(n(),q(hs,{key:1,message:"Carregando despesas…"})):(n(),i("div",qs,[a("div",js,[a("div",Ys,[s[25]||(s[25]=a("h3",null,"Planilha de Despesas",-1)),a("span",Gs,o(A.value.length)+" registro(s)",1)]),a("div",Js,[a("table",Qs,[s[30]||(s[30]=a("thead",null,[a("tr",null,[a("th",null,"Descrição"),a("th",null,"Categoria"),a("th",{class:"text-end"},"Valor"),a("th",null,"Data"),a("th",null,"Status"),a("th",{class:"actions-col"},"Ações")])],-1)),a("tbody",null,[A.value.length?O("",!0):(n(),i("tr",Ws,[...s[26]||(s[26]=[a("td",{colspan:"6",class:"empty-row"},"Nenhuma despesa encontrada para os filtros selecionados.",-1)])])),(n(!0),i(D,null,E(A.value,e=>(n(),i("tr",{key:e.id||`${e.descricao}-${e.__dateISO}`,class:I(is(e))},[a("td",Xs,[a("div",Zs,[a("strong",null,o(e.descricao||"Despesa sem descrição"),1),e.observacao?(n(),i("span",sa,o(e.observacao),1)):O("",!0)])]),a("td",aa,o(e.categoria||"Sem categoria"),1),a("td",ta,o(g(e.__valor)),1),a("td",ea,o(R(e.data||e.__dateISO)),1),a("td",oa,[a("span",{class:I(["status-pill",rs(e)])},o(ns(e)),3)]),a("td",la,[a("button",{class:"btn-icon btn-success",title:"Marcar pago",onClick:u=>vs(e)},[...s[27]||(s[27]=[a("i",{class:"fa-solid fa-check"},null,-1)])],8,ra),a("button",{class:"btn-icon btn-warning",title:"Editar",onClick:u=>ds(e)},[...s[28]||(s[28]=[a("i",{class:"fa-solid fa-pen"},null,-1)])],8,na),a("button",{class:"btn-icon btn-danger",title:"Excluir",onClick:u=>ps(e)},[...s[29]||(s[29]=[a("i",{class:"fa-solid fa-trash"},null,-1)])],8,ia)])],2))),128))])])])]),a("aside",ua,[a("div",da,[s[31]||(s[31]=a("h4",null,"Top categorias",-1)),z.value.length?(n(),i("ul",ca,[(n(!0),i(D,null,E(z.value,e=>(n(),i("li",{key:`cat-${e.categoria}`},[a("div",null,[a("span",va,o(e.categoria),1),a("span",pa,o(g(e.valor)),1)]),a("div",_a,[a("span",fa,o(J(e.perc)),1)])]))),128))])):(n(),i("p",ga,"Cadastre despesas para visualizar categorias relevantes."))]),a("div",ma,[s[32]||(s[32]=a("h4",null,"Maiores despesas",-1)),K.value.length?(n(),i("ul",ya,[(n(!0),i(D,null,E(K.value,e=>(n(),i("li",{key:`high-${e.id||e.__dateISO||e.descricao}`},[a("div",null,[a("span",ba,o(e.descricao||"Sem descrição"),1),a("span",ha,o(R(e.data||e.__dateISO)),1)]),a("div",ka,[a("span",Sa,o(g(e.__valor)),1)])]))),128))])):(n(),i("p",wa,"Nenhuma despesa registrada."))]),a("div",Ca,[s[33]||(s[33]=a("h4",null,"Resumo mensal",-1)),m.value.length?(n(),i("ul",Da,[(n(!0),i(D,null,E(m.value,e=>(n(),i("li",{key:e.key},[a("div",null,[a("span",Ea,o(e.label),1),a("span",Na,o(e.count)+" lançamento(s)",1)]),a("div",La,[a("span",Va,o(g(e.valor)),1)])]))),128))])):(n(),i("p",$a,"Sem histórico suficiente para compor o gráfico mensal."))])])])),a("div",{class:I(["modal",{show:L.value}]),role:"dialog","aria-hidden":"true",onClick:j(B,["self"])},[a("div",Ma,[a("div",Ba,[a("div",Ia,[a("h3",null,o(k.value?"Editar despesa":"Nova despesa"),1),a("button",{type:"button",class:"btn-close",onClick:B,"aria-label":"Fechar"},[...s[34]||(s[34]=[a("i",{class:"fa-solid fa-times"},null,-1)])])]),a("form",{onSubmit:j(cs,["prevent"])},[a("div",Oa,[a("div",xa,[a("div",Pa,[s[35]||(s[35]=a("label",{for:"descricao"},"Descrição",-1)),_(a("input",{id:"descricao",class:"form-control","onUpdate:modelValue":s[5]||(s[5]=e=>l.descricao=e),required:""},null,512),[[y,l.descricao,void 0,{trim:!0}]])]),a("div",Aa,[s[36]||(s[36]=a("label",{for:"categoria"},"Categoria",-1)),_(a("input",{id:"categoria",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=e=>l.categoria=e),placeholder:"Ex: Aluguel, Impostos"},null,512),[[y,l.categoria,void 0,{trim:!0}]])]),a("div",Fa,[s[37]||(s[37]=a("label",{for:"valor"},"Valor (R$)",-1)),_(a("input",{id:"valor",type:"number",min:"0",step:"0.01",class:"form-control","onUpdate:modelValue":s[7]||(s[7]=e=>l.valor=e)},null,512),[[y,l.valor,void 0,{number:!0}]])]),a("div",Ua,[s[38]||(s[38]=a("label",{for:"data"},"Data",-1)),_(a("input",{id:"data",type:"date",class:"form-control","onUpdate:modelValue":s[8]||(s[8]=e=>l.data=e)},null,512),[[y,l.data]])]),a("div",Ra,[s[40]||(s[40]=a("label",{for:"pago"},"Pago",-1)),_(a("select",{id:"pago",class:"form-control","onUpdate:modelValue":s[9]||(s[9]=e=>l.pago=e)},[...s[39]||(s[39]=[a("option",{value:!1},"Não",-1),a("option",{value:!0},"Sim",-1)])],512),[[F,l.pago]])])]),f.value?(n(),i("p",Ta,o(f.value),1)):O("",!0),b.value?(n(),i("p",za,o(b.value),1)):O("",!0)]),a("div",{class:"modal-footer"},[a("button",{type:"button",class:"btn btn-secondary",onClick:B},"Cancelar"),s[41]||(s[41]=a("button",{type:"submit",class:"btn btn-success"},"Salvar",-1))])],32)])])],2)]))}},Ja=fs(Ka,[["__scopeId","data-v-52b9ec4c"]]);export{Ja as default};
