import{s as l}from"./index-CXM7zIvA.js";function h(n,t=0){const o=n&&typeof n=="object"?{...n}:{},s=o.pid??o.pointId??o.id??n,i=s!=null?Number(s):null,a=!!(o.entregue??o.delivered??o.visited??!1),r=o.chegada??o.arrival??o.arrivedAt??null,e=o.saida??o.departure??o.leftAt??null,u=(o.status||"").toString().toLowerCase();let d=null;return u&&(["visitado","visited","concluido","concluida","finalizado","finalizada","feito","entregue"].includes(u)?d="visited":["pulado","skipped","ignorado"].includes(u)?d="skipped":["in_place","em_andamento","em_progresso","chegada"].includes(u)?d="in_place":["pendente","pending","aguardando"].includes(u)&&(d="pending")),d||(a?d="visited":r&&!e?d="in_place":r&&e?d="skipped":d="pending"),{...o,pid:i,pointId:i,chegada:r,saida:e,entregue:a,status:d,idx:t}}function f(n){if(!n)return n;const o=(Array.isArray(n.checkpoints)?n.checkpoints:Array.isArray(n.checkPoints)?n.checkPoints:[]).map((r,e)=>h(r,e)),s=o.map(r=>({pointId:r.pointId,status:r.status,idx:r.idx})),i=Array.isArray(n.loadItems)?n.loadItems.map(r=>({productId:(r==null?void 0:r.productId)??(r==null?void 0:r.produtoId)??(r==null?void 0:r.idProduto)??null,productName:(r==null?void 0:r.productName)??(r==null?void 0:r.nomeProduto)??(r==null?void 0:r.nome)??null,quantity:Number((r==null?void 0:r.quantity)??(r==null?void 0:r.qtd)??0)||0})).filter(r=>r.productId!=null&&r.quantity>0):[],a=(()=>{const r=(n.status||"").toString().toLowerCase();return r||(n.fimReal||n.finishedAt||n.completedAt?"completed":"in_progress")})();return{...n,checkpoints:o,points:s,loadItems:i,status:a}}async function k(n=null,t=null){const o=await l("/route-executions");return(Array.isArray(o)?o:[]).map(f).filter(i=>(!n||String(i.routeId)===String(n))&&(!t||(t==="in_progress"?!i.fimReal:t==="completed"?!!i.fimReal:!0)))}async function A(n){const t=await l(`/route-executions/${n}`);return f(t)}function p(n){if(n==null)return null;if(typeof n=="object"){const o=n.id??n.pointId??n.pid??n.value??n.codigo??n.codigoId;return p(o)}const t=Number(n);if(Number.isFinite(t))return t;if(typeof n=="string"){const o=n.trim();if(!o)return null;const s=Number(o);return Number.isFinite(s)?s:null}return null}function w(n){if(!Array.isArray(n))return[];const t=[];return n.forEach(o=>{const s=p(o);s!=null&&t.push(s)}),t}async function b({routeId:n,driver:t=null,vehicle:o=null,startedAt:s=null,loadItems:i=[]}){if(!n)throw new Error("routeId é obrigatório para iniciar uma execução");const a=await l(`/routes/${n}`),r=Array.isArray(a==null?void 0:a.clientes)?a.clientes:Array.isArray(a==null?void 0:a.pontos)?a.pontos:[],e=w(r),u={motorista:t||null,veiculo:o||null,inicioPrevisto:s||null},d=Array.isArray(i)?i.map(c=>({productId:p((c==null?void 0:c.productId)??(c==null?void 0:c.id)??(c==null?void 0:c.produtoId)),quantity:Number((c==null?void 0:c.quantity)??0)||0})).filter(c=>c.productId!=null&&c.quantity>0):[],y={routeId:p(n)??p(a==null?void 0:a.id)??n,driver:t,vehicle:o,prevInicio:s,checkpoints:e,metadata:u,loadItems:d},g=await l("/route-executions",{method:"POST",body:JSON.stringify(y)});return f(g)}async function x(n){const t=await l(`/route-executions/${n}/finish`,{method:"POST"});return f(t)}async function P(n,t,o,s=null){const i=await A(n),r=(Array.isArray(i==null?void 0:i.checkpoints)?i.checkpoints:[]).findIndex(u=>String(u.pid??u.pointId)===String(t));if(r<0)throw new Error("Ponto não encontrado na execução");let e;if(o==="visited"){await l(`/route-executions/${n}/arrival/${r}`,{method:"POST"});const u=JSON.stringify(s&&typeof s=="object"?s:{});e=await l(`/route-executions/${n}/deliver/${r}`,{method:"POST",body:u})}else o==="skipped"?(await l(`/route-executions/${n}/arrival/${r}`,{method:"POST"}),e=await l(`/route-executions/${n}/departure/${r}`,{method:"POST"})):e=i;return f(e)}export{P as a,x as c,A as g,k as l,b as s};
