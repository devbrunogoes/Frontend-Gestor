import{r,c as x,o as L,a as p,b as i,f as o,B,e as M,m as w,v as E,C as U,h as R,t as s,F as j,g as P,G as T}from"./index-IzLOKglm.js";import{l as $}from"./receivables-DjFeXSt8.js";import{l as A}from"./expenses-Dw-_t_jz.js";import{B as z,a as O}from"./BaseError-DNv4Myx8.js";/* empty css                                                                  */const Y={class:"content-area"},G={class:"page-header",style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"1rem"}},q={class:"page-actions",style:{display:"flex",gap:".5rem","flex-wrap":"wrap","align-items":"center"}},H=["disabled"],I=["disabled"],J={key:2,class:"card",style:{"margin-bottom":"1rem",display:"flex",gap:"1rem","flex-wrap":"wrap"}},K={key:3,class:"table-wrap"},Q={class:"data-table"},oe={__name:"RelatorioFinanceiroView",setup(W){const k=r([]),h=r([]),u=r(!1),c=r(""),v=r(""),m=r(""),f=r("");function F(l){try{return l?new Date(l).toLocaleDateString():"-"}catch{return"-"}}function b(l){try{const a=new Date(l);return isNaN(a)?null:a}catch{return null}}function S(l){const a=b(l);if(!a)return!0;if(v.value){const e=b(v.value);if(e&&a<new Date(e.getFullYear(),e.getMonth(),e.getDate()))return!1}if(m.value){const e=b(m.value);if(e&&a>new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999))return!1}return!0}const d=x(()=>{const l=(k.value||[]).map(t=>({_key:"rec-"+(t.id||Math.random()),tipo:"Receita",data:t.data||t.vencimento||t.venceEm||t.createdAt,descricao:t.descricao||t.description||t.cliente||t.clienteNome||"-",valor:Number(t.valor||t.amount||0),pago:!!(t.pago||t.paid)})),a=(h.value||[]).map(t=>({_key:"des-"+(t.id||Math.random()),tipo:"Despesa",data:t.data||t.pagamentoEm||t.createdAt,descricao:t.descricao||t.description||"-",valor:Number(t.valor||t.amount||0),pago:!!(t.pago||t.paid)}));let e=[...l,...a];return e=e.filter(t=>S(t.data)),f.value==="true"&&(e=e.filter(t=>t.pago)),f.value==="false"&&(e=e.filter(t=>!t.pago)),e.sort((t,g)=>new Date(g.data||0)-new Date(t.data||0)),e}),N=x(()=>d.value.filter(l=>l.tipo==="Receita").reduce((l,a)=>l+Number(a.valor||0),0)),V=x(()=>d.value.filter(l=>l.tipo==="Despesa").reduce((l,a)=>l+Number(a.valor||0),0));async function y(){u.value=!0,c.value="";try{k.value=await $(),h.value=await A()}catch(l){c.value=(l==null?void 0:l.message)||"Erro ao carregar dados financeiros"}finally{u.value=!1}}function _(){const l=["Tipo","Data","Descrição","Valor","Status"],a=d.value.map(n=>[n.tipo,F(n.data),n.descricao,Number(n.valor||0).toFixed(2),n.pago?"Pago":"Pendente"]),e=[l.join(","),...a.map(n=>n.map(C=>'"'+String(C).replace(/"/g,'""')+'"').join(","))].join(`
`),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(t),D=document.createElement("a");D.href=g,D.download="relatorio-financeiro.csv",D.click(),URL.revokeObjectURL(g)}return L(y),(l,a)=>(i(),p("section",Y,[o("div",G,[a[4]||(a[4]=o("h2",{style:{margin:"0"}},"Relatório Financeiro",-1)),o("div",q,[w(o("input",{class:"form-control",type:"date","onUpdate:modelValue":a[0]||(a[0]=e=>v.value=e)},null,512),[[E,v.value]]),w(o("input",{class:"form-control",type:"date","onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e)},null,512),[[E,m.value]]),w(o("select",{class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e)},[...a[3]||(a[3]=[o("option",{value:""},"Todos",-1),o("option",{value:"true"},"Pagos",-1),o("option",{value:"false"},"Pendentes",-1)])],512),[[U,f.value]]),o("button",{class:"btn btn-secondary",onClick:y,disabled:u.value},"Atualizar",8,H),o("button",{class:"btn btn-outline",onClick:_,disabled:!d.value.length},"Exportar CSV",8,I)])]),c.value?(i(),B(z,{key:0,message:c.value,retry:y},null,8,["message"])):u.value?(i(),B(O,{key:1,message:"Carregando financeiro…"})):(i(),p("div",J,[o("div",null,[a[5]||(a[5]=o("strong",null,"Receitas:",-1)),R(" R$ "+s(N.value.toFixed(2)),1)]),o("div",null,[a[6]||(a[6]=o("strong",null,"Despesas:",-1)),R(" R$ "+s(V.value.toFixed(2)),1)]),o("div",null,[a[7]||(a[7]=o("strong",null,"Saldo:",-1)),R(" R$ "+s((N.value-V.value).toFixed(2)),1)])])),!u.value&&!c.value?(i(),p("div",K,[o("table",Q,[a[8]||(a[8]=o("thead",null,[o("tr",null,[o("th",null,"Tipo"),o("th",null,"Data"),o("th",null,"Descrição"),o("th",null,"Valor"),o("th",null,"Status")])],-1)),o("tbody",null,[(i(!0),p(j,null,P(d.value,e=>(i(),p("tr",{key:e._key},[o("td",null,s(e.tipo),1),o("td",null,s(F(e.data)),1),o("td",null,s(e.descricao),1),o("td",{style:T({color:e.tipo==="Despesa"?"#dc3545":"inherit"})},s(e.tipo==="Despesa"?"-":"")+"R$ "+s(Number(e.valor||0).toFixed(2)),5),o("td",null,s(e.pago?"Pago":"Pendente"),1)]))),128))])])])):M("",!0)]))}};export{oe as default};
