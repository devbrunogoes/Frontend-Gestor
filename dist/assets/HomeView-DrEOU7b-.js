import{C as w,B as E,a as O,L as j,p as R,b as $,c as P,A as F,D as H}from"./index-BIhj-tPT.js";import{r as m,c as N,o as B,a as i,b as d,d as D,e as x,u as V,F as L,_ as M,f as e,t as v,g as T,n as J}from"./index-CXM7zIvA.js";import{_ as z}from"./TopProducts-D5u78SxK.js";import{l as I}from"./clients-BkLJVsW5.js";import{l as Y}from"./products-DXxYyzcf.js";import{l as Q}from"./sales-BoYCHADK.js";const W={key:0,style:{opacity:".7","margin-top":".25rem"}},Z={__name:"SalesByDay",setup(q){w.register(E,O,j,R,$);const u=m([]);function p(a,t="[]"){try{return JSON.parse(localStorage.getItem(a)||t)}catch{return JSON.parse(t)}}function g(a){const t=[],n=new Date;for(let s=a-1;s>=0;s--){const r=new Date(n);r.setDate(n.getDate()-s),t.push(r)}return t}function h(a){return(Number(a)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}const l=m([]),y=m([]),b=N(()=>(y.value||[]).some(a=>Number(a)>0)),S=N(()=>({labels:l.value,datasets:[{label:"Total de vendas",data:y.value,backgroundColor:"rgba(13,110,253,0.5)",borderColor:"#0d6efd",borderWidth:1}]})),_={responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:a=>h(a)}}}};function c(){u.value=Array.isArray(p("vendas"))?p("vendas"):[];const a=g(7);l.value=a.map(t=>t.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})),y.value=a.map(t=>{const n=t.toDateString();return u.value.filter(s=>new Date(s.date||s.data||s.createdAt).toDateString()===n).reduce((s,r)=>s+(typeof r.total=="number"?r.total:Number(r.total)||0),0)})}return B(c),(a,t)=>(d(),i(L,null,[D(V(P),{data:S.value,options:_},null,8,["data"]),b.value?x("",!0):(d(),i("div",W,"Sem dados de vendas nos últimos 7 dias."))],64))}},G={key:0,style:{opacity:".7","margin-top":".25rem"}},K={__name:"SalesByOrigin",setup(q){w.register(F,R,$);function u(_,c="[]"){try{return JSON.parse(localStorage.getItem(_)||c)}catch{return JSON.parse(c)}}const p=m([]),g=m([]),h=["#0d6efd","#ffc107","#20c997","#6f42c1","#dc3545","#6c757d"],l=N(()=>({labels:p.value,datasets:[{data:g.value,backgroundColor:h.slice(0,Math.max(3,p.value.length))}]})),y={plugins:{legend:{position:"bottom"}}},b=N(()=>(g.value||[]).some(_=>Number(_)>0));function S(){const c=(Array.isArray(u("vendas"))?u("vendas"):[]).reduce((t,n)=>{const s=(n.origem||"sistema").toLowerCase();return t[s]=(t[s]||0)+1,t},{}),a=Object.keys(c).length?Object.keys(c):["sistema","rota"];p.value=a,g.value=a.map(t=>c[t]||0)}return B(S),(_,c)=>(d(),i(L,null,[D(V(H),{data:l.value,options:y},null,8,["data"]),b.value?x("",!0):(d(),i("div",G,"Sem dados de origem de vendas."))],64))}},U={class:"content-area"},X={class:"dashboard-cards metrics-grid"},tt={class:"card metric-card"},et={class:"card-content"},at={class:"card-value"},st={class:"card metric-card"},ot={class:"card-content"},rt={class:"card-value"},nt={class:"card metric-card"},lt={class:"card-content"},ct={class:"card-value"},it={class:"alerts-card__header"},dt={class:"alerts-card__title"},ut={key:0,class:"helper"},mt={key:1,class:"helper muted"},pt=["disabled"],_t={key:0,class:"alerts-card__body"},vt={class:"alerts-list"},gt={class:"alert-pill__index"},yt={class:"alert-pill__message"},ht={key:1,class:"alerts-card__body"},ft={class:"charts-grid"},bt={class:"chart-card"},St={class:"chart-card"},Dt={class:"chart-card"},At={__name:"HomeView",setup(q){const u=m(!1),p=m(0),g=m(0),h=m(0),l=m([]);function y(a,t){return a.getFullYear()===t.getFullYear()&&a.getMonth()===t.getMonth()&&a.getDate()===t.getDate()}function b(a){try{return new Date(a)}catch{return null}}function S(a){const t=Number(a.total||a.valorTotal||a.amount||0);if(!isNaN(t)&&t>0)return t;const n=a.items||a.itens||[];return Array.isArray(n)&&n.length?n.reduce((s,r)=>{const A=Number(r.qtd||r.quantidade||r.quantity||0),o=Number(r.preco||r.price||r.valor||0);return s+A*o},0):0}function _(a){try{return a.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}catch{return`R$ ${Number(a||0).toFixed(2)}`}}async function c(){u.value=!0;try{const[a,t,n]=await Promise.all([I().catch(()=>[]),Y().catch(()=>[]),Q().catch(()=>[])]);p.value=Array.isArray(a)?a.length:0,g.value=Array.isArray(t)?t.length:0;const s=new Date,r=(Array.isArray(n)?n:[]).filter(o=>{const f=b(o.date||o.data||o.createdAt||o.dataVenda);return f?y(f,s):!1});h.value=r.reduce((o,f)=>o+S(f),0);const A=[];for(const o of Array.isArray(t)?t:[]){const f=o.name||o.nome||o.nomeProduto||"Produto",C=Number(o.stockQuantity??o.estoque??o.quantidadeEstoque??o.qtdEstoque??0),k=Number(o.minStock??o.estoqueMinimo??o.minimo??0);k>0&&C<=k&&A.push(`Produto "${f}" abaixo do estoque mínimo (${C} ≤ ${k}).`)}l.value=A}finally{u.value=!1}}return B(()=>{c()}),(a,t)=>(d(),i("section",U,[t[12]||(t[12]=e("h2",null,"Dashboard",-1)),e("div",X,[e("div",tt,[t[1]||(t[1]=e("i",{class:"fa-solid fa-users card-icon"},null,-1)),e("div",et,[t[0]||(t[0]=e("h3",null,"Clientes",-1)),e("p",at,v(p.value.toLocaleString("pt-BR")),1)])]),e("div",st,[t[3]||(t[3]=e("i",{class:"fa-solid fa-dolly card-icon"},null,-1)),e("div",ot,[t[2]||(t[2]=e("h3",null,"Produtos",-1)),e("p",rt,v(g.value.toLocaleString("pt-BR")),1)])]),e("div",nt,[t[5]||(t[5]=e("i",{class:"fa-solid fa-cash-register card-icon"},null,-1)),e("div",lt,[t[4]||(t[4]=e("h3",null,"Vendas Hoje",-1)),e("p",ct,v(_(h.value)),1)])])]),e("div",{class:J(["card alerts-card",{"alerts-card--empty":!l.value.length}])},[e("div",it,[e("div",dt,[t[7]||(t[7]=e("i",{class:"fa-solid fa-bell-exclamation"},null,-1)),e("div",null,[t[6]||(t[6]=e("h3",null,"Alertas de Estoque",-1)),l.value.length?(d(),i("p",ut,v(l.value.length)+" produto"+v(l.value.length>1?"s":"")+" precisa"+v(l.value.length>1?"m":"")+" de atenção",1)):(d(),i("p",mt,"Estoque sob controle no momento"))])]),e("button",{class:"btn btn-light",onClick:c,disabled:u.value},v(u.value?"Atualizando…":"Atualizar"),9,pt)]),l.value.length?(d(),i("div",_t,[e("div",vt,[(d(!0),i(L,null,T(l.value,(n,s)=>(d(),i("article",{key:s,class:"alert-pill"},[e("span",gt,"#"+v(s+1),1),e("p",yt,v(n),1)]))),128))])])):(d(),i("div",ht,[...t[8]||(t[8]=[e("div",{class:"alerts-card__empty"},[e("i",{class:"fa-regular fa-circle-check"}),e("p",null,"Nenhum alerta no momento.")],-1)])]))],2),e("div",ft,[e("div",bt,[t[9]||(t[9]=e("h3",null,"Vendas - últimos 7 dias",-1)),D(Z)]),e("div",St,[t[10]||(t[10]=e("h3",null,"Vendas por origem",-1)),D(K)]),e("div",Dt,[t[11]||(t[11]=e("h3",null,"Top 5 produtos por preço",-1)),D(z,{topN:5})])])]))}},wt=M(At,[["__scopeId","data-v-c0e936f7"]]);export{wt as default};
