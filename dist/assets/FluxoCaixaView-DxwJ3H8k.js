import{_ as Ft,r as w,z as Vt,D as pt,c as i,o as qt,a as d,b as u,f as s,B as mt,t as r,e as F,n as h,h as It,F as z,g as O,m as st,v as nt,d as Wt,u as zt,J as Ot}from"./index-IzLOKglm.js";import{B as Yt,a as jt}from"./BaseError-DNv4Myx8.js";import{l as Ut}from"./sales-5D-YZoeD.js";import{l as Qt}from"./expenses-Dw-_t_jz.js";import{l as Jt}from"./receivables-DjFeXSt8.js";import{C as Gt,a as Kt,L as Xt,d as Zt,e as te,f as ee,p as ae,b as se,i as ne,g as oe}from"./index-AE0sWP_c.js";/* empty css                                                                  */const le={class:"content-area cashflow-view"},re={class:"page-header cashflow-header"},ie={class:"header-copy"},ue={class:"header-summary"},de={class:"summary-card positive"},ce={class:"summary-value"},ve={class:"summary-note"},fe={class:"summary-card negative"},pe={class:"summary-value"},me={class:"summary-note"},ge={class:"summary-card highlight"},ye={class:"summary-value"},be={class:"summary-card neutral"},he={class:"summary-value"},we={class:"summary-note"},_e={class:"header-actions"},De={class:"quick-range-row"},ke=["onClick"],Ce={class:"header-dates"},Ne={class:"date-inputs"},xe={key:2,class:"cashflow-body"},Re={class:"main-column"},Se={class:"chart-card"},Ee={key:0,class:"chart-frame"},Te={key:1,class:"empty-note"},Be={class:"table-card"},Le={class:"table-header"},$e={class:"table-tools"},Ae={class:"search-field"},Me={class:"table-caption"},Pe={class:"table-responsive"},He={class:"data-table cashflow-table"},Fe={class:"text-end"},Ve={class:"text-end"},qe={class:"text-end"},Ie={class:"text-end"},We={key:0},ze={"data-label":"Data"},Oe={"data-label":"Entradas",class:"text-end"},Ye={"data-label":"Saídas",class:"text-end"},je={"data-label":"Resultado",class:"text-end"},Ue={"data-label":"Saldo acumulado",class:"text-end"},Qe={class:"insights-card"},Je={class:"insights-section"},Ge={class:"insights-list"},Ke={key:0},Xe={class:"item-sub"},Ze={class:"item-value"},ta={key:1},ea={class:"item-sub"},aa={class:"item-value neg"},sa={class:"item-sub"},na={class:"item-value"},oa={class:"insights-section"},la={key:0,class:"insights-list"},ra={class:"item-title"},ia={class:"item-sub"},ua={key:1,class:"empty-note"},da={key:2,class:"projection"},ca={class:"insights-section"},va={key:0,class:"insights-list compact"},fa={class:"item-title"},pa={class:"item-sub"},ma={class:"item-value"},ga={key:1,class:"empty-note"},gt=864e5,ya={__name:"FluxoCaixaView",setup(ba){Gt.register(Kt,Xt,Zt,te,ee,ae,se,ne);const Y=new Date;Y.setHours(0,0,0,0);const _=w(v(new Date(Y.getTime()-14*gt))),C=w(v(Y)),j=w(""),U=w([]),Q=w([]),J=w([]),G=w(!1),V=w(""),D=Vt({column:"date",direction:"desc"}),q=w("15"),I=w(!1),ot=[{key:"7",label:"Últimos 7 dias",resolve:()=>K(7)},{key:"15",label:"Últimos 15 dias",resolve:()=>K(15)},{key:"30",label:"Últimos 30 dias",resolve:()=>K(30)},{key:"mtd",label:"Mês atual",resolve:()=>yt()},{key:"ytd",label:"Ano atual",resolve:()=>bt()}];function v(e){const t=new Date(e);return t.setHours(0,0,0,0),t.toISOString().slice(0,10)}function K(e){const t=new Date;t.setHours(0,0,0,0);const a=new Date(t);return a.setDate(a.getDate()-(e-1)),{start:v(a),end:v(t)}}function yt(){const e=new Date;e.setHours(0,0,0,0);const t=new Date(e.getFullYear(),e.getMonth(),1);return{start:v(t),end:v(e)}}function bt(){const e=new Date;e.setHours(0,0,0,0);const t=new Date(e.getFullYear(),0,1);return{start:v(t),end:v(e)}}function ht(e){const t=ot.find(c=>c.key===e);if(!t)return;const{start:a,end:n}=t.resolve();!a||!n||(I.value=!0,_.value=a,C.value=n,q.value=e,Ot(()=>{I.value=!1}))}pt(_,e=>{if(!e)return;const t=g(e),a=g(C.value);t&&a&&t>a&&(C.value=e),I.value||(q.value="custom")}),pt(C,e=>{if(!e)return;const t=g(e),a=g(_.value);a&&t&&t<a&&(_.value=e),I.value||(q.value="custom")});function g(e){if(!e)return null;const t=new Date(`${e}T00:00:00`);return Number.isNaN(t.getTime())?null:t}function R(e){if(!e)return null;if(e instanceof Date){const t=new Date(e);return t.setHours(0,0,0,0),t}if(typeof e=="number"){const t=new Date(e);return Number.isNaN(t.getTime())?null:(t.setHours(0,0,0,0),t)}if(typeof e=="string"){if(/^\d{4}-\d{2}-\d{2}$/.test(e)){const a=new Date(`${e}T00:00:00`);if(!Number.isNaN(a.getTime()))return a}const t=new Date(e);if(!Number.isNaN(t.getTime()))return t.setHours(0,0,0,0),t}return null}function wt(e,t){const a=g(e),n=g(t);if(!a||!n||n<a)return[];const c=[],l=new Date(a);for(;l<=n;)c.push(v(l)),l.setDate(l.getDate()+1);return c}function E(e,t,a){return e instanceof Date&&e>=t&&e<=a}function T(e){const t=Number(e);return Number.isFinite(t)?t:0}function lt(e){if(e==null)return!1;if(e.pago)return!0;const t=(e.paymentStatus??e.status??"").toString().toLowerCase();return t.includes("pago")||t.includes("paid")}function rt(e){if(e==null)return!1;if(e.pago)return!0;const t=(e.status??"").toString().toLowerCase();return t.includes("pago")||t.includes("liquidado")||t.includes("received")}function it(e){if(e==null)return!1;if(e.pago)return!0;const t=(e.status??"").toString().toLowerCase();return t.includes("pago")||t.includes("paga")||t.includes("quitado")}function ut(e,t){const a=g(e),n=g(t);if(!a||!n||n<a)return[];const c=wt(e,t);if(!c.length)return[];const l=new Map;c.forEach(o=>{l.set(o,{inflow:0,outflow:0})});const k=new Date(a),N=new Date(n);k.setHours(0,0,0,0),N.setHours(23,59,59,999),U.value.forEach(o=>{if(!lt(o))return;const y=T(o.total??o.valorTotal??o.valor??0);if(!y)return;const m=R(o.paymentDate??o.dataPagamento??o.dataRecebimento??o.date??o.data??o.createdAt);if(!m||!E(m,k,N))return;const b=v(m);if(!l.has(b))return;const x=l.get(b);x.inflow+=y}),J.value.forEach(o=>{if(!rt(o))return;const y=T(o.valor??o.total??o.amount??0);if(!y)return;const m=R(o.dataPagamento??o.dataRecebimento??o.dataLiquidacao??o.vencimento??o.data);if(!m||!E(m,k,N))return;const b=v(m);if(!l.has(b))return;const x=l.get(b);x.inflow+=y}),Q.value.forEach(o=>{if(!it(o))return;const y=T(o.valor??o.total??o.amount??0);if(!y)return;const m=R(o.dataPagamento??o.dataBaixa??o.data??o.vencimento??o.createdAt);if(!m||!E(m,k,N))return;const b=v(m);if(!l.has(b))return;const x=l.get(b);x.outflow+=y});const W=[];let L=0;return c.forEach(o=>{const y=l.get(o)??{inflow:0,outflow:0},m=y.inflow,b=y.outflow,x=m-b;L+=x,W.push({date:o,inflow:m,outflow:b,net:x,cumulative:L})}),W}const f=i(()=>ut(_.value,C.value)),S=i(()=>f.value.length),_t=i(()=>f.value.reduce((e,t)=>e+t.inflow,0)),Dt=i(()=>f.value.reduce((e,t)=>e+t.outflow,0)),X=i(()=>f.value.reduce((e,t)=>e+t.net,0)),kt=i(()=>S.value?X.value/S.value:0),Ct=i(()=>f.value.filter(e=>e.inflow>0).length),Nt=i(()=>f.value.filter(e=>e.outflow>0).length),xt=i(()=>f.value.filter(e=>e.net>0).length),Rt=i(()=>f.value.filter(e=>e.net<0).length),St=i(()=>{if(!S.value)return{start:"",end:""};const e=g(_.value);if(!e)return{start:"",end:""};const t=new Date(e.getTime()-gt),a=new Date(t);return a.setDate(a.getDate()-(S.value-1)),{start:v(a),end:v(t)}}),Et=i(()=>{const{start:e,end:t}=St.value;return!e||!t?[]:ut(e,t)}),$=i(()=>Et.value.reduce((e,t)=>e+t.net,0)),A=i(()=>X.value-$.value),dt=i(()=>!$.value||!Number.isFinite($.value)||$.value===0?null:A.value/Math.abs($.value)*100),Tt=i(()=>A.value>0?"fa-arrow-trend-up":A.value<0?"fa-arrow-trend-down":"fa-minus"),Bt=i(()=>A.value>0?"note-positive":A.value<0?"note-negative":"note-neutral"),ct=i(()=>{if(dt.value==null)return S.value?"Sem histórico comparável":"";const e=dt.value;return Number.isFinite(e)?e===0?"Igual ao período anterior":`${e>0?"+":""}${e.toFixed(1)}% vs período anterior`:""}),Z=i(()=>f.value.filter(e=>e.net>0).sort((e,t)=>t.net-e.net)[0]||null),tt=i(()=>f.value.filter(e=>e.outflow>0).sort((e,t)=>t.outflow-e.outflow)[0]||null),Lt=i(()=>{const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);return t.setDate(t.getDate()+7),J.value.filter(a=>!rt(a)).map(a=>{const n=R(a.vencimento??a.dataPrevista??a.data??a.createdAt);return{id:a.id??a.codigo??a.identificador??Math.random(),date:n,valor:T(a.valor??a.total??a.amount??0),label:a.descricao??a.titulo??a.nomeCliente??"Recebimento"}}).filter(a=>a.date&&E(a.date,e,t)).sort((a,n)=>a.date-n.date)}),$t=i(()=>{const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);return t.setDate(t.getDate()+7),Q.value.filter(a=>!it(a)).map(a=>{const n=R(a.vencimento??a.dataPrevista??a.data??a.createdAt);return{id:a.id??a.codigo??a.identificador??Math.random(),date:n,valor:T(a.valor??a.total??a.amount??0),label:a.descricao??a.categoria??a.fornecedor??"Despesa"}}).filter(a=>a.date&&E(a.date,e,t)).sort((a,n)=>a.date-n.date)}),M=i(()=>{const e=Lt.value.map((a,n)=>({key:`in-${a.id}-${n}`,label:a.label,date:v(a.date),value:a.valor,type:"in"})),t=$t.value.map((a,n)=>({key:`out-${a.id}-${n}`,label:a.label,date:v(a.date),value:a.valor,type:"out"}));return[...e,...t].sort((a,n)=>a.date.localeCompare(n.date)).slice(0,6)}),vt=i(()=>{const e=M.value.filter(a=>a.type==="in").reduce((a,n)=>a+n.value,0),t=M.value.filter(a=>a.type==="out").reduce((a,n)=>a+n.value,0);return e-t}),ft=i(()=>{const e=g(_.value),t=g(C.value);if(!e||!t||t<e)return[];const a=new Date(e),n=new Date(t);n.setHours(23,59,59,999);const c=new Map;return U.value.forEach(l=>{if(!lt(l))return;const k=R(l.paymentDate??l.dataPagamento??l.dataRecebimento??l.date??l.data??l.createdAt);if(!k||!E(k,a,n))return;const N=l.cliente??l.nomeCliente??l.customerName??"Cliente não informado",W=T(l.total??l.valorTotal??l.valor??0),L=c.get(N)??{nome:N,count:0,valor:0};L.count+=1,L.valor+=W,c.set(N,L)}),Array.from(c.values()).sort((l,k)=>k.valor-l.valor).slice(0,5)}),et=i(()=>{const e=j.value.trim().toLowerCase();let t=f.value;return e&&(t=t.filter(a=>{const n=B(a.date).toLowerCase();return a.date.includes(e)||n.includes(e)})),At(t)});function At(e){const t=D.column,a=D.direction==="desc"?-1:1;return[...e].sort((n,c)=>{switch(t){case"inflow":return(n.inflow-c.inflow)*a;case"outflow":return(n.outflow-c.outflow)*a;case"net":return(n.net-c.net)*a;case"cumulative":return(n.cumulative-c.cumulative)*a;case"date":default:return n.date.localeCompare(c.date)*a}})}function P(e){["date","inflow","outflow","net","cumulative"].includes(e)&&(D.column===e?D.direction=D.direction==="asc"?"desc":"asc":(D.column=e,D.direction=e==="date"?"desc":"asc"))}function H(e){return D.column!==e?"fa-sort":D.direction==="asc"?"fa-sort-up":"fa-sort-down"}function Mt(e){return e.net>0?"row-positive":e.net<0?"row-negative":""}function p(e){return(Number(e)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function B(e){const t=R(e);return t?t.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"}):"Sem data"}const Pt=i(()=>({labels:f.value.map(t=>B(t.date)),datasets:[{label:"Saldo acumulado",data:f.value.map(t=>t.cumulative),borderColor:"#0d6efd",backgroundColor:"rgba(13, 110, 253, 0.18)",tension:.25,fill:!0,borderWidth:2},{label:"Entradas",data:f.value.map(t=>t.inflow),borderColor:"#16a34a",backgroundColor:"rgba(34, 197, 94, 0.2)",tension:.2,pointRadius:0,borderWidth:1.5},{label:"Saídas",data:f.value.map(t=>t.outflow*-1),borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.18)",tension:.2,pointRadius:0,borderWidth:1.5}]})),Ht=i(()=>({responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top"},tooltip:{callbacks:{label(e){const t=e.dataset.label??"",a=e.parsed.y??0;return`${t}: ${p(a)}`}}}},scales:{x:{grid:{display:!1}},y:{ticks:{callback(e){return p(e)}}}}}));async function at(){G.value=!0,V.value="";try{const[e,t,a]=await Promise.all([Ut(),Qt(),Jt()]);U.value=Array.isArray(e)?e:[],Q.value=Array.isArray(t)?t:[],J.value=Array.isArray(a)?a:[]}catch(e){V.value=(e==null?void 0:e.message)||"Erro ao carregar fluxo de caixa."}finally{G.value=!1}}return qt(at),(e,t)=>(u(),d("section",le,[s("header",re,[s("div",ie,[t[12]||(t[12]=s("h2",null,"Fluxo de Caixa",-1)),t[13]||(t[13]=s("p",null,"Monitore entradas, saídas e tendências do caixa no período selecionado.",-1)),s("div",ue,[s("div",de,[t[8]||(t[8]=s("span",{class:"summary-label"},"Entradas",-1)),s("strong",ce,r(p(_t.value)),1),s("span",ve,r(Ct.value)+" dia(s) com recebimentos",1)]),s("div",fe,[t[9]||(t[9]=s("span",{class:"summary-label"},"Saídas",-1)),s("strong",pe,r(p(Dt.value)),1),s("span",me,r(Nt.value)+" dia(s) com pagamentos",1)]),s("div",ge,[t[10]||(t[10]=s("span",{class:"summary-label"},"Saldo do período",-1)),s("strong",ye,r(p(X.value)),1),ct.value?(u(),d("span",{key:0,class:h(["summary-note",Bt.value])},[s("i",{class:h(["fa-solid",Tt.value])},null,2),It(" "+r(ct.value),1)],2)):F("",!0)]),s("div",be,[t[11]||(t[11]=s("span",{class:"summary-label"},"Média diária",-1)),s("strong",he,r(p(kt.value)),1),s("span",we,r(S.value)+" dia(s) analisado(s)",1)])])]),s("div",_e,[s("div",De,[(u(),d(z,null,O(ot,a=>s("button",{key:a.key,type:"button",class:h(["quick-range-chip",{active:q.value===a.key}]),onClick:n=>ht(a.key)},r(a.label),11,ke)),64))]),s("div",Ce,[t[15]||(t[15]=s("label",null,"Período personalizado",-1)),s("div",Ne,[st(s("input",{type:"date",class:"form-control","onUpdate:modelValue":t[0]||(t[0]=a=>_.value=a)},null,512),[[nt,_.value]]),t[14]||(t[14]=s("span",null,"até",-1)),st(s("input",{type:"date",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=a=>C.value=a)},null,512),[[nt,C.value]])])]),s("button",{class:"btn btn-ghost",type:"button",onClick:at},[...t[16]||(t[16]=[s("i",{class:"fa-solid fa-rotate"},null,-1),s("span",null,"Atualizar dados",-1)])])])]),V.value?(u(),mt(Yt,{key:0,message:V.value,retry:at},null,8,["message"])):G.value?(u(),mt(jt,{key:1,message:"Carregando fluxo de caixa..."})):(u(),d("div",xe,[s("div",Re,[s("div",Se,[t[17]||(t[17]=s("div",{class:"chart-card-header"},[s("h3",null,"Saldo acumulado"),s("span",{class:"chart-caption"},"Entradas, saídas e saldo diário")],-1)),f.value.length?(u(),d("div",Ee,[Wt(zt(oe),{data:Pt.value,options:Ht.value},null,8,["data","options"])])):(u(),d("p",Te,"Cadastre vendas, recebimentos ou despesas para gerar o gráfico."))]),s("div",Be,[s("div",Le,[t[19]||(t[19]=s("h3",null,"Detalhamento diário",-1)),s("div",$e,[s("div",Ae,[t[18]||(t[18]=s("i",{class:"fa-solid fa-magnifying-glass"},null,-1)),st(s("input",{type:"search",class:"form-control",placeholder:"Buscar por data","onUpdate:modelValue":t[2]||(t[2]=a=>j.value=a)},null,512),[[nt,j.value,void 0,{trim:!0}]])]),s("span",Me,r(et.value.length)+" dia(s)",1)])]),s("div",Pe,[s("table",He,[s("thead",null,[s("tr",null,[s("th",null,[s("button",{type:"button",class:"sort-button",onClick:t[3]||(t[3]=a=>P("date"))},[t[20]||(t[20]=s("span",null,"Data",-1)),s("i",{class:h(["fa-solid",H("date")])},null,2)])]),s("th",Fe,[s("button",{type:"button",class:"sort-button",onClick:t[4]||(t[4]=a=>P("inflow"))},[t[21]||(t[21]=s("span",null,"Entradas",-1)),s("i",{class:h(["fa-solid",H("inflow")])},null,2)])]),s("th",Ve,[s("button",{type:"button",class:"sort-button",onClick:t[5]||(t[5]=a=>P("outflow"))},[t[22]||(t[22]=s("span",null,"Saídas",-1)),s("i",{class:h(["fa-solid",H("outflow")])},null,2)])]),s("th",qe,[s("button",{type:"button",class:"sort-button",onClick:t[6]||(t[6]=a=>P("net"))},[t[23]||(t[23]=s("span",null,"Resultado",-1)),s("i",{class:h(["fa-solid",H("net")])},null,2)])]),s("th",Ie,[s("button",{type:"button",class:"sort-button",onClick:t[7]||(t[7]=a=>P("cumulative"))},[t[24]||(t[24]=s("span",null,"Saldo acumulado",-1)),s("i",{class:h(["fa-solid",H("cumulative")])},null,2)])])])]),s("tbody",null,[et.value.length?F("",!0):(u(),d("tr",We,[...t[25]||(t[25]=[s("td",{colspan:"5",class:"empty-row"},"Nenhuma movimentação registrada no período.",-1)])])),(u(!0),d(z,null,O(et.value,a=>(u(),d("tr",{key:a.date,class:h(Mt(a))},[s("td",ze,r(B(a.date)),1),s("td",Oe,r(p(a.inflow)),1),s("td",Ye,r(p(a.outflow)),1),s("td",je,r(p(a.net)),1),s("td",Ue,r(p(a.cumulative)),1)],2))),128))])])])])]),s("aside",Qe,[s("div",Je,[t[29]||(t[29]=s("h4",null,"Resumo do período",-1)),s("ul",Ge,[Z.value?(u(),d("li",Ke,[s("div",null,[t[26]||(t[26]=s("span",{class:"item-title"},"Melhor dia",-1)),s("span",Xe,r(B(Z.value.date)),1)]),s("span",Ze,r(p(Z.value.net)),1)])):F("",!0),tt.value?(u(),d("li",ta,[s("div",null,[t[27]||(t[27]=s("span",{class:"item-title"},"Maior saída",-1)),s("span",ea,r(B(tt.value.date)),1)]),s("span",aa,r(p(tt.value.outflow)),1)])):F("",!0),s("li",null,[s("div",null,[t[28]||(t[28]=s("span",{class:"item-title"},"Dias positivos",-1)),s("span",sa,r(xt.value)+" de "+r(S.value),1)]),s("span",na,r(Rt.value)+" dia(s) negativos",1)])])]),s("div",oa,[t[31]||(t[31]=s("h4",null,"Próximos 7 dias",-1)),M.value.length?(u(),d("ul",la,[(u(!0),d(z,null,O(M.value,a=>(u(),d("li",{key:a.key},[s("div",null,[s("span",ra,r(a.label),1),s("span",ia,r(B(a.date)),1)]),s("span",{class:h(["item-value",{neg:a.type==="out"}])},r(p(a.value)),3)]))),128))])):(u(),d("p",ua,"Nenhum vencimento relevante para os próximos dias.")),M.value.length?(u(),d("div",da,[t[30]||(t[30]=s("span",null,"Projeção líquida",-1)),s("strong",{class:h({neg:vt.value<0})},r(p(vt.value)),3)])):F("",!0)]),s("div",ca,[t[32]||(t[32]=s("h4",null,"Clientes em destaque",-1)),ft.value.length?(u(),d("ul",va,[(u(!0),d(z,null,O(ft.value,a=>(u(),d("li",{key:a.nome},[s("div",null,[s("span",fa,r(a.nome),1),s("span",pa,r(a.count)+" venda(s)",1)]),s("span",ma,r(p(a.valor)),1)]))),128))])):(u(),d("p",ga,"Nenhuma venda registrada no período selecionado."))])])]))]))}},xa=Ft(ya,[["__scopeId","data-v-28cd7d3b"]]);export{xa as default};
