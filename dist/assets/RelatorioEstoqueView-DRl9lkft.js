import{r as m,c as w,o as N,a as u,b as a,f as e,B as x,e as _,m as h,v as B,p as C,h as k,t as r,F as M,g as S}from"./index-IzLOKglm.js";import{l as R}from"./products-B2sxqzwZ.js";import{B as L,a as P}from"./BaseError-DNv4Myx8.js";/* empty css                                                                  */const Q={class:"content-area"},V={class:"page-header",style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"1rem"}},F={class:"page-actions",style:{display:"flex",gap:".5rem","flex-wrap":"wrap","align-items":"center"}},j={style:{display:"flex","align-items":"center",gap:".35rem"}},U=["disabled"],A=["disabled"],D={key:2,class:"card",style:{"margin-bottom":"1rem",display:"flex",gap:"1rem","flex-wrap":"wrap"}},O={key:3,class:"table-wrap"},I={class:"data-table"},$={key:0,style:{color:"#dc3545"}},K={key:1},W={__name:"RelatorioEstoqueView",setup(T){const q=m([]),d=m(!1),c=m(""),b=m(""),v=m(!1),i=w(()=>{const n=(b.value||"").toLowerCase();return q.value.filter(o=>{const t=Number(o.stockQuantity||o.qtdEstoque||0),l=Number(o.minStock||o.estoqueMin||0);return v.value&&t>l?!1:n?(o.name||o.nome||o.nomeProduto||"").toLowerCase().includes(n):!0})});async function y(){d.value=!0,c.value="";try{q.value=await R()}catch(n){c.value=(n==null?void 0:n.message)||"Erro ao carregar produtos"}finally{d.value=!1}}function E(){const n=["ID","Produto","Estoque","Mínimo","Preço","Custo","Status"],o=i.value.map(s=>[s.id,s.name||s.nome||s.nomeProduto||"",s.stockQuantity||s.qtdEstoque||0,s.minStock||s.estoqueMin||0,Number(s.price||s.preco||0).toFixed(2),Number(s.cost||s.custo||0).toFixed(2),Number(s.stockQuantity||s.qtdEstoque||0)<=Number(s.minStock||s.estoqueMin||0)?"Abaixo do mínimo":"OK"]),t=[n.join(","),...o.map(s=>s.map(p=>'"'+String(p).replace(/"/g,'""')+'"').join(","))].join(`
`),l=new Blob([t],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(l),f=document.createElement("a");f.href=g,f.download="relatorio-estoque.csv",f.click(),URL.revokeObjectURL(g)}return N(y),(n,o)=>(a(),u("section",Q,[e("div",V,[o[3]||(o[3]=e("h2",{style:{margin:"0"}},"Relatório de Estoque",-1)),e("div",F,[h(e("input",{class:"form-control",style:{"min-width":"260px"},placeholder:"Buscar produto…","onUpdate:modelValue":o[0]||(o[0]=t=>b.value=t)},null,512),[[B,b.value,void 0,{trim:!0}]]),e("label",j,[h(e("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=t=>v.value=t)},null,512),[[C,v.value]]),o[2]||(o[2]=e("span",null,"Apenas abaixo do mínimo",-1))]),e("button",{class:"btn btn-secondary",onClick:y,disabled:d.value},"Atualizar",8,U),e("button",{class:"btn btn-outline",onClick:E,disabled:!i.value.length},"Exportar CSV",8,A)])]),c.value?(a(),x(L,{key:0,message:c.value,retry:y},null,8,["message"])):d.value?(a(),x(P,{key:1,message:"Carregando produtos…"})):(a(),u("div",D,[e("div",null,[o[4]||(o[4]=e("strong",null,"Itens:",-1)),k(" "+r(i.value.length),1)]),e("div",null,[o[5]||(o[5]=e("strong",null,"Qtd total:",-1)),k(" "+r(i.value.reduce((t,l)=>t+Number(l.stockQuantity||l.qtdEstoque||0),0)),1)]),e("div",null,[o[6]||(o[6]=e("strong",null,"Valor total (preço):",-1)),k(" R$ "+r(i.value.reduce((t,l)=>t+Number(l.price||l.preco||0)*Number(l.stockQuantity||l.qtdEstoque||0),0).toFixed(2)),1)])])),!d.value&&!c.value?(a(),u("div",O,[e("table",I,[o[7]||(o[7]=e("thead",null,[e("tr",null,[e("th",null,"ID"),e("th",null,"Produto"),e("th",null,"Estoque"),e("th",null,"Mínimo"),e("th",null,"Preço"),e("th",null,"Custo"),e("th",null,"Status")])],-1)),e("tbody",null,[(a(!0),u(M,null,S(i.value,t=>(a(),u("tr",{key:t.id},[e("td",null,r(t.id),1),e("td",null,r(t.name||t.nome||t.nomeProduto),1),e("td",null,r(t.stockQuantity||t.qtdEstoque||0),1),e("td",null,r(t.minStock||t.estoqueMin||0),1),e("td",null,"R$ "+r(Number(t.price||t.preco||0).toFixed(2)),1),e("td",null,"R$ "+r(Number(t.cost||t.custo||0).toFixed(2)),1),e("td",null,[Number(t.stockQuantity||t.qtdEstoque||0)<=Number(t.minStock||t.estoqueMin||0)?(a(),u("span",$,"Abaixo do mínimo")):(a(),u("span",K,"OK"))])]))),128))])])])):_("",!0)]))}};export{W as default};
