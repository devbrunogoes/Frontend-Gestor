import{s as U,_ as oe,r as d,x as P,c as k,o as le,y as re,a as r,b as l,f as s,d as ne,z as j,p as ie,e as T,n as m,t as n,T as ue,F as _,j as y,v as E,A as $,g as I,w as J}from"./index-CXM7zIvA.js";import{B as de,a as ce}from"./BaseError-DaDu2INT.js";/* empty css                                                                  */async function me(){const i=await U("/users");return Array.isArray(i)?i:[]}async function ve(i){return await U("/users",{method:"POST",body:JSON.stringify(i)})}async function fe(i,b){return await U(`/users/${i}`,{method:"PUT",body:JSON.stringify(b)})}async function pe(i){return await U(`/users/${i}`,{method:"DELETE"}),!0}async function ye(){const i=await U("/users/roles");return Array.isArray(i)?i:[]}const be={class:"content-area users-view"},ge={key:0,class:"fa-solid fa-circle-check"},we={key:1,class:"fa-solid fa-circle-exclamation"},ke={class:"overview-grid","aria-label":"Resumo dos usuários"},Ue={class:"metric-card"},Ce={class:"metric-value"},he={class:"metric-card good"},Ae={class:"metric-value"},xe={class:"metric-card accent"},Fe={class:"metric-value"},Te={class:"toolbar"},_e={class:"search-box"},Ee={class:"toolbar-right"},Ne={class:"filter-group",role:"group","aria-label":"Filtro de status"},Le={class:"role-filter"},Be=["value"],Se={key:0,class:"empty-state",role:"alert"},Ve={key:1,class:"users-grid",role:"list"},De={class:"card-header"},$e={class:"card-title"},Ie={class:"card-meta"},Me={class:"card-actions"},Re=["onClick"],qe=["onClick"],ze={class:"modal-dialog"},Oe={class:"modal-content"},Pe={class:"modal-header"},je={class:"modal-body"},Je={class:"form-grid"},Ge={class:"form-group form-group-large",for:"nomeUsuario"},He={class:"form-group form-group-large",for:"emailUsuario"},Ke={class:"form-group",for:"senhaUsuario"},Qe=["required","placeholder"],We={key:0,class:"input-hint"},Xe={class:"form-group",for:"statusUsuario"},Ye={class:"form-group",for:"roleUsuario"},Ze=["value"],es={key:0,class:"alert alert-error"},g="Usuário Comum",ss={__name:"UsuariosView",setup(i){const b=d([]),N=d([]),L=d(!1),C=d(""),h=d(!1),c=d(null),o=P({nome:"",email:"",password:"",active:!0,role:""}),v=d(""),B=d(""),w=d("all"),A=d("all"),u=P({type:"",message:""});let f=null;const M=["avatar-teal","avatar-indigo","avatar-amber","avatar-rose","avatar-sky"],G=k(()=>b.value.length),H=k(()=>b.value.filter(t=>t.active!==!1).length),p=k(()=>{const t=N.value.length?N.value:[g];return[...new Set(t)].sort((e,a)=>e.localeCompare(a,"pt-BR"))}),K=k(()=>p.value.length),R=k(()=>{const t=B.value.trim().toLowerCase();return b.value.filter(e=>{switch(w.value){case"active":return e.active!==!1;case"inactive":return e.active===!1;default:return!0}}).filter(e=>A.value==="all"?!0:(e.role||"").toLowerCase()===A.value.toLowerCase()).filter(e=>t?[e.nome,e.email].filter(Boolean).join(" ").toLowerCase().includes(t):!0).sort((e,a)=>{const D=(e.nome||e.email||"").toLowerCase(),te=(a.nome||a.email||"").toLowerCase();return D.localeCompare(te,"pt-BR")})});function x(t,e){u.type=t,u.message=e,f&&clearTimeout(f),f=setTimeout(()=>{u.type="",u.message=""},3500)}function Q(){f&&clearTimeout(f),u.type="",u.message=""}function q(){o.nome="",o.email="",o.password="",o.active=!0,o.role=p.value[0]||g,c.value=null,v.value=""}function z(){q(),h.value=!0}function W(t){c.value=t.id,o.nome=t.nome||"",o.email=t.email||"",o.password="",o.active=t.active!==!1,o.role=t.role||p.value[0]||g,v.value="",h.value=!0}function F(){h.value=!1}function S(t){w.value=t}function X(t){const e=(t.nome||t.email||"").trim();return e?e.charAt(0).toUpperCase():"U"}function Y(t){const e=Number(t.id)||(t.nome?t.nome.charCodeAt(0):0),a=Math.abs(e)%M.length;return M[a]}function Z(t){if(!t)return"—";const e=new Date(t);return Number.isNaN(e.getTime())?"—":e.toLocaleString("pt-BR",{day:"2-digit",month:"short",year:"numeric"})}async function V(){const t=await me();b.value=Array.isArray(t)?t:[]}async function ee(){const t=await ye();N.value=Array.isArray(t)&&t.length?t:[g],o.role||(o.role=p.value[0]||g)}async function O(){L.value=!0,C.value="";try{await Promise.all([ee(),V()])}catch(t){C.value=(t==null?void 0:t.message)||"Erro ao carregar usuários."}finally{L.value=!1}}async function se(){if(v.value="",!o.nome||!o.email||!c.value&&!o.password){v.value="Nome, e-mail e senha são obrigatórios (senha apenas ao criar).";return}const t={nome:o.nome,email:o.email,password:o.password||void 0,active:!!o.active,role:o.role||p.value[0]||g};try{c.value?(await fe(c.value,t),x("success","Usuário atualizado com sucesso.")):(await ve(t),x("success","Usuário criado com sucesso.")),F(),q(),await V()}catch(e){v.value=(e==null?void 0:e.message)||"Erro ao salvar usuário."}}async function ae(t){if(confirm(`Confirmar exclusão do usuário #${t.id}?`))try{await pe(t.id),x("success","Usuário excluído."),await V()}catch(e){x("error",(e==null?void 0:e.message)||"Erro ao excluir usuário.")}}return le(()=>{O()}),re(()=>{f&&clearTimeout(f)}),(t,e)=>(l(),r("section",be,[s("header",{class:"page-header users-header"},[e[11]||(e[11]=s("div",{class:"header-copy"},[s("h2",null,"Usuários"),s("p",null,"Acompanhe os acessos ativos e mantenha perfis organizados por função.")],-1)),s("button",{class:"btn btn-primary header-action",type:"button",onClick:z},[...e[10]||(e[10]=[s("i",{class:"fa-solid fa-plus"},null,-1),s("span",null,"Novo usuário",-1)])])]),ne(ue,{name:"fade-slide"},{default:ie(()=>[u.message?(l(),r("div",{key:0,class:m(["feedback-banner",u.type])},[u.type==="success"?(l(),r("i",ge)):u.type==="error"?(l(),r("i",we)):T("",!0),s("span",null,n(u.message),1),s("button",{type:"button",class:"close-banner",onClick:Q,"aria-label":"Fechar aviso"},[...e[12]||(e[12]=[s("i",{class:"fa-solid fa-xmark"},null,-1)])])],2)):T("",!0)]),_:1}),C.value?(l(),j(de,{key:0,message:C.value,retry:O},null,8,["message"])):L.value?(l(),j(ce,{key:1,message:"Carregando usuários…"})):(l(),r(_,{key:2},[s("section",ke,[s("article",Ue,[e[13]||(e[13]=s("span",{class:"metric-label"},"Total cadastrados",-1)),s("strong",Ce,n(G.value),1)]),s("article",he,[e[14]||(e[14]=s("span",{class:"metric-label"},"Ativos",-1)),s("strong",Ae,n(H.value),1)]),s("article",xe,[e[15]||(e[15]=s("span",{class:"metric-label"},"Perfis",-1)),s("strong",Fe,n(K.value),1)])]),s("div",Te,[s("div",_e,[e[16]||(e[16]=s("i",{class:"fa-solid fa-magnifying-glass"},null,-1)),y(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>B.value=a),type:"search",placeholder:"Buscar por nome ou e-mail…","aria-label":"Buscar usuário"},null,512),[[E,B.value,void 0,{trim:!0}]])]),s("div",Ee,[s("div",Ne,[s("button",{type:"button",class:m(["filter-chip",{active:w.value==="all"}]),onClick:e[1]||(e[1]=a=>S("all"))}," Todos ",2),s("button",{type:"button",class:m(["filter-chip",{active:w.value==="active"}]),onClick:e[2]||(e[2]=a=>S("active"))}," Ativos ",2),s("button",{type:"button",class:m(["filter-chip",{active:w.value==="inactive"}]),onClick:e[3]||(e[3]=a=>S("inactive"))}," Inativos ",2)]),s("label",Le,[e[18]||(e[18]=s("span",null,"Função",-1)),y(s("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>A.value=a)},[e[17]||(e[17]=s("option",{value:"all"},"Todas",-1)),(l(!0),r(_,null,I(p.value,a=>(l(),r("option",{key:a,value:a},n(a),9,Be))),128))],512),[[$,A.value]])])])]),R.value.length?(l(),r("div",Ve,[(l(!0),r(_,null,I(R.value,a=>(l(),r("article",{key:a.id,class:m(["user-card",{inactive:a.active===!1}]),role:"listitem"},[s("header",De,[s("div",{class:m(["avatar",Y(a)])},n(X(a)),3),s("div",$e,[s("h3",null,n(a.nome||a.email),1),s("p",null,n(a.email),1)]),s("span",{class:m(["status-pill",a.active!==!1?"status-active":"status-inactive"])},n(a.active!==!1?"Ativo":"Inativo"),3)]),s("dl",Ie,[s("div",null,[e[23]||(e[23]=s("dt",null,"Função",-1)),s("dd",null,n(a.role||"Não informada"),1)]),s("div",null,[e[24]||(e[24]=s("dt",null,"ID interno",-1)),s("dd",null,"#"+n(a.id),1)]),s("div",null,[e[25]||(e[25]=s("dt",null,"Último acesso",-1)),s("dd",null,n(Z(a.lastLogin)),1)])]),s("footer",Me,[s("button",{type:"button",class:"btn btn-light",onClick:D=>W(a)},[...e[26]||(e[26]=[s("i",{class:"fa-solid fa-pen"},null,-1),s("span",null,"Editar",-1)])],8,Re),s("button",{type:"button",class:"btn btn-danger",onClick:D=>ae(a)},[...e[27]||(e[27]=[s("i",{class:"fa-solid fa-trash"},null,-1),s("span",null,"Excluir",-1)])],8,qe)])],2))),128))])):(l(),r("div",Se,[e[20]||(e[20]=s("i",{class:"fa-solid fa-user-group"},null,-1)),e[21]||(e[21]=s("h3",null,"Nenhum usuário encontrado",-1)),e[22]||(e[22]=s("p",null,"Cadastre um novo usuário ou ajuste os filtros para visualizar resultados.",-1)),s("button",{class:"btn btn-primary",type:"button",onClick:z},[...e[19]||(e[19]=[s("i",{class:"fa-solid fa-plus"},null,-1),s("span",null,"Adicionar usuário",-1)])])]))],64)),s("div",{class:m(["modal",{show:h.value}]),role:"dialog","aria-hidden":"true",onClick:J(F,["self"])},[s("div",ze,[s("div",Oe,[s("div",Pe,[s("div",null,[s("h3",null,n(c.value?"Editar usuário":"Novo usuário"),1),e[28]||(e[28]=s("p",{class:"modal-subtitle"},"Defina os dados de acesso e a função do colaborador.",-1))]),s("button",{type:"button",class:"btn-close",onClick:F,"aria-label":"Fechar"},[...e[29]||(e[29]=[s("i",{class:"fa-solid fa-xmark"},null,-1)])])]),s("form",{onSubmit:J(se,["prevent"])},[s("div",je,[s("div",Je,[s("label",Ge,[e[30]||(e[30]=s("span",null,"Nome",-1)),y(s("input",{id:"nomeUsuario",type:"text",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=a=>o.nome=a),required:""},null,512),[[E,o.nome,void 0,{trim:!0}]])]),s("label",He,[e[31]||(e[31]=s("span",null,"E-mail",-1)),y(s("input",{id:"emailUsuario",type:"email",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=a=>o.email=a),required:""},null,512),[[E,o.email,void 0,{trim:!0}]])]),s("label",Ke,[e[32]||(e[32]=s("span",null,"Senha",-1)),y(s("input",{id:"senhaUsuario",type:"password",class:"form-control",required:!c.value,"onUpdate:modelValue":e[7]||(e[7]=a=>o.password=a),placeholder:c.value?"Deixe em branco para manter":"Crie uma senha segura"},null,8,Qe),[[E,o.password]]),c.value?(l(),r("small",We,"Deixe em branco para manter a senha atual.")):T("",!0)]),s("label",Xe,[e[34]||(e[34]=s("span",null,"Status",-1)),y(s("select",{id:"statusUsuario",class:"form-control","onUpdate:modelValue":e[8]||(e[8]=a=>o.active=a)},[...e[33]||(e[33]=[s("option",{value:!0},"Ativo",-1),s("option",{value:!1},"Inativo",-1)])],512),[[$,o.active]])]),s("label",Ye,[e[35]||(e[35]=s("span",null,"Função",-1)),y(s("select",{id:"roleUsuario",class:"form-control","onUpdate:modelValue":e[9]||(e[9]=a=>o.role=a),required:""},[(l(!0),r(_,null,I(p.value,a=>(l(),r("option",{key:a,value:a},n(a),9,Ze))),128))],512),[[$,o.role]])])]),v.value?(l(),r("div",es,n(v.value),1)):T("",!0)]),s("div",{class:"modal-footer"},[s("button",{type:"button",class:"btn btn-secondary",onClick:F},"Cancelar"),e[36]||(e[36]=s("button",{type:"submit",class:"btn btn-success"},"Salvar usuário",-1))])],32)])])],2)]))}},ls=oe(ss,[["__scopeId","data-v-609fdc56"]]);export{ls as default};
