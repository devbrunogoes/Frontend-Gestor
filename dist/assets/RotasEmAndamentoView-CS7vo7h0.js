import{_ as A,r as u,o as w,a as o,b as n,f as a,e as y,h as c,t as e,F as R,g as C,l as N,n as E,I as S}from"./index-IzLOKglm.js";const V={class:"content-area"},z={class:"page-header"},D={class:"header-actions"},B=["disabled"],F={class:"summary-panel"},I={class:"chip chip-primary"},M={key:0,class:"chip"},O=["disabled"],L={key:0,class:"alert alert-danger"},P={key:1,class:"alert alert-success"},T={key:2,class:"card"},j={key:3,class:"card"},U={key:0,class:"card-body"},$={class:"routes-grid"},q={class:"route-card__header"},G={class:"route-name"},H={class:"route-meta"},J={class:"route-actions"},K=["disabled","onClick"],Q={key:1,class:"card-body empty"},W={__name:"RotasEmAndamentoView",setup(X){const i=u(!1),f=u([]),v=u(""),r=u(""),m=u(""),_=u("");function b(l){if(!l)return"—";const t=new Date(l);return Number.isNaN(t.valueOf())?"—":t.toLocaleString("pt-BR")}async function p(){i.value=!0,r.value="",m.value="";try{const l=await N(null,"in_progress"),s=(Array.isArray(l)?l:[]).filter(d=>!d.completedAt&&!d.fimReal).sort((d,g)=>{const k=new Date(d.startedAt||d.inicioPrevisto||d.createdAt||0).valueOf();return new Date(g.startedAt||g.inicioPrevisto||g.createdAt||0).valueOf()-k});f.value=s,_.value=new Date().toLocaleString("pt-BR")}catch(l){r.value=(l==null?void 0:l.message)||"Falha ao carregar rotas em andamento."}finally{i.value=!1}}async function h(l){if(!(!l||!l.id)){v.value=String(l.id),r.value="",m.value="";try{await S(l.id),m.value="Rota concluída com sucesso.",await p()}catch(t){r.value=(t==null?void 0:t.message)||"Falha ao concluir rota."}finally{v.value=""}}}return w(()=>p()),(l,t)=>(n(),o("section",V,[a("div",z,[t[1]||(t[1]=a("div",null,[a("p",{class:"eyebrow"},"Operações · Rotas"),a("h2",null,"Rotas em andamento"),a("p",{class:"muted"},"Veja e conclua todas as execuções abertas.")],-1)),a("div",D,[a("button",{class:"btn btn-light",onClick:p,disabled:i.value},[t[0]||(t[0]=a("i",{class:"fa-solid fa-rotate"},null,-1)),c(" "+e(i.value?"Atualizando…":"Atualizar"),1)],8,B)])]),a("div",F,[a("div",I,[t[2]||(t[2]=a("i",{class:"fa-solid fa-route"},null,-1)),c(" "+e(f.value.length)+" em aberto ",1)]),_.value?(n(),o("div",M,[t[3]||(t[3]=a("i",{class:"fa-regular fa-clock"},null,-1)),c(" Atualizado: "+e(_.value),1)])):y("",!0),t[5]||(t[5]=a("div",{class:"spacer"},null,-1)),a("button",{class:"btn btn-ghost",onClick:p,disabled:i.value},[t[4]||(t[4]=a("i",{class:"fa-solid fa-rotate"},null,-1)),c(" "+e(i.value?"Atualizando…":"Atualizar"),1)],8,O)]),r.value?(n(),o("div",L,e(r.value),1)):y("",!0),m.value?(n(),o("div",P,e(m.value),1)):y("",!0),i.value?(n(),o("div",T,[...t[6]||(t[6]=[a("div",{class:"card-body loading"},"Carregando rotas em andamento…",-1)])])):(n(),o("div",j,[f.value.length?(n(),o("div",U,[a("div",$,[(n(!0),o(R,null,C(f.value,s=>(n(),o("article",{key:s.id,class:"route-card"},[a("header",q,[a("div",null,[t[7]||(t[7]=a("p",{class:"eyebrow"},"Rota",-1)),a("h3",G,e(s.routeName||s.nome||s.name||"Rota"),1)]),t[8]||(t[8]=a("span",{class:"status-pill"},[a("i",{class:"fa-solid fa-play"}),c(" Em andamento ")],-1))]),a("dl",H,[a("div",null,[t[9]||(t[9]=a("dt",null,"Motorista",-1)),a("dd",null,e(s.driver||s.motorista||"—"),1)]),a("div",null,[t[10]||(t[10]=a("dt",null,"Veículo",-1)),a("dd",null,e(s.vehicle||s.veiculo||"—"),1)]),a("div",null,[t[11]||(t[11]=a("dt",null,"Início",-1)),a("dd",null,e(b(s.startedAt||s.inicioPrevisto||s.createdAt)),1)])]),a("footer",J,[a("button",{class:"btn btn-light",disabled:v.value===String(s.id)||i.value,onClick:d=>h(s)},[a("i",{class:E(["fa-solid",v.value===String(s.id)?"fa-spinner fa-spin":"fa-check"])},null,2),c(" "+e(v.value===String(s.id)?"Concluindo…":"Concluir"),1)],8,K)])]))),128))])])):(n(),o("div",Q,[...t[12]||(t[12]=[a("i",{class:"fa-regular fa-circle-check"},null,-1),a("p",null,"Nenhuma rota em andamento.",-1)])]))]))]))}},x=A(W,[["__scopeId","data-v-9ab3494d"]]);export{x as default};
