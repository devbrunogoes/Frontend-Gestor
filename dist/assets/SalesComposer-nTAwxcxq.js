import{_ as fe,z as D,r as S,D as J,c as $,a as u,b as d,f as o,e as k,m,C as F,F as L,g as w,t as v,v as p,d as W,n as x,s as X,p as T,T as Y,h as C,w as ge}from"./index-IzLOKglm.js";import{c as pe}from"./sales-5D-YZoeD.js";const ve={class:"sales-composer"},be={class:"composer-card"},ye={class:"form-grid"},Pe={class:"form-group"},ke=["value"],Ce={key:0,class:"form-group"},xe={key:1,class:"form-group"},Ie=["value"],he={class:"composer-card"},Ve={class:"catalog-search"},Se={key:0,class:"empty-catalog"},Ne={key:1,class:"catalog-list"},_e=["onClick"],Ue={class:"catalog-info"},qe={key:0,class:"catalog-actions"},De={class:"catalog-control"},$e=["onUpdate:modelValue","onChange"],Le={class:"catalog-control"},we=["onUpdate:modelValue","onChange"],Me={class:"catalog-control"},Be=["onUpdate:modelValue","onChange"],Ae={class:"catalog-checkbox"},Re=["onUpdate:modelValue"],Fe=["onClick"],Te={key:0,class:"manual-form"},Ee={class:"form-grid manual-grid"},Oe={class:"form-group span-6"},Qe={class:"form-group span-3"},je={class:"form-group span-3"},ze={class:"form-group span-3"},Ke={class:"form-group span-3 manual-checkbox"},Ge={class:"checkbox-inline"},He={key:2,class:"items-list"},Je={class:"item-header"},We=["onUpdate:modelValue","onChange"],Xe=["onClick"],Ye={class:"item-body"},Ze=["onUpdate:modelValue","onChange"],eo=["onUpdate:modelValue","onChange"],oo=["onUpdate:modelValue","onChange"],to={class:"item-checkbox"},no=["onUpdate:modelValue"],ao={class:"item-footer"},so={key:3,class:"resume"},lo={class:"composer-card"},ro={class:"form-grid payment-grid"},io={class:"form-group"},uo={class:"quick-methods",role:"group","aria-label":"Seleção rápida de formas de pagamento"},mo={class:"form-group"},co={class:"composer-footer"},fo=["disabled"],go={key:0},po={key:1},vo={__name:"SalesComposer",props:{clients:{type:Array,default:()=>[]},execucoes:{type:Array,default:()=>[]},catalogo:{type:Array,default:()=>[]},defaults:{type:Object,default:()=>({origem:"sistema",formaPagamento:"Pix",statusPagamento:"Pago",execucaoId:""})}},emits:["saved"],setup(M,{emit:Z}){var j,z,K,G,H;const c=M,ee=Z,a=D({clienteId:"",clienteLivre:"",origem:((j=c.defaults)==null?void 0:j.origem)??"sistema",execucaoId:((z=c.defaults)==null?void 0:z.origem)==="rota"&&((K=c.defaults)!=null&&K.execucaoId)?String(c.defaults.execucaoId):"",formaPagamento:((G=c.defaults)==null?void 0:G.formaPagamento)??"Pix",statusPagamento:((H=c.defaults)==null?void 0:H.statusPagamento)??"Pago",observacoes:""}),g=S([]),r=D({nome:"",qtd:1,preco:0,desconto:0,brinde:!1}),y=S(!1),I=S(""),P=S(""),h=D({}),N=S(!1),i=D({message:"",type:"success"});J(()=>c.defaults,t=>{if(!t)return;a.origem=t.origem??"sistema",a.formaPagamento=t.formaPagamento??"Pix",a.statusPagamento=t.statusPagamento??"Pago";const e=t.execucaoId?String(t.execucaoId):"";a.execucaoId=a.origem==="rota"?e:""},{immediate:!0,deep:!0}),J(()=>a.origem,t=>{var e;t!=="rota"?a.execucaoId="":!a.execucaoId&&((e=c.defaults)!=null&&e.execucaoId)&&(a.execucaoId=String(c.defaults.execucaoId))});const E=$(()=>{if(!Array.isArray(c.catalogo)||!c.catalogo.length)return[];if(!I.value)return c.catalogo;const t=I.value.toLowerCase();return c.catalogo.filter(e=>{const n=String((e==null?void 0:e.nome)||(e==null?void 0:e.name)||"").toLowerCase(),s=String((e==null?void 0:e.descricao)||(e==null?void 0:e.description)||"").toLowerCase(),l=String((e==null?void 0:e.sku)||(e==null?void 0:e.codigo)||"").toLowerCase();return n.includes(t)||s.includes(t)||l.includes(t)})}),oe=$(()=>g.value.filter(t=>t.brinde).length),te=$(()=>g.value.reduce((t,e)=>t+(Number(e.desconto)||0),0)),B=$(()=>g.value.reduce((t,e)=>t+Q(e),0));function A(t){a.formaPagamento=t}function _(t){const e=Number(t);return Number.isFinite(e)?Math.max(1,Math.floor(e)):1}function b(t){const e=Number(t);return!Number.isFinite(e)||e<0?0:Math.round(e*100)/100}function U(t){return(Number(t)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function ne(t){if(!t)return"—";const e=new Date(t);return Number.isNaN(e.getTime())?"—":e.toLocaleDateString("pt-BR")}function R(t){return Number((t==null?void 0:t.preco)??(t==null?void 0:t.price)??(t==null?void 0:t.valor)??0)}function V(t){return t?t.id!==void 0&&t.id!==null?String(t.id):t.codigo!==void 0&&t.codigo!==null?String(t.codigo):t.sku!==void 0&&t.sku!==null?String(t.sku):`${String(t.nome||t.name||"produto").toLowerCase().replace(/\s+/g,"-")}-${R(t)}`:""}function f(t){const e=V(t);return h[e]||(h[e]={key:e,qtd:1,preco:b(R(t)),desconto:0,brinde:!1}),h[e]}function ae(t){const e=V(t);e&&(P.value===e?P.value="":(P.value=e,f(t)))}function se(){y.value=!y.value}function le(t){const e=f(t),n=(t==null?void 0:t.nome)||(t==null?void 0:t.name);if(!n){i.type="error",i.message="Produto sem nome no catálogo.";return}g.value.push({nome:n,qtd:_(e.qtd),preco:b(e.preco),desconto:b(e.desconto),brinde:!!e.brinde,catalogId:(t==null?void 0:t.id)??null,catalogKey:e.key}),P.value="",e.qtd=1,e.desconto=0,e.brinde=!1,i.message=""}function O(){r.nome="",r.qtd=1,r.preco=0,r.desconto=0,r.brinde=!1}function re(){if(!r.nome.trim()){i.type="error",i.message="Informe o nome do item manual.";return}g.value.push({nome:r.nome.trim(),qtd:_(r.qtd),preco:b(r.preco),desconto:b(r.desconto),brinde:!!r.brinde,catalogId:null,catalogKey:null}),O(),y.value=!1,i.message=""}function q(t){const e=g.value[t];e&&(e.qtd=_(e.qtd),e.preco=b(e.preco),e.desconto=b(e.desconto),e.nome||(e.nome="Produto"))}function ie(t){g.value.splice(t,1)}function Q(t){const e=(Number(t.qtd)||0)*(Number(t.preco)||0)-(Number(t.desconto)||0);return Math.max(e,0)}function ue(){const t=a.clienteId==="__livre__";return!t&&!a.clienteId?(i.type="error",i.message='Selecione um cliente ou use a opção "Não cadastrado".',!1):t&&!a.clienteLivre?(i.type="error",i.message="Informe o nome do cliente para finalizar sem cadastro.",!1):g.value.length?!0:(i.type="error",i.message="Adicione pelo menos um item à venda.",!1)}function de(){var s;const t=a.clienteId==="__livre__",e=!t&&a.clienteId?Number(a.clienteId):null,n=a.origem||((s=c.defaults)==null?void 0:s.origem)||"sistema";return{clientId:e,clientName:t?a.clienteLivre:null,origem:n,execucaoId:n==="rota"&&a.execucaoId?Number(a.execucaoId):null,paymentMethod:a.formaPagamento,paymentStatus:a.statusPagamento,items:g.value.map(l=>({nome:l.nome,qtd:Number(l.qtd)||0,preco:Number(l.preco)||0,desconto:Number(l.desconto)||0,brinde:!!l.brinde,catalogId:l.catalogId??void 0})),total:B.value,observacoes:a.observacoes}}function me(){var t,e,n,s;a.clienteId="",a.clienteLivre="",a.origem=((t=c.defaults)==null?void 0:t.origem)??"sistema",a.execucaoId=a.origem==="rota"&&((e=c.defaults)!=null&&e.execucaoId)?String(c.defaults.execucaoId):"",a.formaPagamento=((n=c.defaults)==null?void 0:n.formaPagamento)??"Pix",a.statusPagamento=((s=c.defaults)==null?void 0:s.statusPagamento)??"Pago",a.observacoes="",g.value=[],I.value="",P.value="",y.value=!1,Object.keys(h).forEach(l=>{delete h[l]}),O()}async function ce(){if(ue()){N.value=!0,i.message="";try{const t=de(),e={total:B.value,metodo:a.formaPagamento};await pe(t),me(),i.type="success",i.message="Venda registrada com sucesso.",ee("saved",e)}catch(t){i.type="error",i.message=(t==null?void 0:t.message)||"Não foi possível salvar a venda."}finally{N.value=!1}}}return(t,e)=>(d(),u("div",ve,[o("form",{class:"composer-form",onSubmit:ge(ce,["prevent"])},[o("section",be,[e[21]||(e[21]=o("header",null,[o("h4",null,"Cliente"),o("p",null,"Selecione um cliente cadastrado ou informe rapidamente o nome.")],-1)),o("div",ye,[o("div",Pe,[e[17]||(e[17]=o("label",{for:"cliente-select"},"Cliente",-1)),m(o("select",{id:"cliente-select","onUpdate:modelValue":e[0]||(e[0]=n=>a.clienteId=n)},[e[15]||(e[15]=o("option",{value:""},"Selecionar cliente",-1)),e[16]||(e[16]=o("option",{value:"__livre__"},"Não cadastrado",-1)),(d(!0),u(L,null,w(M.clients,n=>(d(),u("option",{key:n.id,value:String(n.id)},v(n.nome||n.name||`Cliente #${n.id}`),9,ke))),128))],512),[[F,a.clienteId]])]),a.clienteId==="__livre__"?(d(),u("div",Ce,[e[18]||(e[18]=o("label",{for:"cliente-livre"},"Nome do cliente",-1)),m(o("input",{id:"cliente-livre","onUpdate:modelValue":e[1]||(e[1]=n=>a.clienteLivre=n),type:"text",placeholder:"Nome para a nota"},null,512),[[p,a.clienteLivre,void 0,{trim:!0}]])])):k("",!0),a.origem==="rota"?(d(),u("div",xe,[e[20]||(e[20]=o("label",{for:"execucao-select"},"Execução da rota",-1)),m(o("select",{id:"execucao-select","onUpdate:modelValue":e[2]||(e[2]=n=>a.execucaoId=n)},[e[19]||(e[19]=o("option",{value:""},"Selecionar execução",-1)),(d(!0),u(L,null,w(M.execucoes,n=>(d(),u("option",{key:n.id,value:String(n.id)},v(n.id)+" · "+v(n.rotaNome||"Rota")+" ("+v(ne(n.inicioReal))+") ",9,Ie))),128))],512),[[F,a.execucaoId]])])):k("",!0)])]),o("section",he,[e[42]||(e[42]=o("header",null,[o("h4",null,"Itens da venda"),o("p",null,"Liste os produtos como na rota: busque no catálogo, ajuste os detalhes e confirme.")],-1)),o("div",Ve,[e[22]||(e[22]=o("i",{class:"fa-solid fa-search","aria-hidden":"true"},null,-1)),m(o("input",{id:"catalog-search","onUpdate:modelValue":e[3]||(e[3]=n=>I.value=n),type:"search",placeholder:"Buscar produto no catálogo"},null,512),[[p,I.value,void 0,{trim:!0}]])]),E.value.length?(d(),u("ul",Ne,[(d(!0),u(L,null,w(E.value,n=>(d(),u("li",{key:V(n),class:"catalog-item"},[o("button",{type:"button",class:"catalog-main",onClick:s=>ae(n)},[o("div",Ue,[o("strong",null,v(n.nome||n.name||"Produto"),1),o("small",null,v(U(R(n))),1)]),o("i",{class:x(["fa-solid",P.value===V(n)?"fa-chevron-up":"fa-chevron-down"]),"aria-hidden":"true"},null,2)],8,_e),W(Y,{name:"fade"},{default:X(()=>[P.value===V(n)?(d(),u("div",qe,[o("div",De,[e[23]||(e[23]=o("label",null,"Qtd",-1)),m(o("input",{type:"number",min:"1",step:"1","onUpdate:modelValue":s=>f(n).qtd=s,onChange:s=>f(n).qtd=_(f(n).qtd)},null,40,$e),[[p,f(n).qtd,void 0,{number:!0}]])]),o("div",Le,[e[24]||(e[24]=o("label",null,"Preço",-1)),m(o("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":s=>f(n).preco=s,onChange:s=>f(n).preco=b(f(n).preco)},null,40,we),[[p,f(n).preco,void 0,{number:!0}]])]),o("div",Me,[e[25]||(e[25]=o("label",null,"Desconto",-1)),m(o("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":s=>f(n).desconto=s,onChange:s=>f(n).desconto=b(f(n).desconto)},null,40,Be),[[p,f(n).desconto,void 0,{number:!0}]])]),o("label",Ae,[m(o("input",{type:"checkbox","onUpdate:modelValue":s=>f(n).brinde=s},null,8,Re),[[T,f(n).brinde]]),e[26]||(e[26]=o("span",null,"Brinde",-1))]),o("button",{type:"button",class:"btn-add-inline",onClick:s=>le(n)}," Adicionar ",8,Fe)])):k("",!0)]),_:2},1024)]))),128))])):(d(),u("div",Se," Nenhum produto encontrado no catálogo. ")),o("button",{type:"button",class:"manual-toggle",onClick:e[4]||(e[4]=n=>se())},[o("i",{class:x(["fa-solid",y.value?"fa-circle-minus":"fa-circle-plus"]),"aria-hidden":"true"},null,2),o("span",null,v(y.value?"Ocultar item manual":"Adicionar item manual"),1)]),W(Y,{name:"fade"},{default:X(()=>[y.value?(d(),u("div",Te,[o("div",Ee,[o("div",Oe,[e[27]||(e[27]=o("label",{for:"manual-nome"},"Produto",-1)),m(o("input",{id:"manual-nome","onUpdate:modelValue":e[5]||(e[5]=n=>r.nome=n),type:"text",placeholder:"Nome do item"},null,512),[[p,r.nome,void 0,{trim:!0}]])]),o("div",Qe,[e[28]||(e[28]=o("label",{for:"manual-qtd"},"Quantidade",-1)),m(o("input",{id:"manual-qtd","onUpdate:modelValue":e[6]||(e[6]=n=>r.qtd=n),type:"number",min:"1",step:"1"},null,512),[[p,r.qtd,void 0,{number:!0}]])]),o("div",je,[e[29]||(e[29]=o("label",{for:"manual-preco"},"Preço",-1)),m(o("input",{id:"manual-preco","onUpdate:modelValue":e[7]||(e[7]=n=>r.preco=n),type:"number",min:"0",step:"0.01"},null,512),[[p,r.preco,void 0,{number:!0}]])]),o("div",ze,[e[30]||(e[30]=o("label",{for:"manual-desc"},"Desconto",-1)),m(o("input",{id:"manual-desc","onUpdate:modelValue":e[8]||(e[8]=n=>r.desconto=n),type:"number",min:"0",step:"0.01"},null,512),[[p,r.desconto,void 0,{number:!0}]])]),o("div",Ke,[o("label",Ge,[m(o("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=n=>r.brinde=n)},null,512),[[T,r.brinde]]),e[31]||(e[31]=o("span",null,"Brinde",-1))])]),o("div",{class:"form-group span-12"},[o("button",{type:"button",class:"btn-add",onClick:re},"Adicionar item manual")])])])):k("",!0)]),_:1}),g.value.length?(d(),u("div",He,[(d(!0),u(L,null,w(g.value,(n,s)=>(d(),u("article",{key:s,class:"item-card"},[o("header",Je,[m(o("input",{class:"item-name",type:"text","onUpdate:modelValue":l=>n.nome=l,placeholder:"Nome do produto",onChange:l=>q(s)},null,40,We),[[p,n.nome,void 0,{trim:!0}]]),o("button",{type:"button",class:"btn-remove",onClick:l=>ie(s),"aria-label":"Remover item"},[...e[32]||(e[32]=[o("i",{class:"fa-solid fa-trash","aria-hidden":"true"},null,-1)])],8,Xe)]),o("div",Ye,[o("label",null,[e[33]||(e[33]=o("span",null,"Qtd",-1)),m(o("input",{type:"number",min:"1",step:"1","onUpdate:modelValue":l=>n.qtd=l,onChange:l=>q(s)},null,40,Ze),[[p,n.qtd,void 0,{number:!0}]])]),o("label",null,[e[34]||(e[34]=o("span",null,"Preço",-1)),m(o("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":l=>n.preco=l,onChange:l=>q(s)},null,40,eo),[[p,n.preco,void 0,{number:!0}]])]),o("label",null,[e[35]||(e[35]=o("span",null,"Desconto",-1)),m(o("input",{type:"number",min:"0",step:"0.01","onUpdate:modelValue":l=>n.desconto=l,onChange:l=>q(s)},null,40,oo),[[p,n.desconto,void 0,{number:!0}]])]),o("label",to,[m(o("input",{type:"checkbox","onUpdate:modelValue":l=>n.brinde=l},null,8,no),[[T,n.brinde]]),e[36]||(e[36]=o("span",null,"Brinde",-1))])]),o("footer",ao,[e[37]||(e[37]=o("span",null,"Subtotal",-1)),o("strong",null,v(U(Q(n))),1)])]))),128))])):k("",!0),g.value.length?(d(),u("div",so,[o("span",null,[e[38]||(e[38]=C("Itens: ",-1)),o("strong",null,v(g.value.length),1)]),o("span",null,[e[39]||(e[39]=C("Brindes: ",-1)),o("strong",null,v(oe.value),1)]),o("span",null,[e[40]||(e[40]=C("Descontos: ",-1)),o("strong",null,v(U(te.value)),1)]),o("span",null,[e[41]||(e[41]=C("Total: ",-1)),o("strong",null,v(U(B.value)),1)])])):k("",!0)]),o("section",lo,[e[49]||(e[49]=o("header",null,[o("h4",null,"Pagamento"),o("p",null,"Escolha rapidamente a forma de pagamento ideal para o cliente.")],-1)),o("div",ro,[o("div",io,[e[44]||(e[44]=o("label",{for:"status-select"},"Status de recebimento",-1)),m(o("select",{id:"status-select","onUpdate:modelValue":e[10]||(e[10]=n=>a.statusPagamento=n)},[...e[43]||(e[43]=[o("option",{value:"Pago"},"Pago",-1),o("option",{value:"Pendente"},"Pendente",-1)])],512),[[F,a.statusPagamento]])])]),o("div",uo,[o("button",{type:"button",class:x({active:a.formaPagamento==="Pix"}),onClick:e[11]||(e[11]=n=>A("Pix"))},[...e[45]||(e[45]=[o("i",{class:"fa-solid fa-qrcode","aria-hidden":"true"},null,-1),C(" Pix ",-1)])],2),o("button",{type:"button",class:x({active:a.formaPagamento==="Cartão"}),onClick:e[12]||(e[12]=n=>A("Cartão"))},[...e[46]||(e[46]=[o("i",{class:"fa-solid fa-credit-card","aria-hidden":"true"},null,-1),C(" Cartão ",-1)])],2),o("button",{type:"button",class:x({active:a.formaPagamento==="Dinheiro"}),onClick:e[13]||(e[13]=n=>A("Dinheiro"))},[...e[47]||(e[47]=[o("i",{class:"fa-solid fa-coins","aria-hidden":"true"},null,-1),C(" Dinheiro ",-1)])],2)]),o("div",mo,[e[48]||(e[48]=o("label",{for:"observacoes-input"},"Observações",-1)),m(o("textarea",{id:"observacoes-input","onUpdate:modelValue":e[14]||(e[14]=n=>a.observacoes=n),rows:"2",placeholder:"Informações adicionais (opcional)"},null,512),[[p,a.observacoes,void 0,{trim:!0}]])])]),o("footer",co,[i.message?(d(),u("div",{key:0,class:x(["feedback",i.type])},v(i.message),3)):k("",!0),o("button",{type:"submit",class:"btn-primary",disabled:N.value},[N.value?(d(),u("span",go,"Salvando…")):(d(),u("span",po,"Registrar venda"))],8,fo)])],32)]))}},Po=fe(vo,[["__scopeId","data-v-91563cee"]]);export{Po as S};
