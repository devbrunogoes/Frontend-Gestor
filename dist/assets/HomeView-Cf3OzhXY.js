import{C as $,B as F,a as H,L as J,p as E,b as P,c as z,A as I,D as Y}from"./index-AE0sWP_c.js";import{r as i,c as R,o as w,a as u,b as m,d as B,e as T,u as j,F as V,_ as Q,f as t,t as _,n as W,g as Z,h as G,l as K,i as U}from"./index-IzLOKglm.js";import{_ as X}from"./TopProducts-Y6lhWqJ2.js";import{l as tt}from"./clients-DV1jXavO.js";import{l as et}from"./products-B2sxqzwZ.js";import{l as st}from"./sales-5D-YZoeD.js";const at={key:0,style:{opacity:".7","margin-top":".25rem"}},ot={__name:"SalesByDay",setup(O){$.register(F,H,J,E,P);const c=i([]);function v(o,r="[]"){try{return JSON.parse(localStorage.getItem(o)||r)}catch{return JSON.parse(r)}}function f(o){const r=[],y=new Date;for(let n=o-1;n>=0;n--){const s=new Date(y);s.setDate(y.getDate()-n),r.push(s)}return r}function S(o){return(Number(o)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}const l=i([]),h=i([]),N=R(()=>(h.value||[]).some(o=>Number(o)>0)),k=R(()=>({labels:l.value,datasets:[{label:"Total de vendas",data:h.value,backgroundColor:"rgba(13,110,253,0.5)",borderColor:"#0d6efd",borderWidth:1}]})),g={responsive:!0,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,ticks:{callback:o=>S(o)}}}};function d(){c.value=Array.isArray(v("vendas"))?v("vendas"):[];const o=f(7);l.value=o.map(r=>r.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})),h.value=o.map(r=>{const y=r.toDateString();return c.value.filter(n=>new Date(n.date||n.data||n.createdAt).toDateString()===y).reduce((n,s)=>n+(typeof s.total=="number"?s.total:Number(s.total)||0),0)})}return w(d),(o,r)=>(m(),u(V,null,[B(j(z),{data:k.value,options:g},null,8,["data"]),N.value?T("",!0):(m(),u("div",at,"Sem dados de vendas nos últimos 7 dias."))],64))}},rt={key:0,style:{opacity:".7","margin-top":".25rem"}},nt={__name:"SalesByOrigin",setup(O){$.register(I,E,P);function c(g,d="[]"){try{return JSON.parse(localStorage.getItem(g)||d)}catch{return JSON.parse(d)}}const v=i([]),f=i([]),S=["#0d6efd","#ffc107","#20c997","#6f42c1","#dc3545","#6c757d"],l=R(()=>({labels:v.value,datasets:[{data:f.value,backgroundColor:S.slice(0,Math.max(3,v.value.length))}]})),h={plugins:{legend:{position:"bottom"}}},N=R(()=>(f.value||[]).some(g=>Number(g)>0));function k(){const d=(Array.isArray(c("vendas"))?c("vendas"):[]).reduce((r,y)=>{const n=(y.origem||"sistema").toLowerCase();return r[n]=(r[n]||0)+1,r},{}),o=Object.keys(d).length?Object.keys(d):["sistema","rota"];v.value=o,f.value=o.map(r=>d[r]||0)}return w(k),(g,d)=>(m(),u(V,null,[B(j(Y),{data:l.value,options:h},null,8,["data"]),N.value?T("",!0):(m(),u("div",rt,"Sem dados de origem de vendas."))],64))}},lt={class:"content-area"},it={class:"dashboard-cards metrics-grid"},ct={class:"card metric-card"},dt={class:"card-content"},ut={class:"card-value"},mt={class:"card metric-card"},pt={class:"card-content"},_t={class:"card-value"},vt={class:"card metric-card"},gt={class:"card-content"},ft={class:"card-value"},ht={class:"alerts-routes-grid"},yt={class:"alerts-card__header"},bt={class:"alerts-card__title"},At={key:0,class:"helper"},Dt={key:1,class:"helper muted"},St=["disabled"],Nt={key:0,class:"alerts-card__body"},kt={class:"alerts-list"},Bt={class:"alert-pill__index"},Lt={class:"alert-pill__message"},Ct={key:1,class:"alerts-card__body"},qt={class:"card routes-card"},Rt={class:"routes-card__header"},xt={class:"routes-card__title"},wt={class:"helper"},Vt=["disabled"],Ot={class:"charts-grid"},$t={class:"chart-card"},Et={class:"chart-card"},Pt={class:"chart-card"},Tt={__name:"HomeView",setup(O){const c=i(!1),v=i(0),f=i(0),S=i(0),l=i([]),h=i([]);i("");const N=i(""),k=U();function g(s,e){return s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()&&s.getDate()===e.getDate()}function d(s){try{return new Date(s)}catch{return null}}function o(s){const e=Number(s.total||s.valorTotal||s.amount||0);if(!isNaN(e)&&e>0)return e;const b=s.items||s.itens||[];return Array.isArray(b)&&b.length?b.reduce((D,A)=>{const x=Number(A.qtd||A.quantidade||A.quantity||0),L=Number(A.preco||A.price||A.valor||0);return D+x*L},0):0}function r(s){try{return s.toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}catch{return`R$ ${Number(s||0).toFixed(2)}`}}function y(){k.push({name:"rotas-em-andamento"})}async function n(){c.value=!0,N.value="";try{const[s,e,b,D]=await Promise.all([tt().catch(()=>[]),et().catch(()=>[]),st().catch(()=>[]),K(null,"in_progress").catch(()=>[])]);v.value=Array.isArray(s)?s.length:0,f.value=Array.isArray(e)?e.length:0;const A=new Date,x=(Array.isArray(b)?b:[]).filter(a=>{const p=d(a.date||a.data||a.createdAt||a.dataVenda);return p?g(p,A):!1});S.value=x.reduce((a,p)=>a+o(p),0);const L=[];for(const a of Array.isArray(e)?e:[]){const p=a.name||a.nome||a.nomeProduto||"Produto",C=Number(a.stockQuantity??a.estoque??a.quantidadeEstoque??a.qtdEstoque??0),q=Number(a.minStock??a.estoqueMinimo??a.minimo??0);q>0&&C<=q&&L.push(`Produto "${p}" abaixo do estoque mínimo (${C} ≤ ${q}).`)}l.value=L;const M=(Array.isArray(D)?D:[]).filter(a=>!a.completedAt&&!a.fimReal).sort((a,p)=>{const C=new Date(a.startedAt||a.inicioPrevisto||a.createdAt||0).valueOf();return new Date(p.startedAt||p.inicioPrevisto||p.createdAt||0).valueOf()-C});h.value=M}finally{c.value=!1}}return w(()=>{n()}),(s,e)=>(m(),u("section",lt,[e[15]||(e[15]=t("h2",null,"Dashboard",-1)),t("div",it,[t("div",ct,[e[1]||(e[1]=t("i",{class:"fa-solid fa-users card-icon"},null,-1)),t("div",dt,[e[0]||(e[0]=t("h3",null,"Clientes",-1)),t("p",ut,_(v.value.toLocaleString("pt-BR")),1)])]),t("div",mt,[e[3]||(e[3]=t("i",{class:"fa-solid fa-dolly card-icon"},null,-1)),t("div",pt,[e[2]||(e[2]=t("h3",null,"Produtos",-1)),t("p",_t,_(f.value.toLocaleString("pt-BR")),1)])]),t("div",vt,[e[5]||(e[5]=t("i",{class:"fa-solid fa-cash-register card-icon"},null,-1)),t("div",gt,[e[4]||(e[4]=t("h3",null,"Vendas Hoje",-1)),t("p",ft,_(r(S.value)),1)])])]),t("div",ht,[t("div",{class:W(["card alerts-card",{"alerts-card--empty":!l.value.length}])},[t("div",yt,[t("div",bt,[e[7]||(e[7]=t("i",{class:"fa-solid fa-bell-exclamation"},null,-1)),t("div",null,[e[6]||(e[6]=t("h3",null,"Alertas de Estoque",-1)),l.value.length?(m(),u("p",At,_(l.value.length)+" produto"+_(l.value.length>1?"s":"")+" precisa"+_(l.value.length>1?"m":"")+" de atenção",1)):(m(),u("p",Dt,"Estoque sob controle no momento"))])]),t("button",{class:"btn btn-light",onClick:n,disabled:c.value},_(c.value?"Atualizando…":"Atualizar"),9,St)]),l.value.length?(m(),u("div",Nt,[t("div",kt,[(m(!0),u(V,null,Z(l.value,(b,D)=>(m(),u("article",{key:D,class:"alert-pill"},[t("span",Bt,"#"+_(D+1),1),t("p",Lt,_(b),1)]))),128))])])):(m(),u("div",Ct,[...e[8]||(e[8]=[t("div",{class:"alerts-card__empty"},[t("i",{class:"fa-regular fa-circle-check"}),t("p",null,"Nenhum alerta no momento.")],-1)])]))],2),t("div",qt,[t("div",Rt,[t("div",xt,[e[10]||(e[10]=t("i",{class:"fa-solid fa-route"},null,-1)),t("div",null,[e[9]||(e[9]=t("h3",null,"Rotas em andamento",-1)),t("p",wt,_(h.value.length)+" em aberto",1)])]),t("button",{class:"btn btn-primary",onClick:y,disabled:c.value},[...e[11]||(e[11]=[t("i",{class:"fa-solid fa-list"},null,-1),G(" Ver rotas ",-1)])],8,Vt)])])]),t("div",Ot,[t("div",$t,[e[12]||(e[12]=t("h3",null,"Vendas - últimos 7 dias",-1)),B(ot)]),t("div",Et,[e[13]||(e[13]=t("h3",null,"Vendas por origem",-1)),B(nt)]),t("div",Pt,[e[14]||(e[14]=t("h3",null,"Top 5 produtos por preço",-1)),B(X,{topN:5})])])]))}},Yt=Q(Tt,[["__scopeId","data-v-4ceb7294"]]);export{Yt as default};
