import{_ as Na,G as wa,r as p,c as m,B as Ne,o as ka,y as Ca,a as v,b as c,f as a,e as S,d as we,z as xt,j as K,D as N,t as d,p as Xe,T as Ge,n as k,F as de,g as ke,E as Pa,P as Ea,w as qt,v as Ce,u as Pe,i as Aa,A as Tt,m as xa,l as qa}from"./index-CXM7zIvA.js";import{l as Ta,g as Da}from"./routes-D93I97QE.js";import{l as Ma,g as Ee,a as Dt,c as La}from"./routeExecutions-C1KIqcHM.js";import{c as $a}from"./sales-BoYCHADK.js";import{c as Fa}from"./expenses-DPTG9Cfu.js";import{l as Ra}from"./clients-BkLJVsW5.js";import{l as Va,c as za}from"./products-DXxYyzcf.js";import{B as Ba,a as Oa}from"./BaseError-DaDu2INT.js";import{S as Ua}from"./SalesComposer-DG8Hcazj.js";/* empty css                                                                  */const ja={class:"content-area"},Ka={class:"page-header"},Qa={key:0,class:"toolbar-actions"},Ya={key:0,class:"feedback feedback-error"},Wa={key:1,class:"feedback feedback-success"},Xa={key:0,class:"toast-notification"},Ga={key:4,class:"panel empty-state"},Ha={key:5,class:"route-progress"},Ja={class:"overview panel"},Za={class:"overview-header"},en={class:"overview-status"},tn={class:"progress-chip"},an={class:"overview-counters"},nn={class:"metric"},sn={class:"metric"},on={class:"metric"},ln={class:"metric"},rn={key:0,class:"metric"},un={key:0},dn={class:"route-grid"},cn={class:"route-main"},vn={class:"deliveries-list panel"},fn={class:"panel-header deliveries-header"},mn={class:"panel-title-block"},pn={class:"panel-subtitle"},gn={class:"view-mode-toggle",role:"tablist"},yn=["disabled"],bn={class:"panel-body"},hn={key:0,class:"empty-points"},_n={key:0,class:"points-list"},In=["onClick"],Sn={class:"left"},Nn={class:"order"},wn={class:"title"},kn={class:"address"},Cn={class:"right"},Pn=["disabled","onClick"],En={key:1,class:"point-stepper"},An={class:"stepper-head"},xn={class:"stepper-order"},qn={class:"stepper-title"},Tn={class:"stepper-address"},Dn={key:0,class:"stepper-meta"},Mn={class:"stepper-actions"},Ln=["disabled"],$n=["disabled"],Fn=["disabled"],Rn={key:1,class:"stepper-empty"},Vn={class:"route-sidebar"},zn={class:"route-details panel"},Bn={class:"panel-body"},On={class:"route-stats"},Un={class:"route-stat route-progress"},jn={class:"progress-header"},Kn={class:"progress-bar"},Qn={class:"progress-percent"},Yn={class:"route-stat"},Wn={class:"route-stat"},Xn={class:"route-stat"},Gn={key:0,class:"panel standalone-card"},Hn={class:"panel-body load-manifest-body"},Jn={class:"load-manifest-list"},Zn={class:"load-manifest-name"},es={class:"load-manifest-qty"},ts={class:"load-qty-remaining"},as={key:0,class:"load-qty-delivered"},ns={class:"load-qty-original"},ss={class:"panel standalone-card"},os={class:"panel-body standalone-card-body"},ls={key:0,class:"standalone-sale panel"},rs={class:"panel-body standalone-body"},is={key:0,class:"finish-section"},us=["disabled"],ds={class:"modal"},cs={class:"modal-dialog"},vs={class:"modal-content"},fs={class:"modal-body"},ms={class:"form-group"},ps={key:0,class:"form-hint"},gs={class:"client-meta"},ys={class:"client-meta-item"},bs={class:"client-meta-value"},hs={class:"client-meta-item"},_s={class:"client-meta-value"},Is={class:"client-meta-item"},Ss={class:"client-meta-value"},Ns={class:"client-meta-item"},ws={class:"client-meta-value"},ks={class:"product-picker"},Cs={class:"form-group"},Ps={key:0,class:"empty-products"},Es={key:1,class:"empty-products"},As={key:2,class:"product-grid"},xs=["onClick"],qs={class:"product-info"},Ts={key:0,class:"product-card-actions"},Ds=["onClick"],Ms=["onClick"],Ls=["onClick"],$s={key:0,class:"selected-items"},Fs={class:"selected-header"},Rs={class:"selected-info"},Vs={class:"selected-price"},zs=["onClick"],Bs={class:"selected-body"},Os=["for"],Us=["id","onUpdate:modelValue"],js={class:"type-buttons"},Ks=["onClick"],Qs=["onClick"],Ys=["onClick"],Ws={key:0,class:"discount-input"},Xs=["onUpdate:modelValue"],Gs={key:1,class:"discount-hint"},Hs={class:"item-summary"},Js={class:"sale-summary"},Zs={class:"summary-row"},eo={class:"summary-row"},to={class:"summary-row summary-total"},ao={class:"form-grid"},no={class:"form-group"},so={class:"form-group"},oo={class:"form-group"},lo={key:1,class:"modal-error"},ro={__name:"RotaAndamentoView",setup(io){const Mt=qa(),Lt=xa(),R=wa(),He=p([]),C=p([]),Q=p([]),x=p([]),u=p(null),V=p(""),q=p(""),ce=p(!1),ve=p(""),fe=p(null),J=p(!1);let T=null;const Ae=p(""),xe=p(!1);let D=null;const me=p(!1),M=p(!1),_=p(null),Y=p(""),qe=p(""),A=p(""),Te=p(null),h=p([]),W=p("Pix"),Z=p("Pago"),pe=p(""),z=p(""),P=p({}),L=p("list"),y=p(0),B=m(()=>C.value.slice()),E=m(()=>B.value[y.value]||null),De=m(()=>E.value?O(E.value.id):"pending"),$t=m(()=>y.value<B.value.length-1),Ft=m(()=>y.value>0),Je=m(()=>{const t=Mt.query.executionId;return t!=null?String(t):""}),Rt=["in_progress","started","active","running","em_andamento","em andamento"],Vt=["andamento","progress","ativo","running","start","execucao"],Ze=["completed","finished","finalizada","finalizado","encerrada","cancelled","canceled","concluida","concluido"],zt=["finaliz","conclu","encerr","cancel"],Bt=["pending","aguardando","modelo","model","draft","planejada","planned","aguardando inicio"],Ot=["pend","aguard","planej","model"];function et(t){return t==null?"":t.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/\s+/g," ").trim()}function tt(t){if(!t)return!1;const e=et(t.status);if(Ze.includes(e)||zt.some(n=>e.includes(n))||Bt.includes(e)||Ot.some(n=>e.includes(n)))return!1;if(Rt.includes(e)||Vt.some(n=>e.includes(n)))return!0;if(!e){if(t.fimReal||t.completedAt||t.finishedAt)return!1;const n=t.inProgress??t.emAndamento??t.isActive??t.ativo??null;return typeof n=="boolean"?n:!1}return!1}function at(t){if(!t&&t!==0)return NaN;if(t instanceof Date){const o=t.getTime();return Number.isFinite(o)?o:NaN}if(typeof t=="number")return Number.isFinite(t)?t:NaN;const e=Number(t);if(Number.isFinite(e))return e;const n=Date.parse(String(t));return Number.isNaN(n)?NaN:n}function nt(t){var o,l;if(!t)return-1/0;const e=[t.startedAt,t.started_at,t.startDate,t.start_date,t.startedOn,(o=t.metadata)==null?void 0:o.startedAt,(l=t.metadata)==null?void 0:l.inicioPrevisto,t.inicioPrevisto,t.prevInicio,t.createdAt,t.created_at,t.updatedAt,t.updated_at];for(const r of e){const s=at(r);if(!Number.isNaN(s))return s}const n=at(t.id);return Number.isNaN(n)?0:n}const ee=m(()=>tt(u.value)),Ut=m(()=>ee.value),X=m(()=>C.value.length),te=m(()=>!u.value||!Array.isArray(u.value.points)?0:u.value.points.filter(t=>re(t.status)==="visited").length),st=m(()=>!u.value||!Array.isArray(u.value.points)?0:u.value.points.filter(t=>re(t.status)==="skipped").length),Me=m(()=>Math.max(X.value-te.value-st.value,0)),Le=m(()=>X.value?Math.round(te.value/X.value*100):0),$=m(()=>{if(!u.value||!Array.isArray(u.value.loadItems))return[];const t=P.value||{};return u.value.loadItems.map((e,n)=>{const o=(e==null?void 0:e.productId)??(e==null?void 0:e.produtoId)??(e==null?void 0:e.idProduto),l=o!=null?String(o):"";if(!l)return null;const r=(e==null?void 0:e.productName)||(e==null?void 0:e.nomeProduto)||(e==null?void 0:e.nome)||(e==null?void 0:e.name)||`Produto ${n+1}`,s=Math.max(0,Number((e==null?void 0:e.quantity)??(e==null?void 0:e.qtd)??0)||0),i=Math.max(0,Number(t[l]??s)),f=Math.max(0,s-i);return{uid:`exec-load-${l}-${n}`,productId:l,productName:r,quantity:s,remaining:i,delivered:f}}).filter(Boolean)}),ot=m(()=>$.value.reduce((t,e)=>t+e.remaining,0)),$e=m(()=>$.value.reduce((t,e)=>t+e.quantity,0)),ae=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"});function Fe(t=B.value){return t.findIndex(e=>O(e.id)!=="visited")}function lt(t=null){const e=B.value;if(!e.length){y.value=0;return}if(t!=null){const n=e.findIndex(o=>String(o.id)===String(t));if(n>=0){y.value=n;return}}if(y.value>=e.length&&(y.value=e.length-1),L.value==="step"){const n=e[y.value];if(!n||O(n.id)==="visited"){const o=Fe(e);o>=0&&(y.value=o)}}}function rt(t){L.value=t,t==="step"&&lt()}function jt(t){if(t==null)return;const e=B.value.findIndex(n=>String(n.id)===String(t));e>=0&&(y.value=e)}function Kt(){const t=B.value;t.length&&y.value<t.length-1&&(y.value+=1)}function Qt(){y.value>0&&(y.value-=1)}function it(t=null){if(L.value!=="step")return;const e=B.value;if(!e.length)return;if(t!=null){const o=e.findIndex(l=>String(l.id)===String(t));o>=0&&o<e.length-1&&(y.value=o+1)}const n=Fe(e);n>=0?y.value=n:y.value>=e.length&&(y.value=e.length-1)}function Re(t){if(!t)return null;const e=x.value.find(o=>String(o.id)===String(t));if(e)return e;const n=$.value.find(o=>String(o.productId)===String(t));return n?{id:n.productId,nome:n.productName||`Produto ${n.productId}`,name:n.productName||`Produto ${n.productId}`,quantity:n.quantity}:null}function ne(t){return t&&Number(t.preco??t.valor??t.price??t.unitPrice??0)||0}function Yt(t){if(!t)return 0;const e=[t.custo,t.cost,t.precoCusto,t.unitCost,t.custoUnitario,t.custoMedio];for(const o of e){if(o==null||o==="")continue;const l=Number(o);if(Number.isFinite(l)&&l>0)return l}const n=Number(t.preco??t.valor??t.price??t.unitPrice??0);return Number.isFinite(n)?n:0}const se=m(()=>h.value.map(t=>{const e=Re(t.productId),n=ne(e),o=Math.max(0,Number(t.quantity)||0),l=(t.type||"venda").toLowerCase(),r=o*n;let s=Math.max(0,Number(t.discount)||0);(l==="brinde"||l==="troca"||s>r)&&(s=r);const i=Math.max(0,o*n-s);return{...t,product:e,price:n,type:l,quantity:o,discount:s,subtotal:i}})),ut=m(()=>{const t=$.value;if(!t.length)return[];const e=new Set(t.map(r=>String(r.productId))),n=Array.isArray(x.value)?x.value.filter(r=>e.has(String(r.id))):[];if(n.length===e.size)return n;const o=new Set(n.map(r=>String(r.id))),l=t.filter(r=>!o.has(String(r.productId))).map(r=>({id:r.productId,nome:r.productName||`Produto ${r.productId}`,name:r.productName||`Produto ${r.productId}`}));return[...n,...l]}),Wt=m(()=>ut.value.length>0),dt=m(()=>{const t=ut.value;if(!t.length)return[];const e=pe.value.trim().toLowerCase();return e?t.filter(n=>{const o=((n==null?void 0:n.nome)||(n==null?void 0:n.name)||"").toString().toLowerCase(),l=((n==null?void 0:n.codigo)||(n==null?void 0:n.sku)||"").toString().toLowerCase();return o.includes(e)||l.includes(e)}):t}),ct=m(()=>se.value.reduce((t,e)=>t+e.subtotal,0)),Xt=m(()=>ae.format(ct.value||0)),vt=m(()=>se.value.reduce((t,e)=>t+e.quantity,0)),ft=m(()=>se.value.reduce((t,e)=>t+e.discount,0));function oe(t){if(t==null)return null;const e=Number(t);return Number.isFinite(e)?String(e):String(t)}function Gt(t){if(!t||typeof t!="object")return null;const e=oe(t.productId??t.produtoId??t.idProduto??t.id);if(!e)return null;const n=Number(t.quantity??t.qtd??t.quantidade??t.amount??t.qty??0)||0;if(n<=0)return null;const o=(t.type??t.tipo??"").toString().toLowerCase(),l=t.productName||t.nome||t.name||null;return{productId:e,quantity:n,type:o,productName:l}}function Ht(t){if(!t||typeof t!="object")return[];const e=[],n=new Set,o=s=>{!Array.isArray(s)||n.has(s)||(n.add(s),e.push(s))},l=["saleItems","sale_items","saleitems","items","itens","produtos","products","payloadItems"];return l.forEach(s=>{o(t[s])}),["meta","metadata","dados","data","extra","info","sale","venda","registro","payload"].forEach(s=>{const i=t[s];!i||typeof i!="object"||l.forEach(f=>o(i[f]))}),e.flat().map(Gt).filter(Boolean)}function Jt(t){const e={};return Array.isArray(t)&&t.forEach(n=>{Ht(n).forEach(o=>{const l=Number(o.quantity)||0;!o.productId||l<=0||(e[o.productId]=(e[o.productId]||0)+l)})}),e}function Ve(t){if(!t){P.value={};return}const e=Array.isArray(t.loadItems)?t.loadItems:[];if(!e.length){P.value={};return}const n=Jt(t.checkpoints),o={};e.forEach(l=>{const r=oe((l==null?void 0:l.productId)??(l==null?void 0:l.produtoId)??(l==null?void 0:l.idProduto));if(!r)return;const s=Math.max(0,Number((l==null?void 0:l.quantity)??(l==null?void 0:l.qtd)??0)||0),i=Math.max(0,Number(n[r]??0)),f=Math.max(0,s-i);o[r]=f}),P.value=o}function Zt(t){if(!Array.isArray(t)||!t.length)return;const e={...P.value};let n=!1;t.forEach(o=>{var i;const l=oe(o.productId??((i=o==null?void 0:o.product)==null?void 0:i.id)??(o==null?void 0:o.produtoId));if(!l||!(l in e))return;const r=Math.max(0,Number(o.quantity)||0);if(!r)return;const s=Math.max(0,Number(e[l]??0)-r);s!==e[l]&&(e[l]=s,n=!0)}),n&&(P.value={...e})}function ea(t){if(!Array.isArray(t)||!t.length)return;const e={...P.value};let n=!1;t.forEach(o=>{var s;const l=oe(o.productId??((s=o==null?void 0:o.product)==null?void 0:s.id)??(o==null?void 0:o.produtoId));if(!l||!(l in e))return;const r=Math.max(0,Number(o.quantity)||0);r&&(e[l]=Number(e[l]??0)+r,n=!0)}),n&&(P.value={...e})}async function ta(t,e){if(!Array.isArray(t)||!t.length)return;const n=e?`Devolução rota ${e}`:"Devolução de carga de rota",o=[];for(const l of t){const r=(l==null?void 0:l.productId)!=null?Number(l.productId):null,s=Number((l==null?void 0:l.remaining)??0)||0;if(!(!r||s<=0))try{await za(r,{type:"DEVOLUCAO",quantity:s,note:n})}catch(i){o.push(i)}}if(o.length)throw o[0]}function le(t){const e=Number(t);return Number.isFinite(e)?e.toLocaleString("pt-BR"):"0"}const aa=m(()=>{var n,o,l,r;if(!u.value)return[];const t=G(u.value.routeId),e=((n=u.value)==null?void 0:n.startedAt)||((o=u.value)==null?void 0:o.startDate)||((l=u.value)==null?void 0:l.start_date)||((r=u.value)==null?void 0:r.createdAt);return[{id:u.value.id,rotaNome:t,inicioReal:e}]}),na=m(()=>{var t;return{origem:"rota",formaPagamento:"Pix",statusPagamento:"Pago",execucaoId:(t=u.value)!=null&&t.id?String(u.value.id):""}}),mt=m(()=>{if(!_.value)return null;const t=_.value;if(t.clientId!=null){const e=Q.value.find(n=>String(n.id)===String(t.clientId));if(e)return e}return t}),ze=m(()=>{const t=_.value;if(!t)return"";const e=t.cliente||t.clientName||t.nome||t.name||"",n=mt.value;return n&&n!==t&&(n.nome||n.name)||e}),Be=m(()=>{const t=qe.value.trim();return t||ze.value}),ge=m(()=>{const t={city:"—",document:"—",phone:"—",email:"—"};if(!_.value)return t;const e=_.value,n=mt.value,o=ye(e),l=n&&n!==e?ye(n):"",r=o&&o!=="—"?o:l&&l!=="—"?l:"—",s=gt(e)||(n&&n!==e?gt(n):""),i=yt(e)||(n&&n!==e?yt(n):""),f=bt(e)||(n&&n!==e?bt(n):"");return{city:r,document:s||"—",phone:i||"—",email:f||"—"}});function pt(t){return t==null?"":String(t).trim()}const sa=["cnpj","cpf","cnpjCpf","cnpj_cpf","cnpjOuCpf","documento","document","taxId","tax_id","inscricaoEstadual","ie","registrationNumber"],oa=["telefone","telefone1","telefone2","telefonePrincipal","telefoneCelular","phone","phoneNumber","mobile","celular","whatsapp","whatsApp","contactPhone",["contato","telefone"],["contato","celular"],["contact","phone"],["contact","mobile"]],la=["email","emailPrincipal","mail","contatoEmail","contactEmail",["contato","email"],["contact","email"]];function ra(t,e){if(t)return Array.isArray(e)?e.reduce((n,o)=>n&&n[o]!=null?n[o]:void 0,t):typeof e=="string"&&e.includes(".")?e.split(".").reduce((n,o)=>n&&n[o]!=null?n[o]:void 0,t):t[e]}function Oe(t,e){if(!t)return"";for(const n of e){const o=ra(t,n),l=pt(o);if(l)return l}return""}function gt(t){return Oe(t,sa)}function yt(t){return Oe(t,oa)}function bt(t){return Oe(t,la)}function ye(t){var n,o,l,r;if(!t)return"—";const e=[t.cidade,t.city,t.municipio,t.municipality,t.localidade,t.cityName,t.companyCity,t.addressCity,t.enderecoCidade,(n=t==null?void 0:t.endereco)==null?void 0:n.cidade,(o=t==null?void 0:t.endereco)==null?void 0:o.cidadeNome,(l=t==null?void 0:t.address)==null?void 0:l.city,(r=t==null?void 0:t.address)==null?void 0:r.cityName];for(const s of e){const i=pt(s);if(i)return i}return"—"}function re(t){const e=(t||"").toString().toLowerCase();return["pendente","pending","aguardando"].includes(e)?"pending":["visitado","visited","entregue","concluido","concluida"].includes(e)?"visited":["pulado","skipped","ignorado"].includes(e)?"skipped":["in_place","in place","em_andamento","em andamento"].includes(e)?"in_place":e||"pending"}function O(t){const e=u.value;if(!e||!Array.isArray(e.points))return"pending";const n=e.points.find(o=>String(o.pointId)===String(t));return n?re(n.status):"pending"}function be(t){const e=re(t);return e==="visited"?"visited":e==="skipped"?"skipped":"pending"}function ht(t){const e=re(t);return{visited:"Entregue",skipped:"Pulado",pending:"Pendente"}[e]||"Pendente"}function ia(t){const e=(t||"").toString().toLowerCase();return e==="in_progress"?"Em andamento":e==="completed"||e==="finished"?"Concluída":e==="pending"?"Aguardando":t||"—"}function G(t){const e=He.value.find(n=>String(n.id)===String(t));return e?e.nome||e.name:"-"}function ua(t){try{return t?new Date(t).toLocaleString():"—"}catch{return t||"—"}}function da(){window.history.back()}let _t=0;function ca(t={}){return _t+=1,{id:`${Date.now()}-${_t}`,productId:"",quantity:1,discount:0,type:"venda",...t}}function va(t){const e=t==null?void 0:t.id;if(e==null)return;const n=String(e);z.value=z.value===n?"":n}function Ue(t,e){if(!t)return;const n=fa(e);n!=null&&(It(t,e,n),z.value="")}function It(t,e="venda",n=1){if(!t)return;const o=t.id??t.produtoId??t.codigoId;if(o==null)return;const l=String(o),r=(e||"venda").toLowerCase(),s=h.value.find(b=>String(b.productId)===l&&(b.type||"venda")===r);if(s){const b=Math.max(1,Number(s.quantity)||0);s.quantity=b+Math.max(1,n);return}const i=ne(t),f={productId:l,quantity:Math.max(1,n),type:r};(r==="brinde"||r==="troca")&&(f.discount=f.quantity*i),h.value=[...h.value,ca(f)]}function je(t,e){const n=h.value[t];if(!n)return;const o=(n.type||"venda").toLowerCase(),l=(e||"venda").toLowerCase();n.type=l;const r=Re(n.productId),s=ne(r),i=Math.max(0,Number(n.quantity)||0)*s;l==="brinde"||l==="troca"?n.discount=i:(n.discount=Math.max(0,Number(n.discount)||0),(o==="brinde"||o==="troca")&&(n.discount=0),n.discount>i&&(n.discount=i))}function fa(t){const n=`Informe a quantidade para ${t==="brinde"?"brinde":t==="troca"?"troca":"venda"}`,o=window.prompt(n,"1");if(o===null)return null;const l=Number(o);return!Number.isFinite(l)||l<=0?(window.alert("Quantidade inválida. Operação cancelada."),null):Math.round(l)}function ma(t){const e=h.value.slice();e.splice(t,1),h.value=e}function pa(t){const e=(t==null?void 0:t.produto)||(t==null?void 0:t.productName)||(t==null?void 0:t.nome)||(t==null?void 0:t.name)||"Entrega",n=Number((t==null?void 0:t.precoSugerido)||(t==null?void 0:t.preco)||(t==null?void 0:t.valor)||0)||0;return{name:e,price:n}}async function Ke(t){if(!t)return[];if(!Q.value.length)try{await Qe()}catch(e){return console.warn("Falha ao carregar clientes antes de mapear rota",e),[]}try{const e=await Da(t),n=Array.isArray(e==null?void 0:e.pontos)?e.pontos:[];if(!n.length)return[];const o=new Map(Q.value.map(l=>[String(l.id),l]));return n.map((l,r)=>{const s=String(l),i=o.get(s)||{},f=i.cidade||i.city||i.municipio||i.localidade||i.cityName||i.addressCity||i.companyCity||"";return{id:i.id??l,ordem:r+1,clientId:i.id??l,nome:i.nome||i.name||i.razaoSocial||`Cliente ${r+1}`,endereco:i.endereco||i.address||i.companyAddress||i.logradouro||"",cidade:f,...i}})}catch(e){return console.warn("Falha ao carregar rota para mapear clientes",e),[]}}async function ga(t,e,n){const o=t.filter(g=>{const F=(g.type||"").toLowerCase();return F==="brinde"||F==="troca"});if(!o.length)return;const l=new Date().toISOString().slice(0,10),r=e!=null&&e.routeId?G(e.routeId):"",s=(n==null?void 0:n.nome)||(n==null?void 0:n.name)||"",i=o.map(g=>{var _e,Ie;const F=Yt(g.product)||g.price||0,ue=Number.isFinite(F)?Number((F*g.quantity).toFixed(2)):0;if(!ue)return null;const I=(g.type||"").toLowerCase()==="troca"?"Troca":"Brinde",U=((_e=g.product)==null?void 0:_e.nome)||((Ie=g.product)==null?void 0:Ie.name)||g.nome||g.name||"Produto",j=[`${I} - ${U}`];return s&&j.push(`Cliente: ${s}`),r&&j.push(`Rota: ${r}`),Fa({descricao:j.join(" | "),categoria:I,valor:ue,data:l,pago:!0})}).filter(Boolean);if(!i.length)return;const b=(await Promise.allSettled(i)).find(g=>g.status==="rejected");if(b)throw b.reason||new Error("Falha ao registrar custos de brindes/trocas")}function St(t,e=4e3){t&&(D&&(clearTimeout(D),D=null),Ae.value=t,xe.value=!0,D=setTimeout(()=>{xe.value=!1,Ae.value="",D=null},e))}async function Nt(){if(M.value=!M.value,M.value&&(me.value&&H(),!x.value.length))try{await he()}catch(t){console.warn("Falha ao carregar produtos para venda avulsa",t)}}function ya(t=null){const e=t!=null&&t.metodo?` (${t.metodo})`:"";q.value=`Venda avulsa registrada${e}.`,St("Venda avulsa registrada com sucesso."),M.value=!1}async function Qe(){try{const t=await Ra();Array.isArray(t)&&(Q.value=t)}catch(t){console.warn("Falha ao carregar clientes",t)}}async function he(){try{const t=await Va();Array.isArray(t)&&(x.value=t)}catch(t){console.warn("Falha ao carregar produtos",t)}}async function ie(t=null){const e=t!=null?String(t):Je.value;if(ce.value){fe.value=e;return}ce.value=!0,ve.value="",V.value="";try{Q.value.length||await Qe(),x.value.length||await he(),He.value=await Ta();const n=await Ma(null,"in_progress"),l=(Array.isArray(n)?n:[]).filter(s=>{const i=et(s.status);return!Ze.includes(i)});let r=null;if(e&&(r=l.find(s=>String(s.id)===e)||null,!r))try{const s=await Ee(e);s&&(r=s)}catch(s){console.warn("Execução informada não encontrada ou indisponível",s)}if(!r&&l.length&&(r=[...l].sort((i,f)=>nt(f)-nt(i))[0]),r&&r.id){const s=await Ee(r.id);tt(s)?(u.value=s,C.value=s!=null&&s.routeId?await Ke(s.routeId):[],Ve(u.value),R.setActive({...u.value,routeName:G(u.value.routeId)}),lt()):(u.value=null,C.value=[],P.value={},R.clearActive())}else u.value=null,C.value=[],P.value={},R.clearActive();u.value?_.value&&(C.value.some(i=>{var f;return String(i.id)===String((f=_.value)==null?void 0:f.id)})||H()):(H(),M.value=!1)}catch(n){ve.value=(n==null?void 0:n.message)||"Erro ao carregar execução"}finally{if(ce.value=!1,fe.value!==null){const n=fe.value;fe.value=null,await ie(n)}}}async function ba(){var l;if(!u.value||J.value||!window.confirm("Deseja concluir a rota em andamento?"))return;J.value=!0,V.value="",q.value="";const e=$.value.filter(r=>r.remaining>0).map(r=>({productId:r.productId,remaining:r.remaining})),n=G(u.value.routeId);let o="";try{const r=await La(u.value.id);if(u.value=r,R.clearActive(),e.length)try{await ta(e,n)}catch(i){console.warn("Falha ao devolver carga restante ao estoque",i),o=" Não foi possível devolver parte da carga restante ao estoque."}if(!o){const i={};(Array.isArray((l=u.value)==null?void 0:l.loadItems)?u.value.loadItems:[]).forEach(b=>{const g=oe((b==null?void 0:b.productId)??(b==null?void 0:b.produtoId)??(b==null?void 0:b.idProduto));g&&(i[g]=0)}),P.value=i}St(o?"Rota concluída com aviso.":"Rota concluída com sucesso."),q.value=o?`Execução concluída.${o}`:"Execução concluída.",T&&(clearTimeout(T),T=null),T=setTimeout(()=>{Lt.push("/executar-rota"),J.value=!1,T=null},3e3)}catch(r){V.value=(r==null?void 0:r.message)||"Erro ao concluir execução",J.value=!1}}function Ye(){h.value=[],W.value="Pix",Z.value="Pago",pe.value="",z.value="",qe.value="",A.value=""}async function wt(t){if(!u.value)return;const e=String(u.value.status||"").toLowerCase();if(e==="completed"||e==="finished")return;Te.value=t.id,setTimeout(()=>{Te.value=null},600),L.value==="step"&&jt(t.id),_.value=t,Y.value="",A.value="",Ye();const n=pa(t),o=(t==null?void 0:t.productId)||(t==null?void 0:t.produtoId)||(t==null?void 0:t.idProduto)||null;x.value.length||await he();const l=Array.isArray(x.value)?x.value:[],r=Math.max(1,Number((t==null?void 0:t.quantidadeSugerida)||(t==null?void 0:t.quantidade)||1)||1);let s=null;if(o&&(s=l.find(i=>String(i.id)===String(o))||null),!s&&n.name){const i=n.name.toString().toLowerCase();s=l.find(f=>((f==null?void 0:f.nome)||(f==null?void 0:f.name)||"").toString().toLowerCase()===i)||null}s&&It(s,"venda",r),W.value="Pix",Z.value="Pago",me.value=!0}function H(){me.value=!1,_.value=null,Y.value="",Ye()}async function ha(){var f,b,g,F,ue;A.value="",q.value="";const t=(f=_.value)==null?void 0:f.id;let e="",n=!1;if(!u.value||!_.value){A.value="Execução ou cliente inválido.";return}const o=se.value.filter(I=>I.product);if(!o.length){A.value="Adicione ao menos um produto.";return}if(o.find(I=>I.quantity<=0)){A.value="Informe uma quantidade válida para os produtos selecionados.";return}const r=vt.value;if(!r){A.value="Informe ao menos uma unidade entregue.";return}const s=ct.value,i=o.every(I=>{const U=(I.type||"").toLowerCase();return U==="brinde"||U==="troca"});if(s<=0&&!i){A.value="O total da venda deve ser maior que zero quando houver itens de venda.";return}try{const I=qe.value.trim(),U=!!I,j=U?null:(b=_.value)!=null&&b.clientId?Number(_.value.clientId):null,_e=Be.value&&Be.value!=="—"?Be.value:null,Ie=U?I:j?null:_e,Se=o.map((w,Ia)=>{var Pt,Et,At;const Ct=(w.type||"venda").toLowerCase(),Sa=Ct==="brinde";return{produtoId:((Pt=w.product)==null?void 0:Pt.id)??null,nome:((Et=w.product)==null?void 0:Et.nome)||((At=w.product)==null?void 0:At.name)||`Produto ${Ia+1}`,qtd:w.quantity,preco:w.price,desconto:w.discount,brinde:Sa,tipo:Ct}}),_a={clientId:j,clientName:j?null:Ie,origem:"rota",execucaoId:((g=u.value)==null?void 0:g.id)??null,paymentMethod:W.value,paymentStatus:Z.value,items:Se,total:s,observacoes:Y.value||"",pontoId:((F=_.value)==null?void 0:F.id)??null,rotaId:((ue=u.value)==null?void 0:ue.routeId)??null},We=await $a(_a);Zt(o),n=!0;try{await ga(o,u.value,_.value)}catch(w){console.warn("Falha ao registrar custos de brindes/trocas",w),e=" Não foi possível registrar os custos de brindes/trocas. Verifique em Despesas."}u.value=await Dt(u.value.id,_.value.id,"visited",{quantity:r,notes:Y.value,saleId:(We==null?void 0:We.id)??null,saleTotal:s,paymentMethod:W.value,saleItem:Se.map(w=>w.nome).join(", "),productIds:Se.map(w=>w.produtoId).filter(Boolean),unitPrice:r?s/r:null,discount:ft.value,saleItems:Se}),C.value=await Ke(u.value.routeId),u.value=await Ee(u.value.id),Ve(u.value),it(t),H(),q.value=`Entrega registrada e venda salva.${e}`}catch(I){n&&ea(o),A.value=(I==null?void 0:I.message)||"Erro ao registrar venda"}}async function kt(t,e){if(!(!u.value||!ee.value)){V.value="",q.value="";try{u.value=await Dt(u.value.id,t,e),C.value=await Ke(u.value.routeId),u.value=await Ee(u.value.id),it(t),q.value="Status atualizado."}catch(n){V.value=(n==null?void 0:n.message)||"Erro ao atualizar cliente"}}}return Ne(C,t=>{if(!Array.isArray(t)||!t.length){y.value=0;return}if(y.value>=t.length&&(y.value=t.length-1),L.value==="step"){const e=t[y.value];if(!e||O(e.id)==="visited"){const n=Fe(t);n>=0&&(y.value=n)}}}),Ne(Je,(t,e)=>{t!==e&&ie(t)}),Ne(u,t=>{t?(R.setActive({...t,routeName:G(t.routeId)}),Ve(t)):(R.clearActive(),P.value={})}),Ne(h,t=>{t.forEach(e=>{e.quantity=Math.max(1,Number(e.quantity)||0),e.type=(e.type||"venda").toLowerCase();const n=Re(e.productId),o=ne(n),l=e.quantity*o;e.type==="brinde"||e.type==="troca"?e.discount=l:(e.discount=Math.max(0,Number(e.discount)||0),e.discount>l&&(e.discount=l))})},{deep:!0}),Ye(),ka(async()=>{await Qe(),await he(),await ie()}),Ca(()=>{T&&(clearTimeout(T),T=null),D&&(clearTimeout(D),D=null),u.value||R.clearActive()}),(t,e)=>{var n,o,l,r;return c(),v("section",ja,[a("div",Ka,[e[10]||(e[10]=a("h2",null,"Rota em Andamento",-1)),u.value?(c(),v("div",Qa,[a("button",{class:"btn btn-light",type:"button",onClick:e[0]||(e[0]=s=>ie())},[...e[9]||(e[9]=[a("i",{class:"fa-solid fa-arrows-rotate"},null,-1),N(" Atualizar ",-1)])])])):S("",!0)]),V.value?(c(),v("div",Ya,d(V.value),1)):S("",!0),q.value?(c(),v("div",Wa,d(q.value),1)):S("",!0),we(Ge,{name:"toast"},{default:Xe(()=>[xe.value?(c(),v("div",Xa,[e[11]||(e[11]=a("i",{class:"fa-solid fa-circle-check"},null,-1)),a("span",null,d(Ae.value),1)])):S("",!0)]),_:1}),ve.value?(c(),xt(Ba,{key:2,message:ve.value,retry:ie},null,8,["message"])):ce.value?(c(),xt(Oa,{key:3,message:"Carregando execução…"})):u.value?(c(),v("div",Ha,[a("div",Ja,[a("div",Za,[a("div",null,[e[15]||(e[15]=a("span",null,"Rota",-1)),a("h3",null,d(G(u.value.routeId)),1)]),a("div",en,[a("span",{class:k(["status-chip",ee.value?"status-active":"status-idle"])},d(ia(u.value.status)),3),a("span",tn,d(Le.value)+"%",1)])]),a("div",an,[a("div",nn,[e[16]||(e[16]=a("span",null,"Atendidos",-1)),a("strong",null,d(te.value),1)]),a("div",sn,[e[17]||(e[17]=a("span",null,"Pendentes",-1)),a("strong",null,d(Me.value),1)]),a("div",on,[e[18]||(e[18]=a("span",null,"Pulados",-1)),a("strong",null,d(st.value),1)]),a("div",ln,[e[19]||(e[19]=a("span",null,"Início",-1)),a("strong",null,d(ua(u.value.startedAt)),1)]),$.value.length?(c(),v("div",rn,[e[20]||(e[20]=a("span",null,"Carga restante",-1)),a("strong",null,d(le(ot.value)),1),$e.value&&$e.value!==ot.value?(c(),v("small",un," de "+d(le($e.value)),1)):S("",!0)])):S("",!0)])]),a("div",dn,[a("div",cn,[a("div",vn,[a("div",fn,[a("div",mn,[e[21]||(e[21]=a("h3",null,"Clientes da rota",-1)),a("span",pn,d(te.value)+" de "+d(X.value)+" visitados",1)]),a("div",gn,[a("button",{type:"button",class:k(["toggle-btn",{"is-active":L.value==="list"}]),onClick:e[1]||(e[1]=s=>rt("list"))},[...e[22]||(e[22]=[a("i",{class:"fa-solid fa-list","aria-hidden":"true"},null,-1),a("span",null,"Lista",-1)])],2),a("button",{type:"button",class:k(["toggle-btn",{"is-active":L.value==="step"}]),onClick:e[2]||(e[2]=s=>rt("step")),disabled:!C.value.length},[...e[23]||(e[23]=[a("i",{class:"fa-solid fa-person-walking","aria-hidden":"true"},null,-1),a("span",null,"Passo a passo",-1)])],10,yn)])]),a("div",bn,[C.value.length?(c(),v(de,{key:1},[L.value==="list"?(c(),v("div",_n,[(c(!0),v(de,null,ke(C.value,(s,i)=>(c(),v("div",{key:s.id,class:k(["point-row clickable",[be(O(s.id)),{"active-click":Te.value===s.id}]]),onClick:f=>wt(s)},[a("div",Sn,[a("div",Nn,d(s.ordem||i+1),1),a("div",wn,d(s.nome||s.name),1),a("div",kn,d(ye(s)),1)]),a("div",Cn,[a("span",{class:k(["status-tag",be(O(s.id))])},d(ht(O(s.id))),3),a("button",{class:"btn btn-icon btn-skip",type:"button",disabled:!ee.value,onClick:qt(f=>kt(s.id,"skipped"),["stop"])},[...e[24]||(e[24]=[a("i",{class:"fa-solid fa-forward-step"},null,-1)])],8,Pn)])],10,In))),128))])):(c(),v("div",En,[E.value&&Me.value>0?(c(),v("div",{key:0,class:k(["stepper-card",be(De.value)])},[a("div",An,[a("div",null,[a("span",xn,"Ponto "+d(y.value+1)+" de "+d(X.value),1),a("h4",qn,d(E.value.nome||E.value.name),1),a("p",Tn,d(ye(E.value)),1)]),a("span",{class:k(["status-tag",be(De.value)])},d(ht(De.value)),3)]),E.value.endereco||E.value.address?(c(),v("div",Dn,[e[25]||(e[25]=a("i",{class:"fa-solid fa-location-dot","aria-hidden":"true"},null,-1)),a("span",null,d(E.value.endereco||E.value.address),1)])):S("",!0),a("div",Mn,[a("button",{type:"button",class:"btn btn-outline",disabled:!Ft.value,onClick:Qt},[...e[26]||(e[26]=[a("i",{class:"fa-solid fa-arrow-left"},null,-1),N(" Anterior ",-1)])],8,Ln),a("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=s=>wt(E.value))},[...e[27]||(e[27]=[a("i",{class:"fa-solid fa-clipboard-check"},null,-1),N(" Registrar entrega ",-1)])]),a("button",{type:"button",class:"btn btn-warning",disabled:!ee.value,onClick:e[4]||(e[4]=s=>kt(E.value.id,"skipped"))},[...e[28]||(e[28]=[a("i",{class:"fa-solid fa-forward-step"},null,-1),N(" Pular ponto ",-1)])],8,$n),a("button",{type:"button",class:"btn btn-outline",disabled:!$t.value,onClick:Kt},[...e[29]||(e[29]=[N(" Avançar ",-1),a("i",{class:"fa-solid fa-arrow-right"},null,-1)])],8,Fn)])],2)):(c(),v("div",Rn,[...e[30]||(e[30]=[a("i",{class:"fa-solid fa-check-double","aria-hidden":"true"},null,-1),a("p",null,"Todos os clientes foram atendidos. Excelente trabalho!",-1)])]))]))],64)):(c(),v("div",hn," Nenhum cliente cadastrado para esta rota. "))])])]),a("aside",Vn,[a("div",zn,[e[38]||(e[38]=a("div",{class:"panel-header"},[a("h3",null,"Resumo")],-1)),a("div",Bn,[a("ul",On,[a("li",Un,[a("div",jn,[e[31]||(e[31]=a("span",null,"Progresso",-1)),a("strong",null,d(te.value)+" / "+d(X.value),1)]),a("div",Kn,[a("div",{class:"progress-fill",style:Pa({width:Le.value+"%"})},null,4)]),a("small",Qn,d(Le.value)+"%",1)]),a("li",Yn,[e[33]||(e[33]=a("i",{class:"fa-solid fa-user"},null,-1)),a("div",null,[e[32]||(e[32]=a("span",null,"Motorista",-1)),a("strong",null,d(((n=u.value.metadata)==null?void 0:n.motorista)||"—"),1)])]),a("li",Wn,[e[35]||(e[35]=a("i",{class:"fa-solid fa-truck"},null,-1)),a("div",null,[e[34]||(e[34]=a("span",null,"Veículo",-1)),a("strong",null,d(((o=u.value.metadata)==null?void 0:o.veiculo)||"—"),1)])]),a("li",Xn,[e[37]||(e[37]=a("i",{class:"fa-solid fa-list-check"},null,-1)),a("div",null,[e[36]||(e[36]=a("span",null,"Clientes pendentes",-1)),a("strong",null,d(Me.value),1)])])])])]),$.value.length?(c(),v("div",Gn,[e[39]||(e[39]=a("div",{class:"panel-header"},[a("h3",null,"Carga separada")],-1)),a("div",Hn,[a("ul",Jn,[(c(!0),v(de,null,ke($.value,s=>(c(),v("li",{key:s.uid},[a("div",Zn,d(s.productName||"Produto"),1),a("div",es,[a("span",ts,d(le(s.remaining))+" un.",1),s.delivered>0?(c(),v("small",as,"Entregues: "+d(le(s.delivered)),1)):S("",!0),a("small",ns,"Inicial: "+d(le(s.quantity)),1)])]))),128))])])])):S("",!0),a("div",ss,[e[41]||(e[41]=a("div",{class:"panel-header"},[a("h3",null,"Venda avulsa")],-1)),a("div",os,[e[40]||(e[40]=a("p",null,"Registre uma venda fora dos clientes da rota atual.",-1)),a("button",{class:"btn btn-primary btn-standalone",type:"button",onClick:Nt},[a("i",{class:k(["fa-solid",M.value?"fa-circle-minus":"fa-cart-plus"])},null,2),N(" "+d(M.value?"Fechar venda avulsa":"Nova venda avulsa"),1)])])])])]),we(Ge,{name:"fade"},{default:Xe(()=>[M.value?(c(),v("section",ls,[a("div",{class:"panel-header standalone-header"},[e[43]||(e[43]=a("h3",null,"Venda avulsa durante a rota",-1)),a("button",{class:"btn btn-link btn-close-panel",type:"button",onClick:Nt},[...e[42]||(e[42]=[a("i",{class:"fa-solid fa-xmark"},null,-1),N(" Fechar ",-1)])])]),a("div",rs,[we(Ua,{clients:Q.value,execucoes:aa.value,catalogo:x.value,defaults:na.value,onSaved:ya},null,8,["clients","execucoes","catalogo","defaults"])])])):S("",!0)]),_:1}),u.value?(c(),v("div",is,[a("button",{class:"btn btn-secondary btn-finish",type:"button",onClick:ba,disabled:!Ut.value||J.value},[...e[44]||(e[44]=[a("i",{class:"fa-solid fa-flag-checkered"},null,-1),N(" Concluir Execução ",-1)])],8,us)])):S("",!0)])):(c(),v("div",Ga,[e[13]||(e[13]=a("h3",null,"Nenhuma rota em andamento",-1)),e[14]||(e[14]=a("p",null,"Inicie uma execução na página “Executar Rota” para acompanhar os clientes aqui.",-1)),a("button",{class:"btn btn-primary",type:"button",onClick:da},[...e[12]||(e[12]=[a("i",{class:"fa-solid fa-arrow-left"},null,-1),N(" Voltar ",-1)])])])),K(a("div",ds,[a("div",cs,[a("div",vs,[a("div",{class:"modal-header"},[e[46]||(e[46]=a("h3",null,"Registrar entrega",-1)),a("button",{class:"btn-close",type:"button",onClick:H},[...e[45]||(e[45]=[a("i",{class:"fa-solid fa-times"},null,-1)])])]),a("form",{onSubmit:qt(ha,["prevent"])},[a("div",fs,[a("div",ms,[e[51]||(e[51]=a("label",null,"Cliente da rota",-1)),a("div",null,[a("strong",null,d(((l=_.value)==null?void 0:l.nome)||((r=_.value)==null?void 0:r.name)||"—"),1),ze.value?(c(),v("div",ps,d(ze.value),1)):S("",!0),a("div",gs,[a("div",ys,[e[47]||(e[47]=a("span",{class:"client-meta-label"},"Cidade",-1)),a("span",bs,d(ge.value.city),1)]),a("div",hs,[e[48]||(e[48]=a("span",{class:"client-meta-label"},"CNPJ/CPF",-1)),a("span",_s,d(ge.value.document),1)]),a("div",Is,[e[49]||(e[49]=a("span",{class:"client-meta-label"},"Telefone",-1)),a("span",Ss,d(ge.value.phone),1)]),a("div",Ns,[e[50]||(e[50]=a("span",{class:"client-meta-label"},"E-mail",-1)),a("span",ws,d(ge.value.email),1)])])])]),a("div",ks,[a("div",Cs,[e[52]||(e[52]=a("label",{for:"modal-search-produto"},"Buscar produto",-1)),K(a("input",{id:"modal-search-produto",class:"form-control",type:"search","onUpdate:modelValue":e[5]||(e[5]=s=>pe.value=s),placeholder:"Digite para filtrar produtos"},null,512),[[Ce,pe.value]])]),Wt.value?dt.value.length?(c(),v("div",As,[(c(!0),v(de,null,ke(dt.value,s=>(c(),v("div",{key:s.id,class:k(["product-card",{expanded:z.value===String(s.id)}])},[a("button",{type:"button",class:"product-card-header",onClick:i=>va(s)},[a("div",qs,[a("strong",null,d(s.nome||s.name),1),a("small",null,d(Pe(ae).format(ne(s)||0)),1)]),a("i",{class:k(["fa-solid",z.value===String(s.id)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,xs),we(Ge,{name:"fade"},{default:Xe(()=>[z.value===String(s.id)?(c(),v("div",Ts,[a("button",{type:"button",class:"action-btn action-sale",onClick:i=>Ue(s,"venda")},[...e[53]||(e[53]=[a("i",{class:"fa-solid fa-hand-holding-dollar"},null,-1),N(" Venda ",-1)])],8,Ds),a("button",{type:"button",class:"action-btn action-gift",onClick:i=>Ue(s,"brinde")},[...e[54]||(e[54]=[a("i",{class:"fa-solid fa-gift"},null,-1),N(" Brinde ",-1)])],8,Ms),a("button",{type:"button",class:"action-btn action-exchange",onClick:i=>Ue(s,"troca")},[...e[55]||(e[55]=[a("i",{class:"fa-solid fa-rotate"},null,-1),N(" Troca ",-1)])],8,Ls)])):S("",!0)]),_:2},1024)],2))),128))])):(c(),v("div",Es," Nenhum produto encontrado para a busca. ")):(c(),v("div",Ps," Nenhum produto separado para esta rota. "))]),h.value.length?(c(),v("div",$s,[e[59]||(e[59]=a("h4",{class:"selected-title"},"Itens selecionados",-1)),(c(!0),v(de,null,ke(se.value,(s,i)=>{var f,b;return c(),v("div",{key:s.id,class:"selected-card"},[a("div",Fs,[a("div",Rs,[a("strong",null,d(((f=s.product)==null?void 0:f.nome)||((b=s.product)==null?void 0:b.name)||"Produto"),1),a("small",Vs,d(Pe(ae).format(s.price||0)),1)]),a("button",{type:"button",class:"btn btn-link btn-remove-item",onClick:g=>ma(i)},[...e[56]||(e[56]=[a("i",{class:"fa-solid fa-trash-can"},null,-1),N(" Remover ",-1)])],8,zs)]),a("div",Bs,[a("label",{class:"sr-only",for:"qty-"+s.id},"Quantidade",8,Os),K(a("input",{id:"qty-"+s.id,class:"form-control qty-input",type:"number",min:"1",step:"1","onUpdate:modelValue":g=>h.value[i].quantity=g},null,8,Us),[[Ce,h.value[i].quantity,void 0,{number:!0}]]),a("div",js,[a("button",{type:"button",class:k(["type-btn",{active:h.value[i].type==="venda"}]),onClick:g=>je(i,"venda")},"Venda",10,Ks),a("button",{type:"button",class:k(["type-btn",{active:h.value[i].type==="brinde"}]),onClick:g=>je(i,"brinde")},"Brinde",10,Qs),a("button",{type:"button",class:k(["type-btn",{active:h.value[i].type==="troca"}]),onClick:g=>je(i,"troca")},"Troca",10,Ys)]),h.value[i].type==="venda"?(c(),v("div",Ws,[e[57]||(e[57]=a("label",null,"Desconto",-1)),K(a("input",{class:"form-control",type:"number",min:"0",step:"0.01","onUpdate:modelValue":g=>h.value[i].discount=g},null,8,Xs),[[Ce,h.value[i].discount,void 0,{number:!0}]])])):(c(),v("div",Gs,d(h.value[i].type==="troca"?"Troca sem cobrança.":"Brinde sem cobrança."),1)),a("div",Hs,[e[58]||(e[58]=a("span",null,"Subtotal",-1)),a("strong",null,d(Pe(ae).format(s.subtotal||0)),1)])])])}),128))])):S("",!0),a("div",Js,[a("div",Zs,[e[60]||(e[60]=a("span",null,"Total de itens",-1)),a("strong",null,d(vt.value),1)]),a("div",eo,[e[61]||(e[61]=a("span",null,"Desconto total",-1)),a("strong",null,d(Pe(ae).format(ft.value||0)),1)]),a("div",to,[e[62]||(e[62]=a("span",null,"Total da venda",-1)),a("strong",null,d(Xt.value),1)])]),a("div",ao,[a("div",no,[e[64]||(e[64]=a("label",null,"Forma de pagamento",-1)),K(a("select",{class:"form-control","onUpdate:modelValue":e[6]||(e[6]=s=>W.value=s)},[...e[63]||(e[63]=[Aa('<option value="Dinheiro" data-v-d2051032>Dinheiro</option><option value="Pix" data-v-d2051032>Pix</option><option value="Cartão" data-v-d2051032>Cartão</option><option value="Boleto" data-v-d2051032>Boleto</option><option value="Outro" data-v-d2051032>Outro</option>',5)])],512),[[Tt,W.value]])]),a("div",so,[e[66]||(e[66]=a("label",null,"Status do pagamento",-1)),K(a("select",{class:"form-control","onUpdate:modelValue":e[7]||(e[7]=s=>Z.value=s)},[...e[65]||(e[65]=[a("option",{value:"Pago"},"Pago",-1),a("option",{value:"Pendente"},"Pendente",-1),a("option",{value:"Parcial"},"Parcial",-1)])],512),[[Tt,Z.value]])])]),a("div",oo,[e[67]||(e[67]=a("label",null,"Observações (opcional)",-1)),K(a("textarea",{class:"form-control",rows:"2","onUpdate:modelValue":e[8]||(e[8]=s=>Y.value=s)},null,512),[[Ce,Y.value]])]),A.value?(c(),v("div",lo,d(A.value),1)):S("",!0)]),a("div",{class:"modal-footer"},[a("button",{type:"button",class:"btn btn-secondary",onClick:H},"Cancelar"),e[68]||(e[68]=a("button",{type:"submit",class:"btn btn-success"},[a("i",{class:"fa-solid fa-check"}),N(" Efetivar venda ")],-1))])],32)])])],512),[[Ea,me.value]])])}}},_o=Na(ro,[["__scopeId","data-v-d2051032"]]);export{_o as default};
