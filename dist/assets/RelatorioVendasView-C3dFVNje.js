import{r as s,c as N,o as j,a as c,b as o,f as n,B as _,e as E,m as x,v as V,h as B,t as r,F as S,g as q}from"./index-IzLOKglm.js";import{l as A}from"./sales-5D-YZoeD.js";import{B as I,a as M}from"./BaseError-DNv4Myx8.js";/* empty css                                                                  */const O={class:"content-area"},Y={class:"page-header",style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"1rem"}},$={class:"page-actions",style:{display:"flex",gap:".5rem","flex-wrap":"wrap","align-items":"center"}},z=["disabled"],G=["disabled"],H={key:2,class:"card",style:{"margin-bottom":"1rem",display:"flex",gap:"1rem","flex-wrap":"wrap"}},J={key:3,class:"table-wrap"},K={class:"data-table"},ee={__name:"RelatorioVendasView",setup(P){const D=s([]),u=s(!1),i=s(""),f=s(""),m=s(""),p=s("");function k(e){try{return e?new Date(e).toLocaleString():"-"}catch{return"-"}}function g(e){try{const t=new Date(e);return isNaN(t)?null:t}catch{return null}}function L(e){const t=g(e.date||e.data||e.dataVenda||e.createdAt);if(!t)return!0;if(m.value){const a=g(m.value);if(a&&t<new Date(a.getFullYear(),a.getMonth(),a.getDate()))return!1}if(p.value){const a=g(p.value);if(a&&t>new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59,999))return!1}return!0}function y(e){return e.cliente&&(e.cliente.nome||e.cliente.name)?e.cliente.nome||e.cliente.name:e.clienteNome||e.clientName||e.customer||"-"}function R(e){const t=Number(e.qtd||e.quantity||e.quantidade||1),a=Number(e.preco||e.precoUnit||e.price||e.valor||0);return t*a}function b(e){return typeof e.total=="number"?e.total:typeof e.valorTotal=="number"?e.valorTotal:(e.itens||e.items||[]).reduce((a,w)=>a+R(w),0)}const d=N(()=>{const e=(f.value||"").toLowerCase();return D.value.filter(t=>L(t)?e?[String(t.id||""),y(t)||"",t.observacoes||t.notes||""].join(" ").toLowerCase().includes(e):!0:!1)}),T=N(()=>d.value.reduce((e,t)=>e+b(t),0));async function h(){u.value=!0,i.value="";try{D.value=await A()}catch(e){i.value=(e==null?void 0:e.message)||"Erro ao carregar vendas"}finally{u.value=!1}}function F(){const e=["ID","Data","Cliente","Itens","Total"],t=d.value.map(l=>[l.id,k(l.date||l.data||l.dataVenda||l.createdAt),y(l),(l.itens||l.items||[]).length,b(l).toFixed(2)]),a=[e.join(","),...t.map(l=>l.map(U=>'"'+String(U).replace(/"/g,'""')+'"').join(","))].join(`
`),w=new Blob([a],{type:"text/csv;charset=utf-8;"}),C=URL.createObjectURL(w),v=document.createElement("a");v.href=C,v.download="relatorio-vendas.csv",v.click(),URL.revokeObjectURL(C)}return j(h),(e,t)=>(o(),c("section",O,[n("div",Y,[t[3]||(t[3]=n("h2",{style:{margin:"0"}},"Relatório de Vendas",-1)),n("div",$,[x(n("input",{class:"form-control",type:"date","onUpdate:modelValue":t[0]||(t[0]=a=>m.value=a)},null,512),[[V,m.value]]),x(n("input",{class:"form-control",type:"date","onUpdate:modelValue":t[1]||(t[1]=a=>p.value=a)},null,512),[[V,p.value]]),x(n("input",{class:"form-control",style:{"min-width":"220px"},placeholder:"Cliente ou texto…","onUpdate:modelValue":t[2]||(t[2]=a=>f.value=a)},null,512),[[V,f.value,void 0,{trim:!0}]]),n("button",{class:"btn btn-secondary",onClick:h,disabled:u.value},"Atualizar",8,z),n("button",{class:"btn btn-outline",onClick:F,disabled:!d.value.length},"Exportar CSV",8,G)])]),i.value?(o(),_(I,{key:0,message:i.value,retry:h},null,8,["message"])):u.value?(o(),_(M,{key:1,message:"Carregando vendas…"})):(o(),c("div",H,[n("div",null,[t[4]||(t[4]=n("strong",null,"Vendas:",-1)),B(" "+r(d.value.length),1)]),n("div",null,[t[5]||(t[5]=n("strong",null,"Total:",-1)),B(" R$ "+r(T.value.toFixed(2)),1)])])),!u.value&&!i.value?(o(),c("div",J,[n("table",K,[t[6]||(t[6]=n("thead",null,[n("tr",null,[n("th",null,"ID"),n("th",null,"Data"),n("th",null,"Cliente"),n("th",null,"Itens"),n("th",null,"Total (R$)")])],-1)),n("tbody",null,[(o(!0),c(S,null,q(d.value,a=>(o(),c("tr",{key:a.id},[n("td",null,r(a.id),1),n("td",null,r(k(a.date||a.data||a.dataVenda||a.createdAt)),1),n("td",null,r(y(a)),1),n("td",null,r((a.itens||a.items||[]).length),1),n("td",null,r(b(a).toFixed(2)),1)]))),128))])])])):E("",!0)]))}};export{ee as default};
