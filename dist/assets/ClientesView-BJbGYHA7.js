import{_ as Q,r as p,x as L,c as j,B as M,o as W,a as i,b as r,f as o,z as $,e as E,j as d,v as u,F as X,g as Y,t as c,w as V,A as ee,C as oe,n as T,D as k}from"./index-CXM7zIvA.js";import{B as te,a as se}from"./BaseError-DaDu2INT.js";import{l as ne,d as ae,u as re,c as le}from"./clients-BkLJVsW5.js";/* empty css                                                                  */const ie={class:"content-area clients-view"},de={key:2,class:"clients-content"},ue={key:0,class:"clients-toolbar"},ce={class:"search-box"},pe={key:1,class:"empty-state"},me={key:2,class:"clients-grid","aria-label":"Lista de clientes"},fe={class:"client-card__header"},ve={class:"client-card__id"},ge={class:"client-card__body"},be={key:0,class:"client-card__doc"},ye={class:"client-card__actions"},Ce=["onClick"],_e=["onClick"],he=["aria-hidden"],Ee={class:"modal-dialog",role:"document"},ke={class:"modal-content"},we={class:"modal-header"},xe={class:"modal-body"},Ue={class:"form-section"},je={class:"form-grid"},Ve={class:"form-group span-6"},Ne={class:"form-group span-3"},Pe={class:"form-group span-3"},Se={class:"form-group span-6"},De={class:"form-group span-3"},Be={class:"form-section"},ze={class:"form-grid"},Ae={class:"form-group span-3"},Fe={class:"cep-field"},Le=["onKeyup"],Me=["disabled"],$e={key:0},Te={key:1},Ie={key:0,class:"field-error"},Oe={class:"form-group span-6"},qe={class:"form-group span-3"},Ke={class:"form-group span-3"},Re={class:"form-group span-3"},Je={class:"form-group span-4"},Ze={class:"form-group span-2"},Ge={key:0,class:"form-error"},He={class:"modal-footer"},Qe=["disabled"],We={key:0},Xe={key:1},Ye={__name:"ClientesView",setup(eo){const f=p([]),w=p(!1),C=p(""),v=p(!1),b=p(null),y=p(!1),m=p(""),N=p(""),l=L({loading:!1,error:""}),P=Object.freeze({nome:"",cpfcnpj:"",telefone:"",email:"",active:!0,cep:"",endereco:"",numero:"",complemento:"",bairro:"",cidade:"",estado:""}),n=L({...P}),_=j({get:()=>N.value,set:t=>{N.value=(t||"").trimStart()}}),S=j(()=>{if(!_.value)return f.value;const t=_.value.toLowerCase();return f.value.filter(e=>{const s=String(e.nome||"").toLowerCase(),a=String(e.cpfcnpj||e.cpf||e.cnpj||"").toLowerCase(),G=String(e.cidade||e.city||"").toLowerCase(),H=h(e)?"ativo":"inativo";return s.includes(t)||a.includes(t)||G.includes(t)||H.includes(t)})}),D=j(()=>!!n.nome);function B(){Object.assign(n,P),b.value=null,m.value="",l.loading=!1,l.error=""}function I(){const t=g(n.cep);return{nome:n.nome,cpfcnpj:A(n.cpfcnpj),telefone:n.telefone,email:n.email,active:n.active!==!1,ativo:n.active!==!1,cep:t||void 0,endereco:n.endereco,logradouro:n.endereco,numero:n.numero,numeroEndereco:n.numero,complemento:n.complemento,bairro:n.bairro,cidade:n.cidade,estado:(n.estado||"").toUpperCase(),uf:(n.estado||"").toUpperCase()}}async function x(){w.value=!0,C.value="";try{const t=await ne();f.value=Array.isArray(t)?t:[]}catch(t){console.error("Erro ao carregar clientes",t),C.value=(t==null?void 0:t.message)||"Não foi possível carregar os clientes."}finally{w.value=!1}}function O(){B(),v.value=!0}function q(t){t&&(b.value=t.id,Object.assign(n,{nome:t.nome||"",cpfcnpj:A(t.cpfcnpj||t.cpf||t.cnpj||""),telefone:t.telefone||t.phone||"",email:t.email||"",active:h(t),cep:g(t.cep||t.CEP||""),endereco:t.endereco||t.logradouro||"",numero:t.numero||t.numeroEndereco||"",complemento:t.complemento||"",bairro:t.bairro||"",cidade:t.cidade||t.city||"",estado:(t.estado||t.uf||"").toUpperCase()}),v.value=!0)}function U(){y.value||(v.value=!1)}async function K(){if(!D.value){m.value="Preencha pelo menos o nome do cliente.";return}m.value="",y.value=!0;try{const t=I();b.value?await re(b.value,t):await le(t),await x(),v.value=!1,B()}catch(t){console.error("Erro ao salvar cliente",t),m.value=F(t)||(t==null?void 0:t.message)||"Não foi possível salvar o cliente."}finally{y.value=!1}}async function R(t){if(!(!(t!=null&&t.id)||!window.confirm(`Deseja realmente excluir o cliente ${t.nome||"#"+t.id}?`)))try{await ae(t.id),f.value=f.value.filter(s=>s.id!==t.id)}catch(s){console.error("Erro ao excluir cliente",s),m.value=F(s)||(s==null?void 0:s.message)||"Não foi possível excluir o cliente."}}async function z(){const t=g(n.cep);if(t.length!==8){l.error="Informe um CEP válido com 8 dígitos.";return}l.loading=!0,l.error="";try{const e=await fetch(`https://viacep.com.br/ws/${t}/json/`);if(!e.ok)throw new Error("Falha ao consultar o CEP.");const s=await e.json();if(s!=null&&s.erro){l.error="CEP não encontrado.";return}n.cep=g(s.cep)||t,n.endereco=s.logradouro||n.endereco,n.bairro=s.bairro||n.bairro,n.cidade=s.localidade||n.cidade,n.estado=(s.uf||n.estado||"").toUpperCase()}catch(e){console.error("Erro ao consultar CEP",e),l.error=(e==null?void 0:e.message)||"Não foi possível buscar o CEP."}finally{l.loading=!1}}function g(t){return String(t||"").replace(/\D/g,"").slice(0,8)}function A(t){return String(t||"").replace(/\D/g,"")}function J(t){const e=g(t);return e.length!==8?e||"-":`${e.slice(0,5)}-${e.slice(5)}`}function h(t){if(!t)return!0;const e=t.active,s=t.ativo;return typeof e=="boolean"?e!==!1:typeof s=="boolean"?s!==!1:e===0||s===0?!1:!(e==="false"||s==="false")}function Z(t){if(!t)return"-";const e=[t.endereco||t.logradouro,t.numero||t.numeroEndereco,t.bairro,t.cidade,t.estado||t.uf].filter(Boolean);return e.length?e.join(", "):"-"}function F(t){var s;if(!t)return"";const e=t.body||t.data||((s=t.response)==null?void 0:s.data);if(!e)return"";if(Array.isArray(e.errors)&&e.errors.length){const a=e.errors[0];if(typeof a=="string")return a;if(a!=null&&a.defaultMessage)return a.defaultMessage;if(a!=null&&a.message)return a.message;if(a!=null&&a.field&&(a!=null&&a.code))return`${a.field}: ${a.code}`}return typeof e.message=="string"&&e.message.trim()?e.message:typeof e.error=="string"&&e.error.trim()?e.error:""}return M(()=>n.cep,t=>{if(!t){l.error="";return}const e=g(t);e!==t&&(n.cep=e),l.error&&(l.error="")}),M(()=>n.estado,t=>{if(!t)return;const e=t.replace(/[^a-zA-Z]/g,"").toUpperCase().slice(0,2);e!==t&&(n.estado=e)}),W(x),(t,e)=>(r(),i("section",ie,[o("header",{class:"page-header"},[e[14]||(e[14]=o("div",{class:"page-title"},[o("h2",null,"Clientes"),o("p",null,"Cadastre, edite e acompanhe todos os clientes cadastrados na plataforma.")],-1)),o("button",{type:"button",class:"btn btn-primary",onClick:O},[...e[13]||(e[13]=[o("i",{class:"fa-solid fa-plus","aria-hidden":"true"},null,-1),o("span",null,"Novo Cliente",-1)])])]),C.value?(r(),$(te,{key:0,message:C.value,retry:x},null,8,["message"])):w.value?(r(),$(se,{key:1,message:"Carregando clientes…"})):(r(),i("div",de,[f.value.length?(r(),i("div",ue,[e[16]||(e[16]=o("label",{class:"sr-only",for:"clientes-busca"},"Buscar clientes",-1)),o("div",ce,[e[15]||(e[15]=o("i",{class:"fa-solid fa-search","aria-hidden":"true"},null,-1)),d(o("input",{id:"clientes-busca","onUpdate:modelValue":e[0]||(e[0]=s=>_.value=s),type:"search",placeholder:"Pesquisar por nome, documento ou cidade"},null,512),[[u,_.value]])])])):E("",!0),S.value.length?(r(),i("ul",me,[(r(!0),i(X,null,Y(S.value,s=>(r(),i("li",{key:s.id,class:"client-card"},[o("header",fe,[o("span",ve,"#"+c(s.id),1),o("span",{class:T(["client-card__badge",{"client-card__badge--inactive":!h(s)}])},c(h(s)?"Ativo":"Inativo"),3)]),o("div",ge,[o("h3",null,c(s.nome||"Cliente sem nome"),1),s.cpfcnpj?(r(),i("p",be,c(s.cpfcnpj),1)):E("",!0),o("dl",null,[o("div",null,[e[17]||(e[17]=o("dt",null,[o("i",{class:"fa-solid fa-phone","aria-hidden":"true"}),k("Telefone")],-1)),o("dd",null,c(s.telefone||s.phone||"Não informado"),1)]),o("div",null,[e[18]||(e[18]=o("dt",null,[o("i",{class:"fa-solid fa-envelope","aria-hidden":"true"}),k("E-mail")],-1)),o("dd",null,c(s.email||"Não informado"),1)]),o("div",null,[e[19]||(e[19]=o("dt",null,[o("i",{class:"fa-solid fa-location-dot","aria-hidden":"true"}),k("Endereço")],-1)),o("dd",null,c(Z(s)),1)]),o("div",null,[e[20]||(e[20]=o("dt",null,[o("i",{class:"fa-solid fa-map-pin","aria-hidden":"true"}),k("CEP")],-1)),o("dd",null,c(J(s.cep)),1)])])]),o("footer",ye,[o("button",{type:"button",class:"btn-card",onClick:a=>q(s)},[...e[21]||(e[21]=[o("i",{class:"fa-solid fa-pen","aria-hidden":"true"},null,-1),o("span",null,"Editar",-1)])],8,Ce),o("button",{type:"button",class:"btn-card btn-card--danger",onClick:a=>R(s)},[...e[22]||(e[22]=[o("i",{class:"fa-solid fa-trash","aria-hidden":"true"},null,-1),o("span",null,"Excluir",-1)])],8,_e)])]))),128))])):(r(),i("p",pe,"Nenhum cliente encontrado."))])),o("div",{class:T(["modal",{show:v.value}]),role:"dialog","aria-hidden":(!v.value).toString(),onClick:V(U,["self"])},[o("div",Ee,[o("div",ke,[o("header",we,[o("h3",null,c(b.value?"Editar Cliente":"Novo Cliente"),1),o("button",{type:"button",class:"btn-close",onClick:U,"aria-label":"Fechar modal"},[...e[23]||(e[23]=[o("i",{class:"fa-solid fa-times","aria-hidden":"true"},null,-1)])])]),o("form",{class:"modal-form",onSubmit:V(K,["prevent"])},[o("div",xe,[o("section",Ue,[e[30]||(e[30]=o("header",null,[o("h4",null,"Dados gerais")],-1)),o("div",je,[o("div",Ve,[e[24]||(e[24]=o("label",{for:"cliente-nome"},"Nome",-1)),d(o("input",{id:"cliente-nome","onUpdate:modelValue":e[1]||(e[1]=s=>n.nome=s),type:"text",required:""},null,512),[[u,n.nome,void 0,{trim:!0}]])]),o("div",Ne,[e[25]||(e[25]=o("label",{for:"cliente-documento"},"CPF/CNPJ",-1)),d(o("input",{id:"cliente-documento","onUpdate:modelValue":e[2]||(e[2]=s=>n.cpfcnpj=s),type:"text",placeholder:"Somente números"},null,512),[[u,n.cpfcnpj,void 0,{trim:!0}]])]),o("div",Pe,[e[26]||(e[26]=o("label",{for:"cliente-telefone"},"Telefone",-1)),d(o("input",{id:"cliente-telefone","onUpdate:modelValue":e[3]||(e[3]=s=>n.telefone=s),type:"tel"},null,512),[[u,n.telefone,void 0,{trim:!0}]])]),o("div",Se,[e[27]||(e[27]=o("label",{for:"cliente-email"},"E-mail",-1)),d(o("input",{id:"cliente-email","onUpdate:modelValue":e[4]||(e[4]=s=>n.email=s),type:"email"},null,512),[[u,n.email,void 0,{trim:!0}]])]),o("div",De,[e[29]||(e[29]=o("label",{for:"cliente-status"},"Status",-1)),d(o("select",{id:"cliente-status","onUpdate:modelValue":e[5]||(e[5]=s=>n.active=s)},[...e[28]||(e[28]=[o("option",{value:!0},"Ativo",-1),o("option",{value:!1},"Inativo",-1)])],512),[[ee,n.active]])])])]),o("section",Be,[e[38]||(e[38]=o("header",null,[o("h4",null,"Endereço"),o("p",null,"Preencha o endereço completo. Utilize a busca por CEP para agilizar.")],-1)),o("div",ze,[o("div",Ae,[e[31]||(e[31]=o("label",{for:"cliente-cep"},"CEP",-1)),o("div",Fe,[d(o("input",{id:"cliente-cep","onUpdate:modelValue":e[6]||(e[6]=s=>n.cep=s),type:"text",inputmode:"numeric",maxlength:"9",placeholder:"00000-000",onKeyup:oe(V(z,["prevent"]),["enter"])},null,40,Le),[[u,n.cep,void 0,{trim:!0}]]),o("button",{type:"button",class:"btn btn-lookup",disabled:l.loading,onClick:z},[l.loading?(r(),i("span",$e,"Buscando…")):(r(),i("span",Te,"Buscar"))],8,Me)]),l.error?(r(),i("small",Ie,c(l.error),1)):E("",!0)]),o("div",Oe,[e[32]||(e[32]=o("label",{for:"cliente-endereco"},"Logradouro",-1)),d(o("input",{id:"cliente-endereco","onUpdate:modelValue":e[7]||(e[7]=s=>n.endereco=s),type:"text"},null,512),[[u,n.endereco,void 0,{trim:!0}]])]),o("div",qe,[e[33]||(e[33]=o("label",{for:"cliente-numero"},"Número",-1)),d(o("input",{id:"cliente-numero","onUpdate:modelValue":e[8]||(e[8]=s=>n.numero=s),type:"text"},null,512),[[u,n.numero,void 0,{trim:!0}]])]),o("div",Ke,[e[34]||(e[34]=o("label",{for:"cliente-complemento"},"Complemento",-1)),d(o("input",{id:"cliente-complemento","onUpdate:modelValue":e[9]||(e[9]=s=>n.complemento=s),type:"text"},null,512),[[u,n.complemento,void 0,{trim:!0}]])]),o("div",Re,[e[35]||(e[35]=o("label",{for:"cliente-bairro"},"Bairro",-1)),d(o("input",{id:"cliente-bairro","onUpdate:modelValue":e[10]||(e[10]=s=>n.bairro=s),type:"text"},null,512),[[u,n.bairro,void 0,{trim:!0}]])]),o("div",Je,[e[36]||(e[36]=o("label",{for:"cliente-cidade"},"Cidade",-1)),d(o("input",{id:"cliente-cidade","onUpdate:modelValue":e[11]||(e[11]=s=>n.cidade=s),type:"text"},null,512),[[u,n.cidade,void 0,{trim:!0}]])]),o("div",Ze,[e[37]||(e[37]=o("label",{for:"cliente-estado"},"UF",-1)),d(o("input",{id:"cliente-estado","onUpdate:modelValue":e[12]||(e[12]=s=>n.estado=s),type:"text",maxlength:"2"},null,512),[[u,n.estado,void 0,{trim:!0}]])])])]),m.value?(r(),i("p",Ge,c(m.value),1)):E("",!0)]),o("footer",He,[o("button",{type:"button",class:"btn btn-outline",onClick:U},"Cancelar"),o("button",{type:"submit",class:"btn btn-primary",disabled:y.value||!D.value},[y.value?(r(),i("span",We,"Salvando…")):(r(),i("span",Xe,"Salvar"))],8,Qe)])],32)])])],10,he)]))}},ao=Q(Ye,[["__scopeId","data-v-07daed6f"]]);export{ao as default};
