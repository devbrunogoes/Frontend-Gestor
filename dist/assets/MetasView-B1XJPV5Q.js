import{y as k,r as u,z as L,o as I,a as v,b as s,f as o,B as E,F as P,g as $,t as n,w as S,e as B,m as r,v as w,C as N,R as h,n as G}from"./index-IzLOKglm.js";import{B as q,a as O}from"./BaseError-DNv4Myx8.js";/* empty css                                                                  */async function z(){return await k("/goals")}async function J(d){return await k("/goals",{method:"POST",body:JSON.stringify(d)})}async function Q(d,f){return await k(`/goals/${d}`,{method:"PUT",body:JSON.stringify(f)})}async function j(d){return await k(`/goals/${d}`,{method:"DELETE"}),!0}const H={class:"content-area"},K={key:2,class:"table-wrap"},W={class:"data-table"},X=["onClick"],Y=["onClick"],Z={class:"modal-dialog"},_={class:"modal-content"},oo={class:"modal-header"},eo={class:"modal-body"},to={class:"form-grid"},lo={class:"form-group form-group-large"},ao={class:"form-group"},no={class:"form-group"},io={class:"form-group"},so={class:"form-group"},ro={class:"form-group"},uo=["type"],mo={class:"form-group form-group-large"},vo={class:"form-group"},po={key:0,style:{color:"#dc3545"}},fo={key:1,style:{color:"#198754"}},go={__name:"MetasView",setup(d){const f=u([]),M=u(!1),c=u(""),y=u(!1),p=u(null),t=L({nome:"",periodo:"mensal",inicio:"",fim:"",tipo:"faturamento",alvo:0,responsavel:"",active:!0}),i=u(""),m=u("");function V(a){return(Number(a)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function U(a){return{semanal:"Semanal",mensal:"Mensal",trimestral:"Trimestral",anual:"Anual"}[a]||a}function F(a){return{faturamento:"Faturamento",quantidade:"Quantidade"}[a]||a}function C(){t.nome="",t.periodo="mensal",t.inicio="",t.fim="",t.tipo="faturamento",t.alvo=0,t.responsavel="",t.active=!0,p.value=null,i.value="",m.value=""}function T(){C(),y.value=!0}function x(a){p.value=a.id,t.nome=a.nome||"",t.periodo=a.periodo||"mensal",t.inicio=a.inicio||"",t.fim=a.fim||"",t.tipo=a.tipo||"faturamento",t.alvo=Number(a.alvo||0),t.responsavel=a.responsavel||"",t.active=a.active!==!1,i.value="",m.value="",y.value=!0}function b(){y.value=!1}async function g(){M.value=!0,c.value="";try{f.value=await z()}catch(a){c.value=(a==null?void 0:a.message)||"Erro ao carregar metas"}finally{M.value=!1}}async function A(){if(i.value="",m.value="",!t.nome){i.value="Nome é obrigatório.";return}if(t.inicio&&t.fim&&t.inicio>t.fim){i.value="Início não pode ser após o fim.";return}const a={nome:t.nome,periodo:t.periodo,inicio:t.inicio||null,fim:t.fim||null,tipo:t.tipo,alvo:Number(t.alvo||0),responsavel:t.responsavel,active:!!t.active};try{p.value?await Q(p.value,a):await J(a),m.value="Meta salva.",b(),C(),await g()}catch(e){i.value=(e==null?void 0:e.message)||"Erro ao salvar"}}async function R(a){if(confirm("Confirma excluir a meta #"+a.id+"?"))try{await j(a.id),await g()}catch(e){i.value=(e==null?void 0:e.message)||"Erro ao excluir"}}return I(async()=>{await g()}),(a,e)=>(s(),v("section",H,[o("div",{class:"page-header",style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"1rem"}},[e[8]||(e[8]=o("h2",{style:{margin:"0"}},"Metas",-1)),o("div",{class:"page-actions",style:{display:"flex",gap:".5rem"}},[o("button",{class:"btn btn-primary",onClick:T},"Nova Meta")])]),c.value?(s(),E(q,{key:0,message:c.value,retry:g},null,8,["message"])):M.value?(s(),E(O,{key:1,message:"Carregando metas…"})):(s(),v("div",K,[o("table",W,[e[11]||(e[11]=o("thead",null,[o("tr",null,[o("th",null,"ID"),o("th",null,"Nome"),o("th",null,"Período"),o("th",null,"Início"),o("th",null,"Fim"),o("th",null,"Tipo"),o("th",null,"Alvo"),o("th",null,"Responsável"),o("th",null,"Ativo"),o("th",null,"Ações")])],-1)),o("tbody",null,[(s(!0),v(P,null,$(f.value,l=>(s(),v("tr",{key:l.id},[o("td",null,n(l.id),1),o("td",null,n(l.nome),1),o("td",null,n(U(l.periodo)),1),o("td",null,n(l.inicio||"-"),1),o("td",null,n(l.fim||"-"),1),o("td",null,n(F(l.tipo)),1),o("td",null,n(l.tipo==="faturamento"?V(l.alvo):Number(l.alvo||0)),1),o("td",null,n(l.responsavel||"-"),1),o("td",null,n(l.active!==!1?"Sim":"Não"),1),o("td",null,[o("button",{class:"btn-icon btn-warning",onClick:D=>x(l),title:"Editar"},[...e[9]||(e[9]=[o("i",{class:"fa-solid fa-pen"},null,-1)])],8,X),o("button",{class:"btn-icon btn-danger",onClick:D=>R(l),title:"Excluir"},[...e[10]||(e[10]=[o("i",{class:"fa-solid fa-trash"},null,-1)])],8,Y)])]))),128))])])])),o("div",{class:G(["modal",{show:y.value}]),role:"dialog","aria-hidden":"true",onClick:S(b,["self"])},[o("div",Z,[o("div",_,[o("div",oo,[o("h3",null,n(p.value?"Editar Meta":"Nova Meta"),1),o("button",{type:"button",class:"btn-close",onClick:b,"aria-label":"Fechar"},[...e[12]||(e[12]=[o("i",{class:"fa-solid fa-times"},null,-1)])])]),o("form",{onSubmit:S(A,["prevent"])},[o("div",eo,[o("div",to,[o("div",lo,[e[13]||(e[13]=o("label",{for:"nome"},"Nome",-1)),r(o("input",{id:"nome",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=l=>t.nome=l),required:""},null,512),[[w,t.nome,void 0,{trim:!0}]])]),o("div",ao,[e[15]||(e[15]=o("label",{for:"periodo"},"Período",-1)),r(o("select",{id:"periodo",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=l=>t.periodo=l)},[...e[14]||(e[14]=[o("option",{value:"semanal"},"Semanal",-1),o("option",{value:"mensal"},"Mensal",-1),o("option",{value:"trimestral"},"Trimestral",-1),o("option",{value:"anual"},"Anual",-1)])],512),[[N,t.periodo]])]),o("div",no,[e[16]||(e[16]=o("label",{for:"inicio"},"Início",-1)),r(o("input",{id:"inicio",type:"date",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=l=>t.inicio=l)},null,512),[[w,t.inicio]])]),o("div",io,[e[17]||(e[17]=o("label",{for:"fim"},"Fim",-1)),r(o("input",{id:"fim",type:"date",class:"form-control","onUpdate:modelValue":e[3]||(e[3]=l=>t.fim=l)},null,512),[[w,t.fim]])]),o("div",so,[e[19]||(e[19]=o("label",{for:"tipo"},"Tipo",-1)),r(o("select",{id:"tipo",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=l=>t.tipo=l)},[...e[18]||(e[18]=[o("option",{value:"faturamento"},"Faturamento (R$)",-1),o("option",{value:"quantidade"},"Quantidade (itens)",-1)])],512),[[N,t.tipo]])]),o("div",ro,[e[20]||(e[20]=o("label",{for:"alvo"},"Alvo",-1)),r(o("input",{id:"alvo",type:(t.tipo==="faturamento","number"),step:"0.01",min:"0",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=l=>t.alvo=l)},null,8,uo),[[h,t.alvo,void 0,{number:!0}]])]),o("div",mo,[e[21]||(e[21]=o("label",{for:"resp"},"Responsável",-1)),r(o("input",{id:"resp",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=l=>t.responsavel=l),placeholder:"Usuário ou papel"},null,512),[[w,t.responsavel,void 0,{trim:!0}]])]),o("div",vo,[e[23]||(e[23]=o("label",{for:"ativo"},"Ativo",-1)),r(o("select",{id:"ativo",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=l=>t.active=l)},[...e[22]||(e[22]=[o("option",{value:!0},"Sim",-1),o("option",{value:!1},"Não",-1)])],512),[[N,t.active]])])]),i.value?(s(),v("div",po,n(i.value),1)):B("",!0),m.value?(s(),v("div",fo,n(m.value),1)):B("",!0)]),o("div",{class:"modal-footer"},[o("button",{type:"button",class:"btn btn-secondary",onClick:b},"Cancelar"),e[24]||(e[24]=o("button",{type:"submit",class:"btn btn-success"},"Salvar",-1))])],32)])])],2)]))}};export{go as default};
