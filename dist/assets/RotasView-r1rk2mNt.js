import{_ as J,r as n,z as O,c as U,o as Q,D as W,a as l,b as o,f as a,B as N,e as p,m as _,v as E,F as M,g as D,t as i,w as F,C as X,n as Y,i as Z,E as ee,h as $,p as ae}from"./index-IzLOKglm.js";import{l as se,u as te,c as oe}from"./routes-Bv5CBije.js";import{l as le}from"./clients-DV1jXavO.js";import{B as I,a as K}from"./BaseError-DNv4Myx8.js";/* empty css                                                                  */const ne={class:"content-area"},re={key:2,class:"routes-container"},ie={key:0,class:"routes-toolbar"},ue={class:"search-box"},de={key:1,class:"empty-routes"},ce={key:2,class:"routes-list","aria-label":"Lista de rotas"},ve=["onClick","onKeyup"],me={class:"route-name"},pe={key:0},fe={class:"modal-dialog"},ye={class:"modal-content"},ge={class:"modal-header"},be={class:"modal-body"},he={class:"form-grid"},_e={class:"form-group form-group-large"},ke={class:"form-group"},Ce={class:"clients-section"},we={key:0,class:"clients-toolbar"},Se={class:"search-box"},Ne={key:3,class:"empty-clients"},Le={key:4,class:"empty-clients"},xe={key:5,class:"clients-list"},Re=["value"],Be={key:0},Ve={key:0,class:"modal-error"},Ee={class:"modal-footer"},Me=["disabled"],ze={__name:"RotasView",setup(qe){const P=Z(),f=n([]),L=n(!1),k=n(""),x=n(!1),y=n(null),r=O({nome:"",ativa:!0}),c=n(""),T=n(""),u=n([]),g=n(!1),b=n(""),C=n([]),w=n(!1),h=n(""),v=n(""),z=U(()=>{if(!h.value)return u.value;const t=h.value.toLowerCase();return u.value.filter(e=>{const s=String(e.nome||e.name||"").toLowerCase(),d=String(e.razaoSocial||"").toLowerCase(),V=String(e.cnpj||e.cpf||"").toLowerCase();return s.includes(t)||d.includes(t)||V.includes(t)})});function q(){r.nome="",r.ativa=!0,y.value=null,c.value="",C.value=[],h.value=""}async function R(){if(!(u.value.length||g.value)){g.value=!0,b.value="";try{const t=await le();u.value=Array.isArray(t)?t:[]}catch(t){b.value=(t==null?void 0:t.message)||"Erro ao carregar clientes"}finally{g.value=!1}}}async function G(){q(),x.value=!0,await R()}function S(){x.value=!1}function j(t){t!=null&&t.id&&P.push({name:"rota-detalhe",params:{id:t.id}})}async function B(){L.value=!0,k.value="";try{f.value=await se()}catch(t){k.value=(t==null?void 0:t.message)||"Erro ao carregar rotas"}finally{L.value=!1}}const A=U(()=>{if(!v.value)return f.value;const t=v.value.toLowerCase();return f.value.filter(e=>{const s=String(e.nome||e.name||"").toLowerCase(),d=String(e.motorista||"").toLowerCase(),V=Array.isArray(e.clientes)?e.clientes.map(m=>(m==null?void 0:m.nome)||(m==null?void 0:m.name)||"").join(" ").toLowerCase():"";return s.includes(t)||d.includes(t)||V.includes(t)})});async function H(){if(c.value="",T.value="",!r.nome){c.value="Nome é obrigatório.";return}const t={name:r.nome,modelo:!!r.ativa,pontos:C.value.map(e=>{const s=Number(e);return Number.isNaN(s)?e:s})};try{w.value=!0;const e=y.value?await te(y.value,t):await oe(t);!y.value&&(e!=null&&e.id)?f.value.push(e):await B(),S(),q()}catch(e){c.value=(e==null?void 0:e.message)||"Erro ao salvar"}finally{w.value=!1}}return Q(async()=>{await Promise.all([B(),R()])}),W(v,t=>{v.value=t.trimStart()}),(t,e)=>(o(),l("section",ne,[a("div",{class:"page-header",style:{display:"flex","align-items":"center","justify-content":"space-between",gap:"1rem"}},[e[5]||(e[5]=a("h2",{style:{margin:"0"}},"Rotas",-1)),a("div",{class:"page-actions",style:{display:"flex",gap:".5rem"}},[a("button",{class:"btn btn-primary",onClick:G},"Nova Rota")])]),k.value?(o(),N(I,{key:0,message:k.value,retry:B},null,8,["message"])):L.value?(o(),N(K,{key:1,message:"Carregando rotas…"})):(o(),l("div",re,[f.value.length?(o(),l("div",ie,[e[7]||(e[7]=a("label",{class:"sr-only",for:"buscar-rota"},"Buscar rota",-1)),a("div",ue,[e[6]||(e[6]=a("i",{class:"fa-solid fa-search"},null,-1)),_(a("input",{id:"buscar-rota","onUpdate:modelValue":e[0]||(e[0]=s=>v.value=s),type:"search",placeholder:"Pesquisar rota pelo nome ou motorista"},null,512),[[E,v.value,void 0,{trim:!0}]])])])):p("",!0),A.value.length?(o(),l("ul",ce,[(o(!0),l(M,null,D(A.value,s=>(o(),l("li",{key:s.id,class:"route-card",role:"button",tabindex:"0",onClick:d=>j(s),onKeyup:ee(d=>j(s),["enter","space"])},[a("div",me,[a("span",null,i(s.nome||s.name||`Rota ${s.id}`),1),s.motorista||s.veiculo?(o(),l("small",pe,[$(i(s.motorista||"Motorista indefinido")+" ",1),s.veiculo?(o(),l(M,{key:0},[$(" · "+i(s.veiculo),1)],64)):p("",!0)])):p("",!0)]),e[8]||(e[8]=a("i",{class:"fa-solid fa-chevron-right route-chevron","aria-hidden":"true"},null,-1))],40,ve))),128))])):(o(),l("div",de," Nenhuma rota encontrada. "))])),a("div",{class:Y(["modal",{show:x.value}]),role:"dialog","aria-hidden":"true",onClick:F(S,["self"])},[a("div",fe,[a("div",ye,[a("div",ge,[a("h3",null,i(y.value?"Editar Rota":"Nova Rota"),1),a("button",{type:"button",class:"btn-close",onClick:S,"aria-label":"Fechar"},[...e[9]||(e[9]=[a("i",{class:"fa-solid fa-times"},null,-1)])])]),a("form",{onSubmit:F(H,["prevent"])},[a("div",be,[a("div",he,[a("div",_e,[e[10]||(e[10]=a("label",{for:"nome"},"Nome da rota",-1)),_(a("input",{id:"nome",class:"form-control","onUpdate:modelValue":e[1]||(e[1]=s=>r.nome=s),required:""},null,512),[[E,r.nome,void 0,{trim:!0}]])]),a("div",ke,[e[12]||(e[12]=a("label",{for:"ativa"},"Status",-1)),_(a("select",{id:"ativa",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=s=>r.ativa=s)},[...e[11]||(e[11]=[a("option",{value:!0},"Ativa",-1),a("option",{value:!1},"Inativa",-1)])],512),[[X,r.ativa]])])]),a("section",Ce,[e[15]||(e[15]=a("header",null,[a("h4",null,"Clientes da rota"),a("p",null,"Selecione os clientes que farão parte dessa rota.")],-1)),!g.value&&!b.value&&u.value.length?(o(),l("div",we,[e[14]||(e[14]=a("label",{class:"sr-only",for:"buscar-cliente"},"Buscar cliente",-1)),a("div",Se,[e[13]||(e[13]=a("i",{class:"fa-solid fa-search"},null,-1)),_(a("input",{id:"buscar-cliente","onUpdate:modelValue":e[3]||(e[3]=s=>h.value=s),type:"search",placeholder:"Pesquisar cliente por nome, razão social ou documento"},null,512),[[E,h.value,void 0,{trim:!0}]])])])):p("",!0),g.value?(o(),N(K,{key:1,message:"Carregando clientes…"})):b.value?(o(),N(I,{key:2,message:b.value,retry:R},null,8,["message"])):u.value.length?u.value.length&&!z.value.length?(o(),l("div",Le,"Nenhum cliente encontrado para a busca.")):(o(),l("ul",xe,[(o(!0),l(M,null,D(z.value,s=>(o(),l("li",{key:s.id,class:"client-option"},[a("label",null,[_(a("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=d=>C.value=d),value:String(s.id)},null,8,Re),[[ae,C.value]]),a("span",null,[a("strong",null,i(s.nome||s.name||`Cliente ${s.id}`),1),s.razaoSocial||s.cnpj?(o(),l("small",Be,i(s.razaoSocial||s.cnpj),1)):p("",!0)])])]))),128))])):(o(),l("div",Ne,"Nenhum cliente cadastrado."))]),c.value?(o(),l("div",Ve,i(c.value),1)):p("",!0)]),a("div",Ee,[a("button",{type:"button",class:"btn btn-outline",onClick:S},"Cancelar"),a("button",{type:"submit",class:"btn btn-primary",disabled:w.value},i(w.value?"Salvando…":"Salvar rota"),9,Me)])],32)])])],2)]))}},$e=J(ze,[["__scopeId","data-v-2592b0d9"]]);export{$e as default};
