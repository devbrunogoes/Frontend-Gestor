import{r as g,c as C,o as z,a as r,b as i,d as M,e as _,u as st,F as P,_ as at,x as Q,y as nt,f as e,z as J,t as l,n as p,j as F,v as I,g as ot,E as it,p as lt,w as rt,D as j,T as ut}from"./index-CXM7zIvA.js";import{B as ct,a as dt}from"./BaseError-DaDu2INT.js";import{C as vt,A as mt,p as pt,b as ft,P as yt}from"./index-BIhj-tPT.js";import{_ as gt}from"./TopProducts-D5u78SxK.js";import{l as bt,c as kt}from"./products-DXxYyzcf.js";/* empty css                                                                  */const _t={key:0,style:{opacity:".7","margin-top":".25rem"}},ht={__name:"PriceBuckets",setup(O){vt.register(mt,pt,ft);function b(u,o="[]"){try{return JSON.parse(localStorage.getItem(u)||o)}catch{return JSON.parse(o)}}const h=g(["Até 10","10-50","50-100","100+"]),k=g([0,0,0,0]),N=["#0d6efd","#20c997","#ffc107","#dc3545"],d=C(()=>({labels:h.value,datasets:[{data:k.value,backgroundColor:N}]})),A={plugins:{legend:{position:"bottom"}}},n=C(()=>(k.value||[]).some(u=>Number(u)>0));function S(){const u=b("produtos");if(Array.isArray(u)&&u.length)return u.map(v=>({preco:Number(v.preco)||Number(v.precoVenda)||0}));const o=b("estoque");return Array.isArray(o)&&o.length?o.map(v=>({preco:Number(v.preco)||Number(v.precoVenda)||0})):[]}function f(){const u=S(),o={"Até 10":0,"10-50":0,"50-100":0,"100+":0};u.forEach(v=>{const q=Number(v.preco)||0;q<=10?o["Até 10"]+=1:q<=50?o["10-50"]+=1:q<=100?o["50-100"]+=1:o["100+"]+=1}),h.value=Object.keys(o),k.value=h.value.map(v=>o[v])}return z(f),(u,o)=>(i(),r(P,null,[M(st(yt),{data:d.value,options:A},null,8,["data"]),n.value?_("",!0):(i(),r("div",_t,"Sem dados de preços."))],64))}},At={class:"content-area inventory-view"},St={class:"page-header inventory-header"},Ct={class:"header-top"},Nt={class:"header-stats"},qt={class:"stat-card"},Et={class:"value"},wt={class:"stat-card"},Tt={class:"stat-card"},Mt={class:"value"},xt={class:"stat-card"},Dt={class:"value"},$t={class:"inventory-controls"},Bt={class:"search-wrapper"},Ft={class:"filters"},It={key:0,class:"feedback-banner success"},Pt={key:0,class:"empty-state"},Lt={key:1,class:"inventory-grid"},Rt={class:"card-top"},Vt={class:"card-title"},Ut={class:"code-chip"},Qt={class:"meta-row"},Jt={key:0,class:"meta-pill"},jt={key:1,class:"meta-pill light"},zt={key:0,class:"card-description"},Ot={class:"stock-overview"},Ht={class:"stock-figure"},Gt={class:"stock-progress"},Kt={class:"stock-min"},Wt={class:"progress-track"},Xt={class:"inventory-meta"},Yt={class:"card-actions"},Zt=["onClick"],te={key:0,class:"movement-panel"},ee={class:"movement-type"},se=["onSubmit"],ae=["min"],ne={class:"movement-actions"},oe=["disabled"],ie={key:0},le={key:1},re={key:0,class:"movement-alert error"},ue={key:2,class:"inventory-analytics"},ce={class:"charts-grid"},de={class:"chart-card"},ve={class:"chart-card"},me={__name:"EstoqueView",setup(O){const b=g([]),h=g(!1),k=g(""),N=g(""),d=g("all"),A=g(null),n=Q({type:"ENTRADA",quantity:null,note:""}),S=g(!1),f=Q({error:""}),u=g("");let o=null;const v=C(()=>b.value.length),q=C(()=>b.value.filter(s=>s.active!==!1).length),L=C(()=>b.value.filter(w).length),H=C(()=>b.value.reduce((s,t)=>s+y(t.stockQuantity),0)),x=C(()=>{const s=N.value.trim().toLowerCase();return b.value.filter(G).filter(a=>{var E,m;return s?[a.name,a.code,(E=a.category)==null?void 0:E.name,(m=a.supplier)==null?void 0:m.name].filter(Boolean).join(" ").toLowerCase().includes(s):!0}).slice().sort((a,c)=>R(a)-R(c))});function y(s){const t=Number(s??0);return Number.isFinite(t)?t:0}function R(s){return y(s.stockQuantity)-y(s.minStock)}function w(s){const t=y(s.minStock);return t<=0?!1:y(s.stockQuantity)<=t}function G(s){switch(d.value){case"active":return s.active!==!1;case"inactive":return s.active===!1;case"critical":return w(s);default:return!0}}function V(s){const t=y(s.stockQuantity),a=Math.max(0,y(s.minStock));if(a===0)return Math.min(100,t>0?100:0);const c=t/a*100;return Math.max(0,Math.min(120,c))}function K(s){return s.active===!1?"inactive":w(s)?"danger":V(s)<130?"warning":"ok"}function W(s){return{"is-inactive":s.active===!1,"is-critical":w(s)}}function X(s){const t=y(s.minStock);if(t<=0)return"—";const a=y(s.stockQuantity),c=t===0?1/0:a/t;return Number.isFinite(c)?c>=3?"Confortável":c>=1?"Adequada":"Crítica":"—"}function D(s){return y(s).toLocaleString("pt-BR",{minimumFractionDigits:0,maximumFractionDigits:2})}function U(s){return Number(s??0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function Y(){n.type="ENTRADA",n.quantity=null,n.note="",f.error=""}function Z(s){if(A.value===s.id){T();return}A.value=s.id,Y()}function T(){A.value=null,S.value=!1,f.error=""}function $(s){n.type=s,s!=="AJUSTE"&&n.quantity<0&&(n.quantity=Math.abs(n.quantity))}async function tt(s){var a;f.error="";const t=Number(n.quantity);if(!Number.isFinite(t)||t===0){f.error="Informe uma quantidade diferente de zero.";return}if(n.type!=="AJUSTE"&&t<=0){f.error="Para entradas e saídas use valores positivos.";return}S.value=!0;try{await kt(s.id,{type:n.type,quantity:t,note:((a=n.note)==null?void 0:a.trim())||void 0}),et(n.type),await B(),T()}catch(c){f.error=(c==null?void 0:c.message)||"Erro ao registrar movimentação."}finally{S.value=!1}}function et(s){const t={ENTRADA:"Entrada registrada e estoque atualizado.",SAIDA:"Saída registrada com sucesso.",AJUSTE:"Ajuste de estoque aplicado."};u.value=t[s]||"Movimentação registrada.",o&&clearTimeout(o),o=setTimeout(()=>{u.value=""},4e3)}async function B(){h.value=!0,k.value="";try{const s=await bt();b.value=Array.isArray(s)?s:[]}catch(s){k.value=(s==null?void 0:s.message)||"Não foi possível carregar os produtos."}finally{h.value=!1}}return z(()=>{B()}),nt(()=>{o&&(clearTimeout(o),o=null)}),(s,t)=>(i(),r("section",At,[e("header",St,[e("div",Ct,[t[14]||(t[14]=e("div",{class:"header-copy"},[e("h2",null,"Estoque"),e("p",null,"Mantenha o inventário saudável e reponha rapidamente os itens críticos.")],-1)),e("div",Nt,[e("div",qt,[t[10]||(t[10]=e("span",{class:"label"},"Produtos monitorados",-1)),e("strong",Et,l(v.value),1)]),e("div",wt,[t[11]||(t[11]=e("span",{class:"label"},"Itens críticos",-1)),e("strong",{class:p(["value",{highlight:L.value>0}])},l(L.value),3)]),e("div",Tt,[t[12]||(t[12]=e("span",{class:"label"},"Itens ativos",-1)),e("strong",Mt,l(q.value),1)]),e("div",xt,[t[13]||(t[13]=e("span",{class:"label"},"Estoque total",-1)),e("strong",Dt,l(D(H.value)),1)])])]),e("div",$t,[e("div",Bt,[t[15]||(t[15]=e("i",{class:"fa-solid fa-magnifying-glass"},null,-1)),F(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>N.value=a),type:"search",placeholder:"Buscar por nome, código ou categoria"},null,512),[[I,N.value,void 0,{trim:!0}]])]),e("div",Ft,[e("button",{type:"button",class:p(["filter-pill",d.value==="all"?"is-active":""]),onClick:t[1]||(t[1]=a=>d.value="all")}," Todos ",2),e("button",{type:"button",class:p(["filter-pill",d.value==="active"?"is-active":""]),onClick:t[2]||(t[2]=a=>d.value="active")}," Ativos ",2),e("button",{type:"button",class:p(["filter-pill",d.value==="critical"?"is-active":""]),onClick:t[3]||(t[3]=a=>d.value="critical")}," Críticos ",2),e("button",{type:"button",class:p(["filter-pill",d.value==="inactive"?"is-active":""]),onClick:t[4]||(t[4]=a=>d.value="inactive")}," Inativos ",2)])])]),u.value?(i(),r("div",It,[t[16]||(t[16]=e("i",{class:"fa-solid fa-circle-check"},null,-1)),e("span",null,l(u.value),1)])):_("",!0),k.value?(i(),J(ct,{key:1,message:k.value,retry:B},null,8,["message"])):h.value?(i(),J(dt,{key:2,message:"Carregando estoque…"})):(i(),r(P,{key:3},[x.value.length?(i(),r("div",Lt,[(i(!0),r(P,null,ot(x.value,a=>{var c,E;return i(),r("article",{key:a.id,class:p(["inventory-card",[{"is-expanded":A.value===a.id},W(a)]])},[e("div",Rt,[e("div",Vt,[e("h3",null,l(a.name||"Produto sem nome"),1),e("span",Ut,l(a.code||`#${a.id}`),1)]),e("span",{class:p(["status-pill",a.active!==!1?"status-active":"status-inactive"])},l(a.active!==!1?"Ativo":"Inativo"),3)]),e("div",Qt,[(c=a.category)!=null&&c.name?(i(),r("span",Jt,l(a.category.name),1)):_("",!0),(E=a.supplier)!=null&&E.name?(i(),r("span",jt,l(a.supplier.name),1)):_("",!0)]),a.description?(i(),r("p",zt,l(a.description),1)):_("",!0),e("div",Ot,[e("div",Ht,[e("strong",null,l(D(a.stockQuantity)),1),t[18]||(t[18]=e("span",null,"em estoque",-1))]),e("div",Gt,[e("span",Kt,"Mínimo "+l(D(a.minStock)),1),e("div",Wt,[e("div",{class:p(["progress-bar",K(a)]),style:it({width:`${V(a)}%`})},null,6)])])]),e("div",Xt,[e("div",null,[t[19]||(t[19]=e("span",{class:"label"},"Preço",-1)),e("strong",null,l(U(a.price)),1)]),e("div",null,[t[20]||(t[20]=e("span",{class:"label"},"Custo",-1)),e("strong",null,l(U(a.cost)),1)]),e("div",null,[t[21]||(t[21]=e("span",{class:"label"},"Cobertura",-1)),e("strong",null,l(X(a)),1)])]),e("div",Yt,[e("button",{class:"btn btn-primary",type:"button",onClick:m=>Z(a)},[...t[22]||(t[22]=[e("i",{class:"fa-solid fa-boxes-packing"},null,-1),e("span",null,"Movimentar estoque",-1)])],8,Zt)]),M(ut,{name:"fade-slide"},{default:lt(()=>[A.value===a.id?(i(),r("div",te,[e("div",{class:"movement-header"},[t[24]||(t[24]=e("h4",null,"Registrar movimentação",-1)),e("button",{type:"button",class:"btn-close",onClick:T,"aria-label":"Fechar"},[...t[23]||(t[23]=[e("i",{class:"fa-solid fa-xmark"},null,-1)])])]),e("div",ee,[e("button",{type:"button",class:p(["movement-toggle",n.type==="ENTRADA"?"active":""]),onClick:t[5]||(t[5]=m=>$("ENTRADA"))},[...t[25]||(t[25]=[e("i",{class:"fa-solid fa-circle-arrow-up"},null,-1),e("span",null,"Entrada",-1)])],2),e("button",{type:"button",class:p(["movement-toggle",n.type==="SAIDA"?"active":""]),onClick:t[6]||(t[6]=m=>$("SAIDA"))},[...t[26]||(t[26]=[e("i",{class:"fa-solid fa-circle-arrow-down"},null,-1),e("span",null,"Saída",-1)])],2),e("button",{type:"button",class:p(["movement-toggle",n.type==="AJUSTE"?"active":""]),onClick:t[7]||(t[7]=m=>$("AJUSTE"))},[...t[27]||(t[27]=[e("i",{class:"fa-solid fa-scale-balanced"},null,-1),e("span",null,"Ajuste",-1)])],2)]),e("form",{class:"movement-form",onSubmit:rt(m=>tt(a),["prevent"])},[e("label",null,[t[28]||(t[28]=j(" Quantidade ",-1)),F(e("input",{type:"number",min:n.type==="AJUSTE"?void 0:0,step:"0.01","onUpdate:modelValue":t[8]||(t[8]=m=>n.quantity=m),placeholder:"0,00"},null,8,ae),[[I,n.quantity,void 0,{number:!0}]])]),e("label",null,[t[29]||(t[29]=j(" Observação (opcional) ",-1)),F(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=m=>n.note=m),placeholder:"Motivo ou referência interna"},null,512),[[I,n.note,void 0,{trim:!0}]])]),e("div",ne,[e("button",{type:"button",class:"btn btn-secondary",onClick:T},"Cancelar"),e("button",{type:"submit",class:"btn btn-success",disabled:S.value},[S.value?(i(),r("span",ie,"Registrando…")):(i(),r("span",le,"Confirmar"))],8,oe)])],40,se),t[30]||(t[30]=e("p",{class:"movement-hint"}," Entradas e saídas usam valores positivos. Ajustes aceitam números negativos para reduzir o estoque. ",-1)),f.error?(i(),r("div",re,l(f.error),1)):_("",!0)])):_("",!0)]),_:2},1024)],2)}),128))])):(i(),r("div",Pt,[...t[17]||(t[17]=[e("i",{class:"fa-solid fa-box-open"},null,-1),e("h3",null,"Nenhum produto encontrado",-1),e("p",null,"Cadastre novos itens ou ajuste os filtros para visualizar o estoque.",-1)])])),x.value.length?(i(),r("section",ue,[t[33]||(t[33]=e("h3",null,"Insights de estoque",-1)),e("div",ce,[e("div",de,[t[31]||(t[31]=e("h4",null,"Distribuição de preços",-1)),M(ht)]),e("div",ve,[t[32]||(t[32]=e("h4",null,"Top 10 por preço",-1)),M(gt,{topN:10})])])])):_("",!0)],64))]))}},_e=at(me,[["__scopeId","data-v-2ae7d349"]]);export{_e as default};
