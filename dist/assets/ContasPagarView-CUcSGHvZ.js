import{_ as Ba,r as c,x as ea,c as d,o as Va,B as oa,a as u,b as r,f as s,z as la,t as l,n as v,F as N,g as x,j as b,v as h,A as na,D as K,e as F,w as ra}from"./index-CXM7zIvA.js";import{B as $a,a as Ia}from"./BaseError-DaDu2INT.js";import{l as Pa,u as ia,d as Oa,c as Fa}from"./expenses-DPTG9Cfu.js";/* empty css                                                                  */const La={class:"content-area payable-view"},Ma={class:"page-header payable-header"},Ra={class:"header-copy"},Aa={class:"header-summary"},Ua={class:"summary-card neutral"},za={class:"summary-value"},Ta={class:"summary-note"},ja={class:"summary-value"},qa={class:"summary-note"},Ha={class:"summary-value"},Ya={class:"summary-note"},Ga={class:"summary-card positive"},Ja={class:"summary-value"},Ka={class:"summary-note"},Qa={class:"status-chip-row"},Wa=["onClick"],Xa={class:"chip-count"},Za={class:"filters-card"},as={class:"filter-group"},ss={class:"filter-group"},ts=["value"],es={class:"filter-group"},os={class:"range-inputs"},ls={class:"filter-group"},ns=["disabled"],rs={key:2,class:"payable-content"},is={class:"table-card"},us={class:"table-header"},ds={class:"table-caption"},cs={key:0,class:"filters-badge"},vs={class:"table-responsive"},ps={class:"data-table payable-table"},_s={class:"text-end"},fs={key:0},gs={colspan:"6",class:"empty-row"},bs={"data-label":"Descrição"},ys={class:"description-cell"},ms={key:0,class:"description-note"},hs={"data-label":"Categoria"},ks={"data-label":"Valor",class:"text-end"},Cs={"data-label":"Vencimento"},ws={"data-label":"Status"},Ss={class:"actions-col","data-label":"Ações"},Es=["title","onClick","disabled"],Ds=["onClick","disabled"],Ns=["onClick","disabled"],xs={class:"insights-card"},Bs={class:"insights-section"},Vs={key:0,class:"insights-list"},$s={class:"item-title"},Is={class:"item-sub"},Ps={class:"item-meta"},Os={class:"item-value neg"},Fs={class:"item-date"},Ls={key:1,class:"empty-note"},Ms={class:"insights-section"},Rs={key:0,class:"insights-list overdue"},As={class:"item-title"},Us={class:"item-sub"},zs={class:"item-meta"},Ts={class:"item-value neg"},js={key:1,class:"empty-note"},qs={class:"insights-section"},Hs={key:0,class:"insights-list compact"},Ys={class:"item-title"},Gs={class:"item-sub"},Js={class:"item-meta"},Ks={class:"item-value neg"},Qs={class:"item-note"},Ws={key:1,class:"empty-note"},Xs={class:"modal-dialog"},Zs={class:"modal-content"},at={class:"modal-header"},st={class:"modal-body"},tt={class:"form-grid"},et={class:"form-group form-group-large"},ot={class:"form-group form-group-large"},lt={class:"form-group"},nt={class:"form-group"},rt={class:"form-group"},it={key:0,class:"form-error"},ut={key:1,class:"form-success"},dt={class:"modal-footer"},ct=["disabled"],vt={key:0},pt={key:1},_t={__name:"ContasPagarView",setup(ft){const Q=c([]),j=c(!1),L=c(""),M=c(!1),B=c(null),V=c(""),y=c("all"),k=c("all"),f=c(""),g=c(""),p=ea({column:"vencimento",direction:"asc"}),_=c(""),C=c(""),$=c(null),I=c(null),R=c(!1),i=ea({descricao:"",categoria:"",valor:0,data:new Date().toISOString().slice(0,10),pago:!1}),ua=[{key:"all",label:"Todas"},{key:"open",label:"Em aberto"},{key:"soon",label:"Próx. 7 dias"},{key:"overdue",label:"Atrasadas"},{key:"paid",label:"Pagas"}],W=["descricao","categoria","valor","vencimento","status"];function A(t){if(!t)return null;const a=new Date(t);return Number.isNaN(a)?null:(a.setHours(0,0,0,0),a)}function m(t){return(Number(t)||0).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}function q(t){if(!t)return"Sem data";const a=new Date(t);return Number.isNaN(a)?"Sem data":a.toLocaleDateString("pt-BR")}function da(t){return Number.isFinite(t)?`${(t*100).toFixed(1)}%`:"0%"}const w=d(()=>{const t=A(new Date);return Q.value.map(a=>{const e=Number(a.valor||a.amount||0),n=a.data?A(a.data):null;let o="open";if(a.pago)o="paid";else if(n){const D=Math.ceil((n-t)/864e5);D<0?o="overdue":D===0?o="today":D<=7&&(o="soon")}return{...a,__valor:e,__date:n,__dateISO:n?n.toISOString().slice(0,10):"",__status:o}})}),ca=d(()=>{const t=new Set;let a=!1;w.value.forEach(n=>{n.categoria?t.add(n.categoria):a=!0});const e=Array.from(t).sort((n,o)=>n.localeCompare(o,"pt-BR",{sensitivity:"base"}));return a&&e.push("Sem categoria"),e}),va=d(()=>{const t={all:w.value.length,open:0,soon:0,overdue:0,paid:0};return w.value.forEach(a=>{switch(a.__status){case"paid":t.paid+=1;break;case"overdue":t.overdue+=1;break;case"soon":case"today":t.soon+=1;break;default:t.open+=1}}),t}),H=d(()=>{const t=V.value.trim().toLowerCase(),a=f.value?A(f.value):null,e=g.value?A(g.value):null;e&&e.setHours(23,59,59,999);const n=w.value.filter(o=>!(t&&!`${o.descricao||""} ${o.categoria||""} ${o.fornecedor||""} ${o.observacao||""}`.toLowerCase().includes(t)||k.value!=="all"&&(o.categoria||"Sem categoria")!==k.value||a&&(!o.__date||o.__date<a)||e&&(!o.__date||o.__date>e)||y.value==="paid"&&!o.pago||y.value==="overdue"&&o.__status!=="overdue"||y.value==="soon"&&!(o.__status==="soon"||o.__status==="today")||y.value==="open"&&(o.pago||["overdue","soon","today"].includes(o.__status))));return _a(n)}),Y=d(()=>!!(V.value||f.value||g.value||k.value!=="all"||y.value!=="all"));function pa(t){switch(t){case"descricao":return(a,e)=>(a.descricao||"").localeCompare(e.descricao||"","pt-BR",{sensitivity:"base"});case"categoria":return(a,e)=>(a.categoria||"").localeCompare(e.categoria||"","pt-BR",{sensitivity:"base"});case"valor":return(a,e)=>(a.__valor||0)-(e.__valor||0);case"status":return(a,e)=>G(a).localeCompare(G(e),"pt-BR",{sensitivity:"base"});case"vencimento":default:return(a,e)=>a.__date&&e.__date?a.__date-e.__date:a.__date?-1:e.__date?1:(a.descricao||"").localeCompare(e.descricao||"","pt-BR",{sensitivity:"base"})}}function _a(t){const a=W.includes(p.column)?p.column:"vencimento",e=p.direction==="desc"?-1:1,n=pa(a);return[...t].sort((o,D)=>n(o,D)*e)}function P(t){W.includes(t)&&(p.column===t?p.direction=p.direction==="asc"?"desc":"asc":(p.column=t,p.direction="asc"))}function O(t){return p.column!==t?"fa-sort":p.direction==="asc"?"fa-sort-up":"fa-sort-down"}const S=d(()=>w.value.filter(t=>!t.pago)),X=d(()=>w.value.filter(t=>!!t.pago)),fa=d(()=>S.value.reduce((t,a)=>t+a.__valor,0)),ga=d(()=>{const t=new Date,a=t.getMonth(),e=t.getFullYear();return X.value.reduce((n,o)=>o.__date&&o.__date.getMonth()===a&&o.__date.getFullYear()===e?n+o.__valor:n,0)}),ba=d(()=>X.value.length),U=d(()=>S.value.filter(t=>t.__status==="overdue").sort((t,a)=>(t.__date||0)-(a.__date||0)).slice(0,5)),Z=d(()=>U.value.reduce((t,a)=>t+a.__valor,0)),ya=d(()=>U.value.length),z=d(()=>S.value.filter(t=>t.__status==="soon"||t.__status==="today").sort((t,a)=>(t.__date||0)-(a.__date||0)).slice(0,5)),aa=d(()=>z.value.reduce((t,a)=>t+a.__valor,0)),ma=d(()=>z.value.length),ha=d(()=>S.value.length),sa=d(()=>{const t=new Map,a=S.value.reduce((e,n)=>e+n.__valor,0);return S.value.forEach(e=>{const n=e.categoria||"Sem categoria",o=t.get(n)||{categoria:n,valor:0,count:0};o.valor+=e.__valor,o.count+=1,t.set(n,o)}),Array.from(t.values()).sort((e,n)=>n.valor-e.valor).slice(0,5).map(e=>({...e,perc:a?e.valor/a:0}))});function G(t){if(t.pago)return"Pago";switch(t.__status){case"overdue":return"Atrasada";case"today":return"Vence hoje";case"soon":return"Em breve";default:return"Em aberto"}}function ka(t){return t.pago?"status-paid":t.__status==="overdue"?"status-overdue":t.__status==="soon"||t.__status==="today"?"status-soon":"status-open"}function Ca(t){return t.pago?"row-paid":t.__status==="overdue"?"row-overdue":t.__status==="soon"||t.__status==="today"?"row-soon":""}function ta(){i.descricao="",i.categoria="",i.valor=0,i.data=new Date().toISOString().slice(0,10),i.pago=!1,B.value=null,_.value="",C.value=""}function wa(){ta(),M.value=!0}function Sa(t){B.value=t.id,i.descricao=t.descricao||"",i.categoria=t.categoria||"",i.valor=Number(t.valor||t.__valor||0),i.data=t.data||t.__dateISO||new Date().toISOString().slice(0,10),i.pago=!!t.pago,_.value="",C.value="",M.value=!0}function T(){M.value=!1}async function E(){j.value=!0,L.value="";try{Q.value=await Pa()}catch(t){L.value=(t==null?void 0:t.message)||"Erro ao carregar contas"}finally{j.value=!1}}async function Ea(){if(_.value="",C.value="",!i.descricao){_.value="Descrição é obrigatória.";return}const t={descricao:i.descricao,categoria:i.categoria,valor:Number(i.valor||0),data:i.data,pago:!!i.pago};try{R.value=!0,B.value?await ia(B.value,t):await Fa(t),C.value="Conta salva com sucesso.",T(),ta(),await E()}catch(a){_.value=(a==null?void 0:a.message)||"Erro ao salvar conta."}finally{R.value=!1}}async function Da(t){if(!(!(t!=null&&t.id)||$.value)){_.value="";try{$.value=t.id,await ia(t.id,{descricao:t.descricao,categoria:t.categoria,valor:Number(t.valor||t.__valor||0),data:t.data||t.__dateISO,pago:!t.pago}),await E()}catch(a){_.value=(a==null?void 0:a.message)||"Erro ao atualizar status."}finally{$.value=null}}}async function Na(t){if(!(!(t!=null&&t.id)||I.value)&&confirm(`Confirma excluir a conta "${t.descricao||t.id}"?`))try{I.value=t.id,_.value="",await Oa(t.id),await E()}catch(a){_.value=(a==null?void 0:a.message)||"Erro ao excluir conta."}finally{I.value=null}}function xa(){V.value="",k.value="all",f.value="",g.value="",y.value="all",p.column="vencimento",p.direction="asc"}function J(t){return t==null?!1:$.value===t||I.value===t}return Va(async()=>{await E()}),oa(f,t=>{if(!t||!g.value)return;const a=new Date(t);new Date(g.value)<a&&(g.value="")}),oa(g,t=>{if(!t||!f.value)return;const a=new Date(t),e=new Date(f.value);a<e&&(f.value="")}),(t,a)=>(r(),u("section",La,[s("header",Ma,[s("div",Ra,[a[18]||(a[18]=s("h2",null,"Contas a Pagar",-1)),a[19]||(a[19]=s("p",null,"Planeje desembolsos, antecipe atrasos e mantenha o caixa em segurança.",-1)),s("div",Aa,[s("div",Ua,[a[14]||(a[14]=s("span",{class:"summary-label"},"Em aberto",-1)),s("strong",za,l(m(fa.value)),1),s("span",Ta,l(ha.value)+" conta(s)",1)]),s("div",{class:v(["summary-card info",{attention:aa.value>0}])},[a[15]||(a[15]=s("span",{class:"summary-label"},"Próx. 7 dias",-1)),s("strong",ja,l(m(aa.value)),1),s("span",qa,l(ma.value)+" a vencer",1)],2),s("div",{class:v(["summary-card warning",{critical:Z.value>0}])},[a[16]||(a[16]=s("span",{class:"summary-label"},"Em atraso",-1)),s("strong",Ha,l(m(Z.value)),1),s("span",Ya,l(ya.value)+" pendente(s)",1)],2),s("div",Ga,[a[17]||(a[17]=s("span",{class:"summary-label"},"Pagas no mês",-1)),s("strong",Ja,l(m(ga.value)),1),s("span",Ka,l(ba.value)+" quitada(s)",1)])])]),s("div",{class:"header-actions"},[s("button",{class:"btn btn-success",type:"button",onClick:wa},[...a[20]||(a[20]=[s("i",{class:"fa-solid fa-plus"},null,-1),s("span",null,"Nova conta",-1)])]),s("button",{class:"btn btn-ghost",type:"button",onClick:E},[...a[21]||(a[21]=[s("i",{class:"fa-solid fa-rotate"},null,-1),s("span",null,"Atualizar",-1)])])])]),s("div",Qa,[(r(),u(N,null,x(ua,e=>s("button",{key:e.key,type:"button",class:v(["status-chip",{active:y.value===e.key}]),onClick:n=>y.value=e.key},[s("span",null,l(e.label),1),s("span",Xa,l(va.value[e.key]||0),1)],10,Wa)),64))]),s("div",Za,[s("div",as,[a[22]||(a[22]=s("label",{for:"search"},"Buscar",-1)),b(s("input",{id:"search",type:"search",class:"form-control",placeholder:"Descrição, categoria ou fornecedor","onUpdate:modelValue":a[0]||(a[0]=e=>V.value=e)},null,512),[[h,V.value,void 0,{trim:!0}]])]),s("div",ss,[a[24]||(a[24]=s("label",{for:"category"},"Categoria",-1)),b(s("select",{id:"category",class:"form-control","onUpdate:modelValue":a[1]||(a[1]=e=>k.value=e)},[a[23]||(a[23]=s("option",{value:"all"},"Todas",-1)),(r(!0),u(N,null,x(ca.value,e=>(r(),u("option",{key:e,value:e},l(e),9,ts))),128))],512),[[na,k.value]])]),s("div",es,[a[26]||(a[26]=s("label",{for:"range"},"Período",-1)),s("div",os,[b(s("input",{id:"range",type:"date",class:"form-control","onUpdate:modelValue":a[2]||(a[2]=e=>f.value=e)},null,512),[[h,f.value]]),a[25]||(a[25]=s("span",null,"até",-1)),b(s("input",{type:"date",class:"form-control","onUpdate:modelValue":a[3]||(a[3]=e=>g.value=e)},null,512),[[h,g.value]])])]),s("div",ls,[a[27]||(a[27]=s("label",null," ",-1)),s("button",{class:"btn btn-primary",type:"button",onClick:xa,disabled:!Y.value}," Limpar filtros ",8,ns)])]),L.value?(r(),la($a,{key:0,message:L.value,retry:E},null,8,["message"])):j.value?(r(),la(Ia,{key:1,message:"Carregando contas…"})):(r(),u("div",rs,[s("div",is,[s("div",us,[a[29]||(a[29]=s("h3",null,"Planilha de Contas a Pagar",-1)),s("span",ds,[K(l(H.value.length)+" registro(s) ",1),Y.value?(r(),u("span",cs,[...a[28]||(a[28]=[s("i",{class:"fa-solid fa-filter"},null,-1),K(" Filtros ativos ",-1)])])):F("",!0)])]),s("div",vs,[s("table",ps,[s("thead",null,[s("tr",null,[s("th",null,[s("button",{type:"button",class:"sort-button",onClick:a[4]||(a[4]=e=>P("descricao"))},[a[30]||(a[30]=s("span",null,"Descrição",-1)),s("i",{class:v(["fa-solid",O("descricao")])},null,2)])]),s("th",null,[s("button",{type:"button",class:"sort-button",onClick:a[5]||(a[5]=e=>P("categoria"))},[a[31]||(a[31]=s("span",null,"Categoria",-1)),s("i",{class:v(["fa-solid",O("categoria")])},null,2)])]),s("th",_s,[s("button",{type:"button",class:"sort-button",onClick:a[6]||(a[6]=e=>P("valor"))},[a[32]||(a[32]=s("span",null,"Valor",-1)),s("i",{class:v(["fa-solid",O("valor")])},null,2)])]),s("th",null,[s("button",{type:"button",class:"sort-button",onClick:a[7]||(a[7]=e=>P("vencimento"))},[a[33]||(a[33]=s("span",null,"Vencimento",-1)),s("i",{class:v(["fa-solid",O("vencimento")])},null,2)])]),s("th",null,[s("button",{type:"button",class:"sort-button",onClick:a[8]||(a[8]=e=>P("status"))},[a[34]||(a[34]=s("span",null,"Status",-1)),s("i",{class:v(["fa-solid",O("status")])},null,2)])]),a[35]||(a[35]=s("th",{class:"actions-col"},"Ações",-1))])]),s("tbody",null,[H.value.length?F("",!0):(r(),u("tr",fs,[s("td",gs,l(Y.value?"Nenhuma conta encontrada para os filtros atuais.":"Cadastre suas primeiras contas a pagar."),1)])),(r(!0),u(N,null,x(H.value,e=>(r(),u("tr",{key:e.id||e.__dateISO||e.descricao,class:v(Ca(e))},[s("td",bs,[s("div",ys,[s("strong",null,l(e.descricao||"Conta sem descrição"),1),e.observacao?(r(),u("span",ms,l(e.observacao),1)):F("",!0)])]),s("td",hs,l(e.categoria||"Sem categoria"),1),s("td",ks,l(m(e.__valor)),1),s("td",Cs,l(q(e.__date)),1),s("td",ws,[s("span",{class:v(["status-pill",ka(e)])},l(G(e)),3)]),s("td",Ss,[s("button",{class:"btn-icon btn-success",title:e.pago?"Reabrir conta":"Marcar como paga",onClick:n=>Da(e),disabled:J(e.id)},[s("i",{class:v(["fa-solid",$.value===e.id?"fa-spinner fa-spin":e.pago?"fa-rotate-left":"fa-check"])},null,2)],8,Es),s("button",{class:"btn-icon btn-warning",title:"Editar",onClick:n=>Sa(e),disabled:J(e.id)},[...a[36]||(a[36]=[s("i",{class:"fa-solid fa-pen"},null,-1)])],8,Ds),s("button",{class:"btn-icon btn-danger",title:"Excluir",onClick:n=>Na(e),disabled:J(e.id)},[s("i",{class:v(["fa-solid",I.value===e.id?"fa-spinner fa-spin":"fa-trash"])},null,2)],8,Ns)])],2))),128))])])])]),s("aside",xs,[s("div",Bs,[a[37]||(a[37]=s("h4",null,"Próximos pagamentos",-1)),z.value.length?(r(),u("ul",Vs,[(r(!0),u(N,null,x(z.value,e=>(r(),u("li",{key:`soon-${e.id||e.__dateISO}`},[s("div",null,[s("span",$s,l(e.descricao||"Sem descrição"),1),s("span",Is,l(e.categoria||"Sem categoria"),1)]),s("div",Ps,[s("span",Os,l(m(e.__valor)),1),s("span",Fs,l(q(e.__date)),1)])]))),128))])):(r(),u("p",Ls,"Nenhum débito previsto para os próximos dias."))]),s("div",Ms,[a[38]||(a[38]=s("h4",null,"Em atraso",-1)),U.value.length?(r(),u("ul",Rs,[(r(!0),u(N,null,x(U.value,e=>(r(),u("li",{key:`late-${e.id||e.__dateISO}`},[s("div",null,[s("span",As,l(e.descricao||"Sem descrição"),1),s("span",Us,l(q(e.__date)),1)]),s("div",zs,[s("span",Ts,l(m(e.__valor)),1)])]))),128))])):(r(),u("p",js,"Nenhuma conta vencida por aqui. Ótimo trabalho!"))]),s("div",qs,[a[39]||(a[39]=s("h4",null,"Categorias relevantes",-1)),sa.value.length?(r(),u("ul",Hs,[(r(!0),u(N,null,x(sa.value,e=>(r(),u("li",{key:`cat-${e.categoria}`},[s("div",null,[s("span",Ys,l(e.categoria),1),s("span",Gs,l(e.count)+" lançamento(s)",1)]),s("div",Js,[s("span",Ks,l(m(e.valor)),1),s("span",Qs,l(da(e.perc)),1)])]))),128))])):(r(),u("p",Ws,"Cadastre despesas para visualizar tendências por categoria."))])])])),s("div",{class:v(["modal",{show:M.value}]),role:"dialog","aria-hidden":"true",onClick:ra(T,["self"])},[s("div",Xs,[s("div",Zs,[s("div",at,[s("h3",null,l(B.value?"Editar conta":"Nova conta"),1),s("button",{type:"button",class:"btn-close",onClick:T,"aria-label":"Fechar"},[...a[40]||(a[40]=[s("i",{class:"fa-solid fa-times"},null,-1)])])]),s("form",{onSubmit:ra(Ea,["prevent"])},[s("div",st,[s("div",tt,[s("div",et,[a[41]||(a[41]=s("label",{for:"descricao"},"Descrição",-1)),b(s("input",{id:"descricao",class:"form-control","onUpdate:modelValue":a[9]||(a[9]=e=>i.descricao=e),required:""},null,512),[[h,i.descricao,void 0,{trim:!0}]])]),s("div",ot,[a[42]||(a[42]=s("label",{for:"categoria"},"Categoria",-1)),b(s("input",{id:"categoria",class:"form-control","onUpdate:modelValue":a[10]||(a[10]=e=>i.categoria=e),placeholder:"Ex: Fornecedor, Imposto"},null,512),[[h,i.categoria,void 0,{trim:!0}]])]),s("div",lt,[a[43]||(a[43]=s("label",{for:"valor"},"Valor (R$)",-1)),b(s("input",{id:"valor",type:"number",min:"0",step:"0.01",class:"form-control","onUpdate:modelValue":a[11]||(a[11]=e=>i.valor=e)},null,512),[[h,i.valor,void 0,{number:!0}]])]),s("div",nt,[a[44]||(a[44]=s("label",{for:"data"},"Vencimento",-1)),b(s("input",{id:"data",type:"date",class:"form-control","onUpdate:modelValue":a[12]||(a[12]=e=>i.data=e)},null,512),[[h,i.data]])]),s("div",rt,[a[46]||(a[46]=s("label",{for:"pago"},"Pago",-1)),b(s("select",{id:"pago",class:"form-control","onUpdate:modelValue":a[13]||(a[13]=e=>i.pago=e)},[...a[45]||(a[45]=[s("option",{value:!1},"Não",-1),s("option",{value:!0},"Sim",-1)])],512),[[na,i.pago]])])]),_.value?(r(),u("p",it,l(_.value),1)):F("",!0),C.value?(r(),u("p",ut,l(C.value),1)):F("",!0)]),s("div",dt,[s("button",{type:"button",class:"btn btn-secondary",onClick:T},"Cancelar"),s("button",{type:"submit",class:"btn btn-success",disabled:R.value},[R.value?(r(),u("span",vt,[...a[47]||(a[47]=[s("i",{class:"fa-solid fa-spinner fa-spin"},null,-1),K(" Salvando…",-1)])])):(r(),u("span",pt,"Salvar"))],8,ct)])],32)])])],2)]))}},ht=Ba(_t,[["__scopeId","data-v-9fc7d951"]]);export{ht as default};
